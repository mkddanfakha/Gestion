import{d as T,x as G,r as J,h as F,c as K,w as V,j as h,u as i,M as W,a as t,m as U,b as d,e as S,P as L,U as M,v as N,o as l,t as _,f as c,l as X}from"./app-BrkohfQq.js";import{q,a as Y}from"./index-CMWG4mbA.js";import{c as Z,a as Q,u as ee}from"./index.esm-tC5WWQiQ.js";import{S as se,_ as A}from"./Layout-Dotx1wDC.js";import{_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-ClsnqJJt.js";import{u as ie}from"./useSweetAlert-CjcY7Pj8.js";import{u as oe}from"./BootstrapLayout-DdWhaGDh.js";import{r as B}from"./routes-C8N3XD_S.js";import"./index-BA3WRlAQ.js";import"./index-CKv6rp-i.js";import"./index-DnLC8ybD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const r=e=>({url:r.url(e),method:"get"});r.definition={methods:["get","head"],url:"/verify-email"};r.url=e=>r.definition.url+q(e);r.get=e=>({url:r.url(e),method:"get"});r.head=e=>({url:r.url(e),method:"head"});const x=e=>({action:r.url(e),method:"get"});x.get=e=>({action:r.url(e),method:"get"});x.head=e=>({action:r.url({[e?.mergeQuery?"mergeQuery":"query"]:{_method:"HEAD",...e?.query??e?.mergeQuery??{}}}),method:"get"});r.form=x;const a=(e,o)=>({url:a.url(e,o),method:"get"});a.definition={methods:["get","head"],url:"/verify-email/{id}/{hash}"};a.url=(e,o)=>{Array.isArray(e)&&(e={id:e[0],hash:e[1]}),e=Y(e);const m={id:e.id,hash:e.hash};return a.definition.url.replace("{id}",m.id.toString()).replace("{hash}",m.hash.toString()).replace(/\/+$/,"")+q(o)};a.get=(e,o)=>({url:a.url(e,o),method:"get"});a.head=(e,o)=>({url:a.url(e,o),method:"head"});const E=(e,o)=>({action:a.url(e,o),method:"get"});E.get=(e,o)=>({action:a.url(e,o),method:"get"});E.head=(e,o)=>({action:a.url(e,{[o?.mergeQuery?"mergeQuery":"query"]:{_method:"HEAD",...o?.query??o?.mergeQuery??{}}}),method:"get"});a.form=E;const n=e=>({url:n.url(e),method:"post"});n.definition={methods:["post"],url:"/email/verification-notification"};n.url=e=>n.definition.url+q(e);n.post=e=>({url:n.url(e),method:"post"});const D=e=>({action:n.url(e),method:"post"});D.post=e=>({action:n.url(e),method:"post"});n.form=D;Object.assign(r,r),Object.assign(a,a),Object.assign(n,n);const re={class:"row g-4"},ae={class:"col-12"},le={class:"card"},ne={class:"card-body"},de={class:"row g-3"},me={class:"col-md-6"},ue={key:0,class:"invalid-feedback d-block"},ce={class:"col-md-6"},pe={key:0,class:"invalid-feedback d-block"},fe={class:"col-12"},ve=["disabled"],he={key:0,class:"spinner-border spinner-border-sm me-2"},_e={key:1,class:"bi bi-check-circle me-1"},be={class:"col-12"},ye={class:"card"},ge={class:"card-body"},ke={class:"d-flex justify-content-between align-items-center"},Ve={class:"mb-1"},Se={key:0,class:"badge bg-success ms-2"},Ae={key:1,class:"badge bg-warning text-dark ms-2"},qe={class:"text-muted"},xe={key:0},Ee=["disabled"],we={key:0,class:"spinner-border spinner-border-sm me-2"},Pe={key:1,class:"bi bi-envelope me-1"},je={class:"col-12"},Fe={class:"card border-warning"},Ue={class:"card-body"},Le={class:"alert alert-info mb-0"},Me={key:0},Ne={key:1},Ke=T({__name:"Profile",props:{mustVerifyEmail:{type:Boolean},status:{}},setup(e){const m=G().props.auth.user,{success:b,error:$}=ie(),{isAdmin:z}=oe(),p=J(!1),C=()=>{p.value=!0,F.post(n().url,{},{onSuccess:v=>{p.value=!1;const s=v.props?.flash;s?.status||s?.success,b("Un nouveau lien de vérification a été envoyé à votre adresse email.")},onError:v=>{p.value=!1;const s=v?.message||"Une erreur est survenue lors de l'envoi de l'email de vérification.";$(s)},onFinish:()=>{p.value=!1}})},O=Z({name:Q().required("Le nom est requis").min(2,"Le nom doit contenir au moins 2 caractères"),email:Q().required("L'email est requis").email("L'email doit être valide")}),{handleSubmit:H,defineField:w,errors:f,isSubmitting:y,setFieldError:P}=ee({validationSchema:O,initialValues:{name:m.name,email:m.email}}),[g,I]=w("name"),[k,R]=w("email"),j=H(v=>{F.patch(B("profile.update"),v,{onSuccess:()=>{b("Profil mis à jour avec succès.")},onError:s=>{if(s.name){const u=Array.isArray(s.name)?s.name[0]:s.name;P("name",u)}if(s.email){const u=Array.isArray(s.email)?s.email[0]:s.email;P("email",u)}}})});return(v,s)=>(l(),K(te,null,{default:V(()=>[h(i(W),{title:"Paramètres du profil"}),h(se,null,{default:V(()=>[t("div",re,[t("div",ae,[h(A,{title:"Informations du profil",description:"Mettez à jour votre nom et votre adresse email"}),t("form",{onSubmit:s[2]||(s[2]=(...u)=>i(j)&&i(j)(...u))},[t("div",le,[t("div",ne,[t("div",de,[t("div",me,[s[3]||(s[3]=t("label",{for:"name",class:"form-label"},"Nom",-1)),U(t("input",L({id:"name","onUpdate:modelValue":s[0]||(s[0]=u=>M(g)?g.value=u:null)},i(I),{type:"text",class:["form-control",{"is-invalid":i(f).name}],required:"",autofocus:"",autocomplete:"name"}),null,16),[[N,i(g)]]),i(f).name?(l(),d("div",ue,_(i(f).name),1)):S("",!0)]),t("div",ce,[s[4]||(s[4]=t("label",{for:"email",class:"form-label"},"Email",-1)),U(t("input",L({id:"email","onUpdate:modelValue":s[1]||(s[1]=u=>M(k)?k.value=u:null)},i(R),{type:"email",class:["form-control",{"is-invalid":i(f).email}],required:"",autocomplete:"username"}),null,16),[[N,i(k)]]),i(f).email?(l(),d("div",pe,_(i(f).email),1)):S("",!0)]),t("div",fe,[t("button",{type:"submit",class:"btn btn-primary",disabled:i(y)},[i(y)?(l(),d("span",he)):(l(),d("i",_e)),c(" "+_(i(y)?"Sauvegarde...":"Sauvegarder"),1)],8,ve)])])])])],32)]),t("div",be,[h(A,{title:"Vérification de l'email",description:"Vérifiez votre adresse email pour sécuriser votre compte"}),t("div",ye,[t("div",ge,[t("div",ke,[t("div",null,[t("p",Ve,[c(_(i(m).email)+" ",1),i(m).email_verified_at?(l(),d("span",Se,[...s[5]||(s[5]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),c(" Vérifié ",-1)])])):(l(),d("span",Ae,[...s[6]||(s[6]=[t("i",{class:"bi bi-exclamation-triangle me-1"},null,-1),c(" Non vérifié ",-1)])]))]),t("small",qe,_(i(m).email_verified_at?"Votre email a été vérifié avec succès.":"Votre email n'est pas vérifié."),1)]),i(m).email_verified_at?S("",!0):(l(),d("div",xe,[t("button",{type:"button",onClick:C,class:"btn btn-outline-primary",disabled:p.value},[p.value?(l(),d("span",we)):(l(),d("i",Pe)),c(" "+_(p.value?"Envoi...":"Renvoyer l'email de vérification"),1)],8,Ee)]))])])])]),t("div",je,[h(A,{title:"Supprimer le compte",description:"Gestion de la suppression de compte"}),t("div",Fe,[t("div",Ue,[t("div",Le,[s[10]||(s[10]=t("i",{class:"bi bi-info-circle me-2"},null,-1)),s[11]||(s[11]=t("strong",null,"Information :",-1)),s[12]||(s[12]=c(" La suppression de compte n'est pas disponible depuis cette page. ",-1)),i(z)?(l(),d("span",Me,[s[8]||(s[8]=c(" Veuillez utiliser la section ",-1)),h(i(X),{href:i(B)("admin.users.index"),class:"alert-link"},{default:V(()=>[...s[7]||(s[7]=[c("Administration",-1)])]),_:1},8,["href"]),s[9]||(s[9]=c(" pour gérer les utilisateurs. ",-1))])):(l(),d("span",Ne," Veuillez contacter un administrateur pour supprimer votre compte. "))])])])])])]),_:1})]),_:1}))}});export{Ke as default};
