import{d as K,r as Q,i as G,y as D,c as H,w as B,a as t,j as F,u as i,l as T,f as _,m as v,b as u,e as m,n as f,o as a,F as I,g as L,t as c,p as A,v as y}from"./app-CGqa7dvF.js";import{_ as J}from"./AppLayout.vue_vue_type_script_setup_true_lang-CUowRV7B.js";import{r as U}from"./routes-Ds1K_LXc.js";import{u as W}from"./useSweetAlert-CjcY7Pj8.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BootstrapLayout-L_TowVZG.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const Y={class:"d-flex justify-content-between align-items-center mb-4"},Z={class:"row"},ee={class:"col-lg-8"},te={class:"card mb-4"},se={class:"card-body"},oe={class:"row g-3"},ie={class:"col-md-6"},re=["value"],le={key:0,class:"invalid-feedback"},ne={key:1,class:"invalid-feedback"},de={class:"col-md-6"},ae={key:0,class:"invalid-feedback"},ue={key:1,class:"invalid-feedback"},ce={class:"col-md-6"},pe={key:0,class:"invalid-feedback"},me={key:1,class:"invalid-feedback"},_e={class:"col-md-6"},ve={key:0,class:"invalid-feedback"},be={key:1,class:"invalid-feedback"},fe={class:"col-12"},ye={key:0,class:"invalid-feedback"},ke={class:"card mb-4"},ge={class:"card-body"},qe={key:0,class:"text-center py-4 text-muted"},xe={key:1},$e={class:"row g-3"},we={class:"col-md-5"},Ce=["onUpdate:modelValue","onChange","onBlur"],Ve=["value","disabled"],je={key:0},Be={key:0,class:"invalid-feedback"},Ie={class:"col-md-2"},Le=["onUpdate:modelValue","onInput","onBlur"],Ae={key:0,class:"invalid-feedback"},Ue={class:"col-md-3"},Se=["onUpdate:modelValue","onInput","onBlur"],he={key:0,class:"invalid-feedback"},De={class:"col-md-2"},Fe=["value"],Te={class:"col-12 text-end"},Ee=["onClick"],ze={class:"col-lg-4"},Pe={class:"card sticky-top",style:{top:"20px"}},Re={class:"card-body"},Me={class:"mb-3"},Ne={class:"d-flex justify-content-between mb-2"},Oe={class:"fw-medium"},Ke={class:"d-flex justify-content-between mb-2"},Qe={class:"fw-medium"},Ge={class:"d-flex justify-content-between mb-2"},He={class:"d-flex justify-content-between mb-2"},Je={class:"d-flex justify-content-between"},We={class:"fw-bold text-success fs-5"},Xe={class:"d-grid gap-2"},Ye=["disabled"],Ze={key:0,class:"spinner-border spinner-border-sm me-2"},et={key:1,class:"bi bi-check-circle me-1"},tt=K({__name:"Create",props:{suppliers:{},products:{}},setup(q){const{success:E,error:x}=W(),n=Q({}),z=()=>{const r={};return o.supplier_id||(r.supplier_id="Le fournisseur est requis."),o.order_date||(r.order_date="La date de commande est requise."),o.expected_delivery_date&&o.order_date&&new Date(o.expected_delivery_date)<new Date(o.order_date)&&(r.expected_delivery_date="La date de livraison ne peut pas être antérieure à la date de commande."),o.status||(r.status="Le statut est requis."),o.items.length===0?r.items="Au moins un article est requis.":o.items.forEach((e,s)=>{!e.product_id||e.product_id===0?r[`items.${s}.product_id`]="Le produit est requis.":g(e.product_id,s)&&(r[`items.${s}.product_id`]="Ce produit est déjà sélectionné."),e.quantity<=0&&(r[`items.${s}.quantity`]="La quantité doit être supérieure à 0."),e.unit_price<=0&&(r[`items.${s}.unit_price`]="Le prix unitaire doit être supérieur à 0.")}),r},b=(r,e)=>{n.value[r]&&delete n.value[r];let s="";switch(r){case"supplier_id":e||(s="Le fournisseur est requis.");break;case"order_date":e||(s="La date de commande est requise.");break;case"expected_delivery_date":e&&o.order_date&&new Date(e)<new Date(o.order_date)&&(s="La date de livraison ne peut pas être antérieure à la date de commande.");break;case"status":e||(s="Le statut est requis.");break}s&&(n.value[r]=s)},k=(r,e,s)=>{const l=`items.${r}.${e}`;n.value[l]&&delete n.value[l];let d="";switch(e){case"product_id":!s||s===0?d="Le produit est requis.":g(s,r)&&(d="Ce produit est déjà sélectionné.");break;case"quantity":s<=0&&(d="La quantité doit être supérieure à 0.");break;case"unit_price":s<=0&&(d="Le prix unitaire doit être supérieur à 0.");break}d&&(n.value[l]=d)},P=q,o=G({supplier_id:"",order_date:new Date().toISOString().split("T")[0],expected_delivery_date:"",status:"draft",notes:"",tax_amount:0,discount_amount:0,subtotal:0,total_amount:0,items:[]}),R=()=>{o.items.push({product_id:0,quantity:1,unit_price:0,total_price:0})},M=r=>{o.items.splice(r,1),S()},N=r=>{const e=o.items[r],s=P.products.find(l=>l.id===e.product_id);s&&(e.unit_price=s.cost_price||s.price,$(r))},g=(r,e)=>o.items.some((s,l)=>s.product_id===r&&l!==e),$=r=>{const e=o.items[r];e.total_price=e.quantity*e.unit_price,S()},S=()=>{o.subtotal=o.items.reduce((r,e)=>r+e.total_price,0),w()},w=()=>{o.total_amount=o.subtotal+o.tax_amount-o.discount_amount},C=D(()=>o.items.reduce((r,e)=>r+e.total_price,0)),h=D(()=>C.value+o.tax_amount-o.discount_amount),V=r=>new Intl.NumberFormat("fr-FR").format(r)+" Fcfa",O=()=>{n.value={};const r=z();if(r&&Object.keys(r).length>0){n.value=r,r.items?x("Au moins un article est requis pour créer un bon de commande."):x("Veuillez corriger les erreurs dans le formulaire.");return}o.subtotal=C.value,o.total_amount=h.value,o.post(U("purchase-orders.store"),{onSuccess:()=>{E("Bon de commande créé avec succès !")},onError:()=>{x("Erreur lors de la création du bon de commande.")}})},{errors:p,processing:j}=o;return(r,e)=>(a(),H(J,null,{default:B(()=>[t("div",Y,[e[16]||(e[16]=t("div",null,[t("h1",{class:"h2 mb-1"},"Nouveau bon de commande"),t("p",{class:"text-muted mb-0"},"Créez un nouveau bon de commande")],-1)),F(i(T),{href:i(U)("purchase-orders.index"),class:"btn btn-outline-secondary"},{default:B(()=>[...e[15]||(e[15]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),_(" Retour à la liste ",-1)])]),_:1},8,["href"])]),t("form",null,[t("div",Z,[t("div",ee,[t("div",te,[e[24]||(e[24]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Informations générales")],-1)),t("div",se,[t("div",oe,[t("div",ie,[e[18]||(e[18]=t("label",{class:"form-label"},[_(" Fournisseur "),t("span",{class:"text-danger"},"*")],-1)),v(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>i(o).supplier_id=s),required:"",class:f(["form-select",{"is-invalid":i(p).supplier_id||n.value.supplier_id}]),onBlur:e[1]||(e[1]=s=>b("supplier_id",i(o).supplier_id)),onChange:e[2]||(e[2]=s=>b("supplier_id",i(o).supplier_id))},[e[17]||(e[17]=t("option",{value:""},"Sélectionner un fournisseur",-1)),(a(!0),u(I,null,L(q.suppliers,s=>(a(),u("option",{key:s.id,value:s.id},c(s.name),9,re))),128))],34),[[A,i(o).supplier_id]]),i(p).supplier_id?(a(),u("div",le,c(i(p).supplier_id),1)):m("",!0),n.value.supplier_id?(a(),u("div",ne,c(n.value.supplier_id),1)):m("",!0)]),t("div",de,[e[20]||(e[20]=t("label",{class:"form-label"},[_(" Statut "),t("span",{class:"text-danger"},"*")],-1)),v(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>i(o).status=s),required:"",class:f(["form-select",{"is-invalid":i(p).status||n.value.status}]),onBlur:e[4]||(e[4]=s=>b("status",i(o).status)),onChange:e[5]||(e[5]=s=>b("status",i(o).status))},[...e[19]||(e[19]=[t("option",{value:"draft"},"Brouillon",-1),t("option",{value:"sent"},"Envoyé",-1),t("option",{value:"confirmed"},"Confirmé",-1),t("option",{value:"partially_received"},"Partiellement reçu",-1),t("option",{value:"received"},"Reçu",-1),t("option",{value:"cancelled"},"Annulé",-1)])],34),[[A,i(o).status]]),i(p).status?(a(),u("div",ae,c(i(p).status),1)):m("",!0),n.value.status?(a(),u("div",ue,c(n.value.status),1)):m("",!0)]),t("div",ce,[e[21]||(e[21]=t("label",{class:"form-label"},[_(" Date de commande "),t("span",{class:"text-danger"},"*")],-1)),v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>i(o).order_date=s),type:"date",required:"",class:f(["form-control",{"is-invalid":i(p).order_date||n.value.order_date}]),onBlur:e[7]||(e[7]=s=>b("order_date",i(o).order_date)),onInput:e[8]||(e[8]=s=>b("order_date",i(o).order_date))},null,34),[[y,i(o).order_date]]),i(p).order_date?(a(),u("div",pe,c(i(p).order_date),1)):m("",!0),n.value.order_date?(a(),u("div",me,c(n.value.order_date),1)):m("",!0)]),t("div",_e,[e[22]||(e[22]=t("label",{class:"form-label"},"Date de livraison prévue",-1)),v(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>i(o).expected_delivery_date=s),type:"date",class:f(["form-control",{"is-invalid":i(p).expected_delivery_date||n.value.expected_delivery_date}]),onBlur:e[10]||(e[10]=s=>b("expected_delivery_date",i(o).expected_delivery_date)),onInput:e[11]||(e[11]=s=>b("expected_delivery_date",i(o).expected_delivery_date))},null,34),[[y,i(o).expected_delivery_date]]),i(p).expected_delivery_date?(a(),u("div",ve,c(i(p).expected_delivery_date),1)):m("",!0),n.value.expected_delivery_date?(a(),u("div",be,c(n.value.expected_delivery_date),1)):m("",!0)]),t("div",fe,[e[23]||(e[23]=t("label",{class:"form-label"},"Notes",-1)),v(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=s=>i(o).notes=s),rows:"3",class:f(["form-control",{"is-invalid":i(p).notes}]),placeholder:"Ajoutez des notes sur ce bon de commande..."},null,2),[[y,i(o).notes]]),i(p).notes?(a(),u("div",ye,c(i(p).notes),1)):m("",!0)])])])]),t("div",ke,[t("div",{class:"card-header d-flex justify-content-between align-items-center"},[e[26]||(e[26]=t("h5",{class:"card-title mb-0"},"Articles",-1)),t("button",{type:"button",onClick:R,class:"btn btn-primary btn-sm"},[...e[25]||(e[25]=[t("i",{class:"bi bi-plus-circle me-1"},null,-1),_(" Ajouter un article ",-1)])])]),t("div",ge,[i(o).items.length===0?(a(),u("div",qe,[...e[27]||(e[27]=[t("i",{class:"bi bi-cart-x fs-1 mb-3"},null,-1),t("p",null,'Aucun article ajouté. Cliquez sur "Ajouter un article" pour commencer.',-1)])])):(a(),u("div",xe,[(a(!0),u(I,null,L(i(o).items,(s,l)=>(a(),u("div",{key:l,class:"border rounded p-3 mb-3"},[t("div",$e,[t("div",we,[e[29]||(e[29]=t("label",{class:"form-label"},[_("Produit "),t("span",{class:"text-danger"},"*")],-1)),v(t("select",{"onUpdate:modelValue":d=>s.product_id=d,required:"",class:f(["form-select",{"is-invalid":n.value[`items.${l}.product_id`]}]),onChange:d=>{N(l),k(l,"product_id",s.product_id)},onBlur:d=>k(l,"product_id",s.product_id)},[e[28]||(e[28]=t("option",{value:"0"},"Sélectionner un produit",-1)),(a(!0),u(I,null,L(q.products,d=>(a(),u("option",{key:d.id,value:d.id,disabled:g(d.id,l)},[_(c(d.name)+" ",1),g(d.id,l)?(a(),u("span",je," - Déjà sélectionné")):m("",!0)],8,Ve))),128))],42,Ce),[[A,s.product_id]]),n.value[`items.${l}.product_id`]?(a(),u("div",Be,c(n.value[`items.${l}.product_id`]),1)):m("",!0)]),t("div",Ie,[e[30]||(e[30]=t("label",{class:"form-label"},[_("Quantité "),t("span",{class:"text-danger"},"*")],-1)),v(t("input",{"onUpdate:modelValue":d=>s.quantity=d,type:"number",min:"1",required:"",class:f(["form-control",{"is-invalid":n.value[`items.${l}.quantity`]}]),onInput:d=>{$(l),k(l,"quantity",s.quantity)},onBlur:d=>k(l,"quantity",s.quantity)},null,42,Le),[[y,s.quantity,void 0,{number:!0}]]),n.value[`items.${l}.quantity`]?(a(),u("div",Ae,c(n.value[`items.${l}.quantity`]),1)):m("",!0)]),t("div",Ue,[e[31]||(e[31]=t("label",{class:"form-label"},[_("Prix unitaire "),t("span",{class:"text-danger"},"*")],-1)),v(t("input",{"onUpdate:modelValue":d=>s.unit_price=d,type:"number",step:"0.01",min:"0",required:"",class:f(["form-control",{"is-invalid":n.value[`items.${l}.unit_price`]}]),onInput:d=>{$(l),k(l,"unit_price",s.unit_price)},onBlur:d=>k(l,"unit_price",s.unit_price)},null,42,Se),[[y,s.unit_price,void 0,{number:!0}]]),n.value[`items.${l}.unit_price`]?(a(),u("div",he,c(n.value[`items.${l}.unit_price`]),1)):m("",!0)]),t("div",De,[e[32]||(e[32]=t("label",{class:"form-label"},"Total",-1)),t("input",{value:V(s.total_price),type:"text",class:"form-control",readonly:""},null,8,Fe)]),t("div",Te,[t("button",{type:"button",onClick:d=>M(l),class:"btn btn-sm btn-outline-danger"},[...e[33]||(e[33]=[t("i",{class:"bi bi-trash me-1"},null,-1),_(" Supprimer ",-1)])],8,Ee)])])]))),128))]))])])]),t("div",ze,[t("div",Pe,[e[41]||(e[41]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Résumé")],-1)),t("div",Re,[t("div",Me,[t("div",Ne,[e[34]||(e[34]=t("span",null,"Articles:",-1)),t("span",Oe,c(i(o).items.length),1)]),t("div",Ke,[e[35]||(e[35]=t("span",null,"Sous-total:",-1)),t("span",Qe,c(V(C.value)),1)]),t("div",Ge,[e[36]||(e[36]=t("span",null,"Taxes:",-1)),v(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>i(o).tax_amount=s),type:"number",step:"0.01",min:"0",class:"form-control form-control-sm",style:{width:"120px"},onInput:w},null,544),[[y,i(o).tax_amount,void 0,{number:!0}]])]),t("div",He,[e[37]||(e[37]=t("span",null,"Remise:",-1)),v(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>i(o).discount_amount=s),type:"number",step:"0.01",min:"0",class:"form-control form-control-sm",style:{width:"120px"},onInput:w},null,544),[[y,i(o).discount_amount,void 0,{number:!0}]])]),e[39]||(e[39]=t("hr",null,null,-1)),t("div",Je,[e[38]||(e[38]=t("span",{class:"fw-bold"},"Total:",-1)),t("span",We,c(V(h.value)),1)])]),t("div",Xe,[t("button",{type:"button",onClick:O,class:"btn btn-success",disabled:i(j)||i(o).items.length===0},[i(j)?(a(),u("span",Ze)):(a(),u("i",et)),_(" "+c(i(j)?"Création...":"Créer le bon de commande"),1)],8,Ye),F(i(T),{href:i(U)("purchase-orders.index"),class:"btn btn-outline-secondary"},{default:B(()=>[...e[40]||(e[40]=[_(" Annuler ",-1)])]),_:1},8,["href"])])])])])])])]),_:1}))}}),at=X(tt,[["__scopeId","data-v-eb767943"]]);export{at as default};
