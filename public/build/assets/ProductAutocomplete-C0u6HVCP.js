import{d as K,r as v,y as A,B as N,z as U,C as z,b as n,a as l,e as p,m as T,v as $,K as _,n as B,k as g,F as O,g as Q,t as m,o as a}from"./app-DQWaqSr_.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"input-group"},J=["placeholder","disabled","onKeydown"],W={key:0,class:"dropdown-menu show w-100",style:{"max-height":"400px","overflow-y":"auto"}},X=["onMousedown","onMouseenter"],Y={class:"d-flex align-items-center"},Z={class:"flex-shrink-0 me-3"},ee={key:0,class:"bg-light rounded overflow-hidden d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"}},te=["src","alt"],se={key:1,class:"bg-light rounded d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"}},le={class:"flex-grow-1"},ne={class:"d-flex align-items-center justify-content-between"},ae={class:"fw-medium"},oe={class:"text-muted small ms-2"},ie={class:"d-flex align-items-center gap-2 mt-1"},de={key:0,class:"badge bg-danger"},ue={key:1,class:"badge bg-warning text-dark"},ce={key:2,class:"badge bg-success"},re={key:3,class:"badge bg-secondary"},ve={key:1,class:"dropdown-menu show w-100"},me=K({__name:"ProductAutocomplete",props:{products:{},modelValue:{},placeholder:{default:"Rechercher un produit..."},disabled:{type:Boolean,default:!1},excludeProductIds:{default:()=>[]},isInvalid:{type:Boolean,default:!1},isValid:{type:Boolean,default:!1}},emits:["update:modelValue","selected"],setup(f,{expose:C,emit:F}){const c=f,y=F,x=v(null),o=v(""),d=v(!1),i=v(-1),r=v(null),u=A(()=>{if(!o.value)return c.products.filter(s=>!c.excludeProductIds.includes(s.id)).slice(0,10);const t=o.value.toLowerCase();return c.products.filter(s=>{const e=s.name.toLowerCase().includes(t),h=!c.excludeProductIds.includes(s.id);return e&&h}).slice(0,10)}),w=t=>c.excludeProductIds.includes(t),M=()=>{d.value=!0},V=()=>{d.value=!0,i.value=-1},q=()=>{setTimeout(()=>{d.value=!1},200)},b=t=>{w(t.id)||t.stock_quantity<=0||(r.value=t,o.value=t.name,y("update:modelValue",t.id),y("selected",t),d.value=!1)},R=()=>{u.value.length>0&&i.value>=0?b(u.value[i.value]):u.value.length>0&&b(u.value[0])},D=()=>{i.value<u.value.length-1&&i.value++},S=()=>{i.value>0&&i.value--},j=()=>{d.value=!1,i.value=-1},I=()=>{r.value=null,o.value="",y("update:modelValue",null),d.value=!1},L=t=>new Intl.NumberFormat("fr-FR").format(t)+" Fcfa";N(()=>c.modelValue,t=>{if(t&&t>0){const s=c.products.find(e=>e.id===t);s?(r.value=s,o.value=s.name):(r.value=null,o.value="")}else r.value=null,o.value=""},{immediate:!0});const k=v(null),P=t=>{const s=t.target;k.value&&!k.value.contains(s)&&(d.value=!1)};return U(()=>{document.addEventListener("click",P)}),z(()=>{document.removeEventListener("click",P)}),C({focus:()=>x.value?.focus(),clear:I}),(t,s)=>(a(),n("div",{ref_key:"containerRef",ref:k,class:"product-autocomplete position-relative"},[l("div",H,[T(l("input",{ref_key:"inputRef",ref:x,"onUpdate:modelValue":s[0]||(s[0]=e=>o.value=e),type:"text",class:B(["form-control",{"is-invalid":f.isInvalid,"is-valid":f.isValid}]),placeholder:f.placeholder,disabled:f.disabled,onInput:V,onFocus:M,onBlur:q,onKeydown:[_(g(R,["prevent"]),["enter"]),_(g(D,["prevent"]),["arrow-down"]),_(g(S,["prevent"]),["arrow-up"]),_(j,["escape"])]},null,42,J),[[$,o.value]]),r.value?(a(),n("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:I},[...s[1]||(s[1]=[l("i",{class:"bi bi-x"},null,-1)])])):p("",!0)]),d.value&&u.value.length>0?(a(),n("div",W,[(a(!0),n(O,null,Q(u.value,(e,h)=>(a(),n("div",{key:e.id,class:B(["dropdown-item",{active:h===i.value,disabled:w(e.id)||e.stock_quantity<=0}]),onMousedown:g(E=>b(e),["prevent"]),onMouseenter:E=>i.value=h},[l("div",Y,[l("div",Z,[e.image_url?(a(),n("div",ee,[l("img",{src:e.image_url,alt:e.name,class:"img-fluid",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,te)])):(a(),n("div",se,[...s[2]||(s[2]=[l("i",{class:"bi bi-box text-muted"},null,-1)])]))]),l("div",le,[l("div",ne,[l("div",ae,m(e.name),1),l("div",oe,m(L(e.price)),1)]),l("div",ie,[e.stock_quantity<=0?(a(),n("span",de," Rupture de stock ")):e.stock_quantity<=5?(a(),n("span",ue," Stock faible: "+m(e.stock_quantity)+" "+m(e.unit),1)):(a(),n("span",ce," Stock: "+m(e.stock_quantity)+" "+m(e.unit),1)),w(e.id)?(a(),n("span",re," Déjà sélectionné ")):p("",!0)])])])],42,X))),128))])):p("",!0),d.value&&o.value&&u.value.length===0?(a(),n("div",ve,[...s[3]||(s[3]=[l("div",{class:"dropdown-item text-muted"}," Aucun produit trouvé ",-1)])])):p("",!0)],512))}}),pe=G(me,[["__scopeId","data-v-a2ba350a"]]);export{pe as P};
