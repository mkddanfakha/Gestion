import{d as z,i as L,y as D,c as Q,w as x,a as e,t as p,j,u as s,l as C,f as c,m as b,b as i,e as v,n as y,o as r,F as q,g as S,p as U,v as _}from"./app-oFHxr63-.js";import{_ as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-oJPXENP6.js";import{r as h}from"./routes-D3G7R3Tx.js";import{u as H}from"./useSweetAlert-CjcY7Pj8.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BootstrapLayout-CedOSUd9.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const K={class:"d-flex justify-content-between align-items-center mb-4"},W={class:"text-muted mb-0"},X={class:"d-flex gap-2"},Y={class:"row"},Z={class:"col-lg-8"},tt={class:"card mb-4"},et={class:"card-body"},st={class:"row g-3"},ot={class:"col-md-6"},nt=["value"],lt={key:0,class:"invalid-feedback"},rt={class:"col-md-6"},dt={key:0,class:"invalid-feedback"},it={class:"col-md-6"},at={key:0,class:"invalid-feedback"},ut={class:"col-md-6"},ct={key:0,class:"invalid-feedback"},mt={class:"col-12"},pt={key:0,class:"invalid-feedback"},bt={class:"card mb-4"},_t={class:"card-body"},vt={key:0,class:"text-center py-4 text-muted"},ft={key:1},yt={class:"row g-3"},xt={class:"col-md-5"},ht=["onUpdate:modelValue","onChange","onBlur"],gt=["value","disabled"],kt={key:0},wt={class:"col-md-2"},Vt=["onUpdate:modelValue","onInput"],It={class:"col-md-3"},Nt=["onUpdate:modelValue","onInput"],Ot={class:"col-md-2"},jt=["value"],Ct={class:"col-12 text-end"},qt=["onClick"],St={class:"col-lg-4"},Ut={class:"card sticky-top",style:{top:"20px"}},At={class:"card-body"},Tt={class:"mb-3"},Bt={class:"d-flex justify-content-between mb-2"},Ft={class:"fw-medium"},Dt={class:"d-flex justify-content-between mb-2"},Et={class:"fw-medium"},Pt={class:"d-flex justify-content-between mb-2"},$t={class:"d-flex justify-content-between mb-2"},Mt={class:"d-flex justify-content-between"},Rt={class:"fw-bold text-success fs-5"},zt={class:"d-grid gap-2"},Lt=["disabled"],Qt={key:0,class:"spinner-border spinner-border-sm me-2"},Gt={key:1,class:"bi bi-check-circle me-1"},Ht=z({__name:"Edit",props:{purchaseOrder:{},suppliers:{},products:{}},setup(f){const m=f,{success:E,error:A}=H(),T=l=>{if(!l)return"";const t=new Date(l);return isNaN(t.getTime())?"":t.toISOString().split("T")[0]},o=L({supplier_id:m.purchaseOrder.supplier_id,order_date:T(m.purchaseOrder.order_date),expected_delivery_date:T(m.purchaseOrder.expected_delivery_date),status:m.purchaseOrder.status,notes:m.purchaseOrder.notes||"",tax_amount:Number(m.purchaseOrder.tax_amount)||0,discount_amount:Number(m.purchaseOrder.discount_amount)||0,subtotal:Number(m.purchaseOrder.subtotal)||0,total_amount:Number(m.purchaseOrder.total_amount)||0,items:(m.purchaseOrder.items||[]).map(l=>({product_id:l.product_id,quantity:Number(l.quantity)||1,unit_price:Number(l.unit_price)||0,total_price:Number(l.total_price)||0}))}),P=()=>{o.items.push({product_id:0,quantity:1,unit_price:0,total_price:0})},$=l=>{o.items.splice(l,1),w()},M=l=>{const t=o.items[l],n=m.products.find(u=>u.id===t.product_id);n&&(t.unit_price=n.cost_price||n.price,k(l))},g=(l,t)=>o.items.some((n,u)=>n.product_id===l&&u!==t),B=l=>{const t=o.items[l];t.product_id&&g(t.product_id,l)&&(t.product_id=0,t.unit_price=0,t.total_price=0,w(),A("Ce produit est déjà sélectionné dans un autre article."))},k=l=>{const t=o.items[l];t.total_price=t.quantity*t.unit_price,w()},w=()=>{o.subtotal=o.items.reduce((l,t)=>l+t.total_price,0),V()},V=()=>{o.total_amount=o.subtotal+o.tax_amount-o.discount_amount},I=D(()=>o.items.reduce((l,t)=>l+t.total_price,0)),F=D(()=>I.value+o.tax_amount-o.discount_amount),N=l=>new Intl.NumberFormat("fr-FR").format(l)+" Fcfa",R=()=>{o.subtotal=I.value,o.total_amount=F.value,o.put(h("purchase-orders.update",{id:m.purchaseOrder.id}),{onSuccess:()=>{E("Bon de commande modifié avec succès !")},onError:()=>{A("Erreur lors de la modification du bon de commande.")}})},{errors:a,processing:O}=o;return(l,t)=>(r(),Q(G,null,{default:x(()=>[e("div",K,[e("div",null,[t[7]||(t[7]=e("h1",{class:"h2 mb-1"},"Modifier le bon de commande",-1)),e("p",W,p(f.purchaseOrder.po_number),1)]),e("div",X,[j(s(C),{href:s(h)("purchase-orders.show",{id:f.purchaseOrder.id}),class:"btn btn-outline-primary"},{default:x(()=>[...t[8]||(t[8]=[e("i",{class:"bi bi-eye me-1"},null,-1),c(" Voir le bon de commande ",-1)])]),_:1},8,["href"]),j(s(C),{href:s(h)("purchase-orders.index"),class:"btn btn-outline-secondary"},{default:x(()=>[...t[9]||(t[9]=[e("i",{class:"bi bi-arrow-left me-1"},null,-1),c(" Retour à la liste ",-1)])]),_:1},8,["href"])])]),e("form",null,[e("div",Y,[e("div",Z,[e("div",tt,[t[17]||(t[17]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Informations générales")],-1)),e("div",et,[e("div",st,[e("div",ot,[t[11]||(t[11]=e("label",{class:"form-label"},[c(" Fournisseur "),e("span",{class:"text-danger"},"*")],-1)),b(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>s(o).supplier_id=n),required:"",class:y(["form-select",{"is-invalid":s(a).supplier_id}])},[t[10]||(t[10]=e("option",{value:""},"Sélectionner un fournisseur",-1)),(r(!0),i(q,null,S(f.suppliers,n=>(r(),i("option",{key:n.id,value:n.id},p(n.name),9,nt))),128))],2),[[U,s(o).supplier_id]]),s(a).supplier_id?(r(),i("div",lt,p(s(a).supplier_id),1)):v("",!0)]),e("div",rt,[t[13]||(t[13]=e("label",{class:"form-label"},[c(" Statut "),e("span",{class:"text-danger"},"*")],-1)),b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>s(o).status=n),required:"",class:y(["form-select",{"is-invalid":s(a).status}])},[...t[12]||(t[12]=[e("option",{value:"draft"},"Brouillon",-1),e("option",{value:"sent"},"Envoyé",-1),e("option",{value:"confirmed"},"Confirmé",-1),e("option",{value:"partially_received"},"Partiellement reçu",-1),e("option",{value:"received"},"Reçu",-1),e("option",{value:"cancelled"},"Annulé",-1)])],2),[[U,s(o).status]]),s(a).status?(r(),i("div",dt,p(s(a).status),1)):v("",!0)]),e("div",it,[t[14]||(t[14]=e("label",{class:"form-label"},[c(" Date de commande "),e("span",{class:"text-danger"},"*")],-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>s(o).order_date=n),type:"date",required:"",class:y(["form-control",{"is-invalid":s(a).order_date}])},null,2),[[_,s(o).order_date]]),s(a).order_date?(r(),i("div",at,p(s(a).order_date),1)):v("",!0)]),e("div",ut,[t[15]||(t[15]=e("label",{class:"form-label"},"Date de livraison prévue",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>s(o).expected_delivery_date=n),type:"date",class:y(["form-control",{"is-invalid":s(a).expected_delivery_date}])},null,2),[[_,s(o).expected_delivery_date]]),s(a).expected_delivery_date?(r(),i("div",ct,p(s(a).expected_delivery_date),1)):v("",!0)]),e("div",mt,[t[16]||(t[16]=e("label",{class:"form-label"},"Notes",-1)),b(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=n=>s(o).notes=n),rows:"3",class:y(["form-control",{"is-invalid":s(a).notes}]),placeholder:"Ajoutez des notes sur ce bon de commande..."},null,2),[[_,s(o).notes]]),s(a).notes?(r(),i("div",pt,p(s(a).notes),1)):v("",!0)])])])]),e("div",bt,[e("div",{class:"card-header d-flex justify-content-between align-items-center"},[t[19]||(t[19]=e("h5",{class:"card-title mb-0"},"Articles",-1)),e("button",{type:"button",onClick:P,class:"btn btn-primary btn-sm"},[...t[18]||(t[18]=[e("i",{class:"bi bi-plus-circle me-1"},null,-1),c(" Ajouter un article ",-1)])])]),e("div",_t,[s(o).items.length===0?(r(),i("div",vt,[...t[20]||(t[20]=[e("i",{class:"bi bi-cart-x fs-1 mb-3"},null,-1),e("p",null,'Aucun article ajouté. Cliquez sur "Ajouter un article" pour commencer.',-1)])])):(r(),i("div",ft,[(r(!0),i(q,null,S(s(o).items,(n,u)=>(r(),i("div",{key:u,class:"border rounded p-3 mb-3"},[e("div",yt,[e("div",xt,[t[22]||(t[22]=e("label",{class:"form-label"},[c("Produit "),e("span",{class:"text-danger"},"*")],-1)),b(e("select",{"onUpdate:modelValue":d=>n.product_id=d,required:"",class:"form-select",onChange:d=>{M(u),B(u)},onBlur:d=>B(u)},[t[21]||(t[21]=e("option",{value:"0"},"Sélectionner un produit",-1)),(r(!0),i(q,null,S(f.products,d=>(r(),i("option",{key:d.id,value:d.id,disabled:g(d.id,u)},[c(p(d.name)+" ",1),g(d.id,u)?(r(),i("span",kt," - Déjà sélectionné")):v("",!0)],8,gt))),128))],40,ht),[[U,n.product_id]])]),e("div",wt,[t[23]||(t[23]=e("label",{class:"form-label"},[c("Quantité "),e("span",{class:"text-danger"},"*")],-1)),b(e("input",{"onUpdate:modelValue":d=>n.quantity=d,type:"number",min:"1",required:"",class:"form-control",onInput:d=>k(u)},null,40,Vt),[[_,n.quantity,void 0,{number:!0}]])]),e("div",It,[t[24]||(t[24]=e("label",{class:"form-label"},[c("Prix unitaire "),e("span",{class:"text-danger"},"*")],-1)),b(e("input",{"onUpdate:modelValue":d=>n.unit_price=d,type:"number",step:"0.01",min:"0",required:"",class:"form-control",onInput:d=>k(u)},null,40,Nt),[[_,n.unit_price,void 0,{number:!0}]])]),e("div",Ot,[t[25]||(t[25]=e("label",{class:"form-label"},"Total",-1)),e("input",{value:N(n.total_price),type:"text",class:"form-control",readonly:""},null,8,jt)]),e("div",Ct,[e("button",{type:"button",onClick:d=>$(u),class:"btn btn-sm btn-outline-danger"},[...t[26]||(t[26]=[e("i",{class:"bi bi-trash me-1"},null,-1),c(" Supprimer ",-1)])],8,qt)])])]))),128))]))])])]),e("div",St,[e("div",Ut,[t[34]||(t[34]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Résumé")],-1)),e("div",At,[e("div",Tt,[e("div",Bt,[t[27]||(t[27]=e("span",null,"Articles:",-1)),e("span",Ft,p(s(o).items.length),1)]),e("div",Dt,[t[28]||(t[28]=e("span",null,"Sous-total:",-1)),e("span",Et,p(N(I.value)),1)]),e("div",Pt,[t[29]||(t[29]=e("span",null,"Taxes:",-1)),b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>s(o).tax_amount=n),type:"number",step:"0.01",min:"0",class:"form-control form-control-sm",style:{width:"120px"},onInput:V},null,544),[[_,s(o).tax_amount,void 0,{number:!0}]])]),e("div",$t,[t[30]||(t[30]=e("span",null,"Remise:",-1)),b(e("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>s(o).discount_amount=n),type:"number",step:"0.01",min:"0",class:"form-control form-control-sm",style:{width:"120px"},onInput:V},null,544),[[_,s(o).discount_amount,void 0,{number:!0}]])]),t[32]||(t[32]=e("hr",null,null,-1)),e("div",Mt,[t[31]||(t[31]=e("span",{class:"fw-bold"},"Total:",-1)),e("span",Rt,p(N(F.value)),1)])]),e("div",zt,[e("button",{type:"button",onClick:R,class:"btn btn-success",disabled:s(O)||s(o).items.length===0},[s(O)?(r(),i("span",Qt)):(r(),i("i",Gt)),c(" "+p(s(O)?"Modification...":"Modifier le bon de commande"),1)],8,Lt),j(s(C),{href:s(h)("purchase-orders.index"),class:"btn btn-outline-secondary"},{default:x(()=>[...t[33]||(t[33]=[c(" Annuler ",-1)])]),_:1},8,["href"])])])])])])])]),_:1}))}}),ee=J(Ht,[["__scopeId","data-v-b6c44542"]]);export{ee as default};
