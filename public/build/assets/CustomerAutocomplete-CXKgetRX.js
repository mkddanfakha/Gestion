import{d as z,r,y as T,B as E,z as K,C as U,b as o,a as i,e as p,m as N,v as O,J as _,n as M,k as g,F as Q,g as Y,t as y,o as s,A as J,c as X,T as G,s as j}from"./app-CGqa7dvF.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"input-group"},Z=["placeholder","disabled","onKeydown"],ee={key:0,class:"dropdown-menu show w-100",style:{"max-height":"400px","overflow-y":"auto"}},te=["onMousedown","onMouseenter"],le={class:"d-flex align-items-center"},se={class:"flex-shrink-0 me-3"},ne={key:0,class:"bg-light rounded overflow-hidden d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"}},oe=["src","alt"],ae={key:1,class:"bg-light rounded d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"}},ie={class:"flex-grow-1"},ue={class:"d-flex align-items-center justify-content-between"},de={class:"fw-medium"},ce={class:"text-muted small ms-2"},re={class:"d-flex align-items-center gap-2 mt-1"},ve={key:0,class:"badge bg-danger"},fe={key:1,class:"badge bg-warning text-dark"},me={key:2,class:"badge bg-success"},pe={key:3,class:"badge bg-secondary"},he={key:1,class:"dropdown-menu show w-100"},we=z({__name:"ProductAutocomplete",props:{products:{},modelValue:{},placeholder:{default:"Rechercher un produit..."},disabled:{type:Boolean,default:!1},excludeProductIds:{default:()=>[]},isInvalid:{type:Boolean,default:!1},isValid:{type:Boolean,default:!1}},emits:["update:modelValue","selected"],setup(f,{expose:R,emit:F}){const v=f,x=F,b=r(null),d=r(""),a=r(!1),n=r(-1),u=r(null),c=T(()=>{if(!d.value)return v.products.filter(l=>!v.excludeProductIds.includes(l.id)).slice(0,10);const t=d.value.toLowerCase();return v.products.filter(l=>{const e=l.name.toLowerCase().includes(t),w=!v.excludeProductIds.includes(l.id);return e&&w}).slice(0,10)}),m=t=>v.excludeProductIds.includes(t),h=()=>{a.value=!0},C=()=>{a.value=!0,n.value=-1},L=()=>{setTimeout(()=>{a.value=!1},200)},I=t=>{m(t.id)||t.stock_quantity<=0||(u.value=t,d.value=t.name,x("update:modelValue",t.id),x("selected",t),a.value=!1)},D=()=>{c.value.length>0&&n.value>=0?I(c.value[n.value]):c.value.length>0&&I(c.value[0])},B=()=>{n.value<c.value.length-1&&n.value++},q=()=>{n.value>0&&n.value--},S=()=>{a.value=!1,n.value=-1},$=()=>{u.value=null,d.value="",x("update:modelValue",null),a.value=!1},A=t=>new Intl.NumberFormat("fr-FR").format(t)+" Fcfa";E(()=>v.modelValue,t=>{if(t&&t>0){const l=v.products.find(e=>e.id===t);l?(u.value=l,d.value=l.name):(u.value=null,d.value="")}else u.value=null,d.value=""},{immediate:!0});const k=r(null),P=t=>{const l=t.target;k.value&&!k.value.contains(l)&&(a.value=!1)};return K(()=>{document.addEventListener("click",P)}),U(()=>{document.removeEventListener("click",P)}),R({focus:()=>b.value?.focus(),clear:$}),(t,l)=>(s(),o("div",{ref_key:"containerRef",ref:k,class:"product-autocomplete position-relative"},[i("div",W,[N(i("input",{ref_key:"inputRef",ref:b,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value=e),type:"text",class:M(["form-control",{"is-invalid":f.isInvalid,"is-valid":f.isValid}]),placeholder:f.placeholder,disabled:f.disabled,onInput:C,onFocus:h,onBlur:L,onKeydown:[_(g(D,["prevent"]),["enter"]),_(g(B,["prevent"]),["arrow-down"]),_(g(q,["prevent"]),["arrow-up"]),_(S,["escape"])]},null,42,Z),[[O,d.value]]),u.value?(s(),o("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:$},[...l[1]||(l[1]=[i("i",{class:"bi bi-x"},null,-1)])])):p("",!0)]),a.value&&c.value.length>0?(s(),o("div",ee,[(s(!0),o(Q,null,Y(c.value,(e,w)=>(s(),o("div",{key:e.id,class:M(["dropdown-item",{active:w===n.value,disabled:m(e.id)||e.stock_quantity<=0}]),onMousedown:g(V=>I(e),["prevent"]),onMouseenter:V=>n.value=w},[i("div",le,[i("div",se,[e.image_url?(s(),o("div",ne,[i("img",{src:e.image_url,alt:e.name,class:"img-fluid",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,oe)])):(s(),o("div",ae,[...l[2]||(l[2]=[i("i",{class:"bi bi-box text-muted"},null,-1)])]))]),i("div",ie,[i("div",ue,[i("div",de,y(e.name),1),i("div",ce,y(A(e.price)),1)]),i("div",re,[e.stock_quantity<=0?(s(),o("span",ve," Rupture de stock ")):e.stock_quantity<=5?(s(),o("span",fe," Stock faible: "+y(e.stock_quantity)+" "+y(e.unit),1)):(s(),o("span",me," Stock: "+y(e.stock_quantity)+" "+y(e.unit),1)),m(e.id)?(s(),o("span",pe," Déjà sélectionné ")):p("",!0)])])])],42,te))),128))])):p("",!0),a.value&&d.value&&c.value.length===0?(s(),o("div",he,[...l[3]||(l[3]=[i("div",{class:"dropdown-item text-muted"}," Aucun produit trouvé ",-1)])])):p("",!0)],512))}}),Me=H(we,[["__scopeId","data-v-2c8a5d5a"]]),ye={class:"input-group"},_e=["placeholder","disabled","onKeydown"],ge=["onMousedown","onMouseenter"],xe={class:"d-flex align-items-center justify-content-between"},ke={class:"fw-medium"},be={key:0,class:"text-muted small mt-1"},Ce={key:0},Ie={key:1},Be={key:2},Pe=z({__name:"CustomerAutocomplete",props:{customers:{},modelValue:{},placeholder:{default:"Rechercher un client..."},disabled:{type:Boolean,default:!1},isInvalid:{type:Boolean,default:!1},isValid:{type:Boolean,default:!1}},emits:["update:modelValue","selected"],setup(f,{expose:R,emit:F}){const v=f,x=F,b=r(null),d=r(null),a=r(""),n=r(!1),u=r(-1),c=r(null),m=r({top:0,left:0,width:0}),h=T(()=>{if(!a.value)return v.customers.slice(0,10);const t=a.value.toLowerCase();return v.customers.filter(l=>{const e=l.name.toLowerCase().includes(t),w=l.email?.toLowerCase().includes(t)||!1,V=l.phone?.toLowerCase().includes(t)||!1;return e||w||V}).slice(0,10)}),C=()=>{if(d.value){const t=d.value.getBoundingClientRect();m.value={top:t.bottom+window.scrollY,left:t.left+window.scrollX,width:t.width}}},L=()=>{C(),n.value=!0},I=()=>{C(),n.value=!0,u.value=-1},D=()=>{setTimeout(()=>{n.value=!1},200)},B=t=>{c.value=t,a.value=t.name,x("update:modelValue",t.id),x("selected",t),n.value=!1},q=()=>{h.value.length>0&&u.value>=0?B(h.value[u.value]):h.value.length>0&&B(h.value[0])},S=()=>{u.value<h.value.length-1&&u.value++},$=()=>{u.value>0&&u.value--},A=()=>{n.value=!1,u.value=-1},k=()=>{c.value=null,a.value="",x("update:modelValue",null),n.value=!1};E(()=>v.modelValue,t=>{if(t&&t>0){const l=v.customers.find(e=>e.id===t);l?(c.value=l,a.value=l.name):(c.value=null,a.value="")}else c.value=null,a.value=""},{immediate:!0}),E(n,t=>{t&&J(()=>{C()})});const P=t=>{const l=t.target;if(d.value&&!d.value.contains(l)){const e=document.querySelector(".customer-dropdown-menu");e&&!e.contains(l)?n.value=!1:e||(n.value=!1)}};return K(()=>{document.addEventListener("click",P)}),U(()=>{document.removeEventListener("click",P)}),R({focus:()=>b.value?.focus(),clear:k}),(t,l)=>(s(),o("div",{ref_key:"containerRef",ref:d,class:"customer-autocomplete position-relative",style:{"z-index":"1"}},[i("div",ye,[N(i("input",{ref_key:"inputRef",ref:b,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e),type:"text",class:M(["form-control",{"is-invalid":f.isInvalid,"is-valid":f.isValid}]),placeholder:f.placeholder,disabled:f.disabled,onInput:I,onFocus:L,onBlur:D,onKeydown:[_(g(q,["prevent"]),["enter"]),_(g(S,["prevent"]),["arrow-down"]),_(g($,["prevent"]),["arrow-up"]),_(A,["escape"])]},null,42,_e),[[O,a.value]]),c.value?(s(),o("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:k},[...l[1]||(l[1]=[i("i",{class:"bi bi-x"},null,-1)])])):p("",!0)]),(s(),X(G,{to:"body"},[n.value&&h.value.length>0?(s(),o("div",{key:0,class:"customer-dropdown-menu",style:j({position:"absolute",top:m.value.top+"px",left:m.value.left+"px",width:m.value.width+"px",zIndex:1050,maxHeight:"300px",overflowY:"auto"})},[(s(!0),o(Q,null,Y(h.value,(e,w)=>(s(),o("div",{key:e.id,class:M(["dropdown-item",{active:w===u.value}]),onMousedown:g(V=>B(e),["prevent"]),onMouseenter:V=>u.value=w},[i("div",xe,[i("div",null,[i("div",ke,y(e.name),1),e.email||e.phone?(s(),o("div",be,[e.email?(s(),o("span",Ce,y(e.email),1)):p("",!0),e.email&&e.phone?(s(),o("span",Ie," • ")):p("",!0),e.phone?(s(),o("span",Be,y(e.phone),1)):p("",!0)])):p("",!0)])])],42,ge))),128))],4)):p("",!0),n.value&&a.value&&h.value.length===0?(s(),o("div",{key:1,class:"customer-dropdown-menu",style:j({position:"absolute",top:m.value.top+"px",left:m.value.left+"px",width:m.value.width+"px",zIndex:1050})},[...l[2]||(l[2]=[i("div",{class:"dropdown-item text-muted"}," Aucun client trouvé ",-1)])],4)):p("",!0)]))],512))}}),Re=H(Pe,[["__scopeId","data-v-7c3f5752"]]);export{Re as C,Me as P};
