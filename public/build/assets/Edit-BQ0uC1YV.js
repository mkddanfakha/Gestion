import{d as T,r as S,y as I,i as O,c as W,w,a as t,t as u,j as V,u as o,l as P,f as _,m as v,b as n,e as d,n as f,v as b,o as r,F as R,g as Z,p as E,q as J,h as X}from"./app-oFHxr63-.js";import{_ as Q}from"./AppLayout.vue_vue_type_script_setup_true_lang-oJPXENP6.js";import{r as x}from"./routes-D3G7R3Tx.js";import{u as H}from"./useSweetAlert-CjcY7Pj8.js";import{u as Y}from"./BootstrapLayout-CedOSUd9.js";import{F as ee}from"./FilePondImageUpload-RSew1jKd.js";import"./sweetalert2.esm.all-NNS-RXd7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"d-flex justify-content-between align-items-center mb-4"},se={class:"text-muted mb-0"},ie={class:"d-flex gap-2"},oe={class:"row justify-content-center"},ae={class:"col-lg-10"},le={class:"card mb-4"},re={class:"card-body"},ne={class:"row g-3"},de={class:"col-md-6"},ue={key:0,class:"invalid-feedback"},ce={key:1,class:"invalid-feedback"},pe={class:"col-md-6"},me=["value"],ve={key:0,class:"invalid-feedback"},fe={key:1,class:"invalid-feedback"},_e={class:"col-md-6"},be={class:"input-group"},ke=["disabled"],ge={key:0,class:"spinner-border spinner-border-sm me-1"},ye={key:0,class:"text-danger small"},he={class:"col-md-6"},xe={key:0,class:"invalid-feedback"},qe={class:"col-12"},Se={key:0,class:"invalid-feedback"},Ue={class:"card mb-4"},Le={class:"card-body"},we={class:"row g-3"},Ve={class:"col-md-4"},Fe={class:"input-group"},Ce={key:0,class:"invalid-feedback"},Pe={key:1,class:"invalid-feedback"},Ee={class:"col-md-4"},Ne={class:"input-group"},je={key:0,class:"invalid-feedback"},Me={class:"col-md-4"},Ie={key:0,class:"invalid-feedback"},ze={key:0,class:"col-md-6"},$e={key:0,class:"invalid-feedback"},De={key:1,class:"col-md-6"},Be={key:0,class:"invalid-feedback"},Ae={key:2,class:"col-md-6"},Ke=["value"],Ge={key:3,class:"col-md-6"},Te=["value"],Oe={class:"row g-3 mt-2"},We={class:"col-md-6"},Re={key:0,class:"invalid-feedback"},Ze={class:"card mb-4"},Je={class:"card-body"},Xe={class:"row g-3"},Qe={class:"col-md-6"},He={key:0,class:"invalid-feedback"},Ye={key:0,class:"col-md-6"},et={class:"row g-2"},tt={class:"col-6"},st={key:0,class:"invalid-feedback"},it={class:"col-6"},ot={key:0,class:"invalid-feedback"},at={class:"card mb-4"},lt={class:"card-body"},rt={class:"card mb-4"},nt={class:"card-body"},dt={class:"form-check form-switch"},ut={class:"d-flex gap-2"},ct=["disabled"],pt={key:0,class:"spinner-border spinner-border-sm me-2"},mt={key:1,class:"bi bi-check-circle me-1"},xt=T({__name:"Edit",props:{product:{},categories:{},images:{default:()=>[]},uploadUrl:{default:()=>x("products.upload-image")}},setup(g){const{isVendeur:U}=Y(),c=g,{success:N,error:L}=H(),m=S({}),z=l=>({name:"Nom du produit",description:"Description",sku:"SKU",barcode:"Code-barres",price:"Prix",cost_price:"Prix de revient",stock_quantity:"Quantité en stock",min_stock_level:"Stock minimum",unit:"Unité",location:"Emplacement",category_id:"Catégorie",is_active:"Statut",expiration_date:"Date d'expiration",alert_threshold_value:"Valeur du seuil d'alerte",alert_threshold_unit:"Unité du seuil d'alerte",images:"Images",delete_images:"Images à supprimer"})[l]||l,$=()=>{const l={};return(!s.name||s.name.trim().length<2)&&(l.name="Le nom du produit est requis (minimum 2 caractères)"),s.name&&s.name.length>255&&(l.name="Le nom ne peut pas dépasser 255 caractères"),s.sku&&s.sku.length>6&&(l.sku="Le SKU ne peut pas dépasser 6 caractères"),s.sku&&!/^[A-Z]{2}[0-9]{4}$/.test(s.sku)&&(l.sku="Le SKU doit être au format CCNNNN (2 lettres majuscules + 4 chiffres)"),s.barcode&&s.barcode.length>255&&(l.barcode="Le code-barres ne peut pas dépasser 255 caractères"),s.barcode&&!/^[a-zA-Z0-9]+$/.test(s.barcode)&&(l.barcode="Le code-barres ne peut contenir que des caractères alphanumériques"),(!s.price||s.price<0)&&(l.price="Le prix est requis et doit être positif"),s.cost_price<0&&(l.cost_price="Le prix de revient ne peut pas être négatif"),(!s.stock_quantity||s.stock_quantity<0)&&(l.stock_quantity="La quantité en stock est requise et doit être positive"),(!s.min_stock_level||s.min_stock_level<0)&&(l.min_stock_level="Le niveau de stock minimum est requis et doit être positif"),(!s.unit||s.unit.length>50)&&(l.unit="L'unité est requise et ne peut pas dépasser 50 caractères"),s.category_id||(l.category_id="La catégorie est requise"),Object.keys(l).length===0?null:l},y=(l,e)=>{m.value[l]&&delete m.value[l];let i="";switch(l){case"name":!e||e.trim().length<2?i="Le nom du produit est requis (minimum 2 caractères)":e.length>255&&(i="Le nom ne peut pas dépasser 255 caractères");break;case"sku":e&&e.length>6?i="Le SKU ne peut pas dépasser 6 caractères":e&&!/^[A-Z]{2}[0-9]{4}$/.test(e)&&(i="Le SKU doit être au format CCNNNN (2 lettres majuscules + 4 chiffres)");break;case"barcode":e&&e.length>255?i="Le code-barres ne peut pas dépasser 255 caractères":e&&!/^[a-zA-Z0-9]+$/.test(e)&&(i="Le code-barres ne peut contenir que des caractères alphanumériques");break;case"price":(!e||e<0)&&(i="Le prix est requis et doit être positif");break;case"cost_price":e<0&&(i="Le prix de revient ne peut pas être négatif");break;case"stock_quantity":(!e||e<0)&&(i="La quantité en stock est requise et doit être positive");break;case"min_stock_level":(!e||e<0)&&(i="Le niveau de stock minimum est requis et doit être positif");break;case"unit":(!e||e.length>50)&&(i="L'unité est requise et ne peut pas dépasser 50 caractères");break;case"category_id":e||(i="La catégorie est requise");break}i&&(m.value[l]=i)},D=S(null),j=S([]),F=S([]),B=I(()=>c.images.map(l=>({source:l.url.startsWith("http")?l.url:l.url.startsWith("/")?window.location.origin+l.url:l.url,options:{type:"limbo"}}))),A=l=>{j.value=l.filter(p=>{const h=p.file instanceof File,k=p.source,M=k&&typeof k=="string"&&(k.startsWith("http")||k.startsWith("/"));return h&&!M}).map(p=>p.file);const e=c.images.map(p=>p.id),i=l.map(p=>p.source).filter(p=>typeof p=="string"&&(p.startsWith("http")||p.startsWith("/")));F.value=e.filter(p=>{const h=c.images.find(k=>k.id===p);return h&&!i.includes(h.url)})},q=S(!1),s=O({name:c.product.name,description:c.product.description||"",sku:c.product.sku,barcode:c.product.barcode||"",price:c.product.price,cost_price:c.product.cost_price||0,stock_quantity:c.product.stock_quantity,min_stock_level:c.product.min_stock_level,unit:c.product.unit,location:c.product.location||"",is_active:c.product.is_active,category_id:c.product.category_id,expiration_date:c.product.expiration_date?new Date(c.product.expiration_date).toISOString().split("T")[0]:"",alert_threshold_value:c.product.alert_threshold_value||null,alert_threshold_unit:c.product.alert_threshold_unit||""}),K=async()=>{if(!(!s.name||!s.category_id)){q.value=!0;try{const l=await fetch(x("products.generate-sku"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({name:s.name,category_id:s.category_id})});if(l.ok){const e=await l.json();s.sku=e.sku}}catch(l){console.error("Erreur lors de la génération du SKU:",l)}finally{q.value=!1}}},G=()=>{m.value={};const l=$();if(l){m.value=l;return}const e=new FormData;if(e.append("_method","PUT"),e.append("name",s.name||""),e.append("description",s.description||""),e.append("sku",s.sku||""),e.append("barcode",s.barcode||""),e.append("price",String(s.price||0)),s.cost_price!==null&&s.cost_price!==void 0&&e.append("cost_price",String(s.cost_price)),e.append("stock_quantity",String(s.stock_quantity||0)),e.append("min_stock_level",String(s.min_stock_level||0)),e.append("unit",s.unit||""),s.location&&e.append("location",s.location),e.append("category_id",String(s.category_id||"")),e.append("is_active",s.is_active?"1":"0"),s.expiration_date&&s.expiration_date.trim()!==""?e.append("expiration_date",s.expiration_date):e.append("expiration_date",""),s.alert_threshold_value!==null&&s.alert_threshold_value!==void 0&&e.append("alert_threshold_value",String(s.alert_threshold_value)),s.alert_threshold_unit&&e.append("alert_threshold_unit",s.alert_threshold_unit),j.value.forEach(i=>{i instanceof File&&e.append("images[]",i)}),F.value.length>0&&F.value.forEach(i=>{e.append("delete_images[]",String(i))}),!s.name||!s.sku||!s.price||!s.stock_quantity||!s.min_stock_level||!s.unit||!s.category_id){L("Veuillez remplir tous les champs requis.");return}try{X.post(x("products.update",{id:c.product.id}),e,{forceFormData:!0,preserveScroll:!0,onSuccess:i=>{const p=i.props?.flash;p?.success?N(p.success):N("Produit modifié avec succès !"),m.value={}},onError:i=>{if(i&&typeof i=="object"&&Object.keys(i).length>0){const p=Object.entries(i).map(([h,k])=>`<strong>${z(h)}:</strong> ${k}`).join("<br>");L(p)}else L("Erreur lors de la modification du produit.")}})}catch{L("Une erreur inattendue s'est produite lors de la modification du produit.")}},{processing:C}=s,a=I(()=>s.errors);return(l,e)=>(r(),W(Q,null,{default:w(()=>[t("div",te,[t("div",null,[e[21]||(e[21]=t("h1",{class:"h2 mb-1"},"Modifier le produit",-1)),t("p",se,u(g.product.name),1)]),t("div",ie,[V(o(P),{href:o(x)("products.show",{id:g.product.id}),class:"btn btn-outline-primary"},{default:w(()=>[...e[22]||(e[22]=[t("i",{class:"bi bi-eye me-1"},null,-1),_(" Voir le produit ",-1)])]),_:1},8,["href"]),V(o(P),{href:o(x)("products.index"),class:"btn btn-outline-secondary"},{default:w(()=>[...e[23]||(e[23]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),_(" Retour à la liste ",-1)])]),_:1},8,["href"])])]),t("form",null,[t("div",oe,[t("div",ae,[t("div",le,[e[30]||(e[30]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Informations générales")],-1)),t("div",re,[t("div",ne,[t("div",de,[e[24]||(e[24]=t("label",{class:"form-label"},[_(" Nom du produit "),t("span",{class:"text-danger"},"*")],-1)),v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>o(s).name=i),type:"text",required:"",class:f(["form-control",{"is-invalid":a.value.name||m.value.name}]),onBlur:e[1]||(e[1]=i=>y("name",o(s).name)),onInput:e[2]||(e[2]=i=>y("name",o(s).name))},null,34),[[b,o(s).name]]),a.value.name?(r(),n("div",ue,u(a.value.name),1)):d("",!0),m.value.name?(r(),n("div",ce,u(m.value.name),1)):d("",!0)]),t("div",pe,[e[26]||(e[26]=t("label",{class:"form-label"},[_(" Catégorie "),t("span",{class:"text-danger"},"*")],-1)),v(t("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>o(s).category_id=i),required:"",class:f(["form-select",{"is-invalid":a.value.category_id||m.value.category_id}]),onBlur:e[4]||(e[4]=i=>y("category_id",o(s).category_id)),onChange:e[5]||(e[5]=i=>y("category_id",o(s).category_id))},[e[25]||(e[25]=t("option",{value:""},"Sélectionner une catégorie",-1)),(r(!0),n(R,null,Z(g.categories,i=>(r(),n("option",{key:i.id,value:i.id},u(i.name),9,me))),128))],34),[[E,o(s).category_id]]),a.value.category_id?(r(),n("div",ve,u(a.value.category_id),1)):d("",!0),m.value.category_id?(r(),n("div",fe,u(m.value.category_id),1)):d("",!0)]),t("div",_e,[e[27]||(e[27]=t("label",{class:"form-label"},[_(" SKU "),t("span",{class:"text-danger"},"*")],-1)),t("div",be,[v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>o(s).sku=i),type:"text",required:"",class:f(["form-control font-monospace",{"is-invalid":a.value.sku}])},null,2),[[b,o(s).sku]]),t("button",{type:"button",onClick:K,disabled:!o(s).name||!o(s).category_id||q.value,class:"btn btn-outline-primary"},[q.value?(r(),n("span",ge)):d("",!0),_(" "+u(q.value?"Génération...":"Générer"),1)],8,ke)]),a.value.sku?(r(),n("div",ye,u(a.value.sku),1)):d("",!0)]),t("div",he,[e[28]||(e[28]=t("label",{class:"form-label"},"Code-barres",-1)),v(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>o(s).barcode=i),type:"text",class:f(["form-control font-monospace",{"is-invalid":a.value.barcode}])},null,2),[[b,o(s).barcode]]),a.value.barcode?(r(),n("div",xe,u(a.value.barcode),1)):d("",!0)]),t("div",qe,[e[29]||(e[29]=t("label",{class:"form-label"},"Description",-1)),v(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=i=>o(s).description=i),rows:"3",class:f(["form-control",{"is-invalid":a.value.description}])},null,2),[[b,o(s).description]]),a.value.description?(r(),n("div",Se,u(a.value.description),1)):d("",!0)])])])]),t("div",Ue,[e[45]||(e[45]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Prix et stock")],-1)),t("div",Le,[t("div",we,[t("div",Ve,[e[32]||(e[32]=t("label",{class:"form-label"},[_(" Prix de vente "),t("span",{class:"text-danger"},"*")],-1)),t("div",Fe,[v(t("input",{"onUpdate:modelValue":e[9]||(e[9]=i=>o(s).price=i),type:"number",step:"0.01",min:"0",required:"",class:f(["form-control",{"is-invalid":a.value.price||m.value.price}]),onBlur:e[10]||(e[10]=i=>y("price",o(s).price)),onInput:e[11]||(e[11]=i=>y("price",o(s).price))},null,34),[[b,o(s).price]]),e[31]||(e[31]=t("span",{class:"input-group-text"},"Fcfa",-1))]),a.value.price?(r(),n("div",Ce,u(a.value.price),1)):d("",!0),m.value.price?(r(),n("div",Pe,u(m.value.price),1)):d("",!0)]),t("div",Ee,[e[34]||(e[34]=t("label",{class:"form-label"},"Prix de revient",-1)),t("div",Ne,[v(t("input",{"onUpdate:modelValue":e[12]||(e[12]=i=>o(s).cost_price=i),type:"number",step:"0.01",min:"0",class:f(["form-control",{"is-invalid":a.value.cost_price}])},null,2),[[b,o(s).cost_price]]),e[33]||(e[33]=t("span",{class:"input-group-text"},"Fcfa",-1))]),a.value.cost_price?(r(),n("div",je,u(a.value.cost_price),1)):d("",!0)]),t("div",Me,[e[36]||(e[36]=t("label",{class:"form-label"},"Unité",-1)),v(t("select",{"onUpdate:modelValue":e[13]||(e[13]=i=>o(s).unit=i),class:f(["form-select",{"is-invalid":a.value.unit}])},[...e[35]||(e[35]=[t("option",{value:"pièce"},"Pièce",-1),t("option",{value:"kg"},"Kilogramme",-1),t("option",{value:"g"},"Gramme",-1),t("option",{value:"L"},"Litre",-1),t("option",{value:"mL"},"Millilitre",-1),t("option",{value:"m"},"Mètre",-1),t("option",{value:"cm"},"Centimètre",-1),t("option",{value:"m²"},"Mètre carré",-1),t("option",{value:"m³"},"Mètre cube",-1),t("option",{value:"boîte"},"Boîte",-1),t("option",{value:"paquet"},"Paquet",-1),t("option",{value:"lot"},"Lot",-1)])],2),[[E,o(s).unit]]),a.value.unit?(r(),n("div",Ie,u(a.value.unit),1)):d("",!0)]),o(U)?d("",!0):(r(),n("div",ze,[e[37]||(e[37]=t("label",{class:"form-label"},[_(" Stock actuel "),t("span",{class:"text-danger"},"*")],-1)),v(t("input",{"onUpdate:modelValue":e[14]||(e[14]=i=>o(s).stock_quantity=i),type:"number",min:"0",required:"",class:f(["form-control",{"is-invalid":a.value.stock_quantity}])},null,2),[[b,o(s).stock_quantity]]),a.value.stock_quantity?(r(),n("div",$e,u(a.value.stock_quantity),1)):d("",!0)])),o(U)?d("",!0):(r(),n("div",De,[e[38]||(e[38]=t("label",{class:"form-label"},[_(" Stock minimum "),t("span",{class:"text-danger"},"*")],-1)),v(t("input",{"onUpdate:modelValue":e[15]||(e[15]=i=>o(s).min_stock_level=i),type:"number",min:"0",required:"",class:f(["form-control",{"is-invalid":a.value.min_stock_level}])},null,2),[[b,o(s).min_stock_level]]),a.value.min_stock_level?(r(),n("div",Be,u(a.value.min_stock_level),1)):d("",!0)])),o(U)?(r(),n("div",Ae,[e[39]||(e[39]=t("label",{class:"form-label"},"Stock actuel",-1)),t("input",{value:g.product.stock_quantity,type:"number",disabled:"",class:"form-control bg-light"},null,8,Ke),e[40]||(e[40]=t("small",{class:"form-text text-muted"},"Vous ne pouvez pas modifier le stock",-1))])):d("",!0),o(U)?(r(),n("div",Ge,[e[41]||(e[41]=t("label",{class:"form-label"},"Stock minimum",-1)),t("input",{value:g.product.min_stock_level,type:"number",disabled:"",class:"form-control bg-light"},null,8,Te),e[42]||(e[42]=t("small",{class:"form-text text-muted"},"Vous ne pouvez pas modifier le stock minimum",-1))])):d("",!0)]),t("div",Oe,[t("div",We,[e[43]||(e[43]=t("label",{class:"form-label"},"Emplacement (optionnel)",-1)),v(t("input",{"onUpdate:modelValue":e[16]||(e[16]=i=>o(s).location=i),type:"text",class:f(["form-control",{"is-invalid":a.value.location}]),placeholder:"Ex: Rayon A, Étagère 3, etc."},null,2),[[b,o(s).location]]),a.value.location?(r(),n("div",Re,u(a.value.location),1)):d("",!0),e[44]||(e[44]=t("small",{class:"form-text text-muted"},"Emplacement du produit dans le magasin",-1))])])])]),t("div",Ze,[e[51]||(e[51]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Date d'expiration et alerte")],-1)),t("div",Je,[t("div",Xe,[t("div",Qe,[e[46]||(e[46]=t("label",{class:"form-label"},"Date d'expiration (optionnel)",-1)),v(t("input",{"onUpdate:modelValue":e[17]||(e[17]=i=>o(s).expiration_date=i),type:"date",class:f(["form-control",{"is-invalid":a.value.expiration_date}])},null,2),[[b,o(s).expiration_date]]),a.value.expiration_date?(r(),n("div",He,u(a.value.expiration_date),1)):d("",!0),e[47]||(e[47]=t("small",{class:"form-text text-muted"},"Date à laquelle le produit expire",-1))]),o(s).expiration_date?(r(),n("div",Ye,[e[49]||(e[49]=t("label",{class:"form-label"},"Seuil d'alerte",-1)),t("div",et,[t("div",tt,[v(t("input",{"onUpdate:modelValue":e[18]||(e[18]=i=>o(s).alert_threshold_value=i),type:"number",min:"1",class:f(["form-control",{"is-invalid":a.value.alert_threshold_value}]),placeholder:"Nombre"},null,2),[[b,o(s).alert_threshold_value,void 0,{number:!0}]]),a.value.alert_threshold_value?(r(),n("div",st,u(a.value.alert_threshold_value),1)):d("",!0)]),t("div",it,[v(t("select",{"onUpdate:modelValue":e[19]||(e[19]=i=>o(s).alert_threshold_unit=i),class:f(["form-select",{"is-invalid":a.value.alert_threshold_unit}])},[...e[48]||(e[48]=[t("option",{value:""},"Unité",-1),t("option",{value:"days"},"Jours",-1),t("option",{value:"weeks"},"Semaines",-1),t("option",{value:"months"},"Mois",-1)])],2),[[E,o(s).alert_threshold_unit]]),a.value.alert_threshold_unit?(r(),n("div",ot,u(a.value.alert_threshold_unit),1)):d("",!0)])]),e[50]||(e[50]=t("small",{class:"form-text text-muted"},"Alerter X jours/semaines/mois avant l'expiration",-1))])):d("",!0)])])]),t("div",at,[e[53]||(e[53]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Image du produit")],-1)),t("div",lt,[V(ee,{ref_key:"filePondRef",ref:D,name:"images","accepted-file-types":["image/jpeg","image/png","image/jpg","image/gif","image/webp"],"max-file-size":"5MB","max-files":1,"allow-multiple":!1,"image-resize-target-width":1200,"image-resize-target-height":1200,"image-resize-mode":"contain","image-resize-upscale":!1,"label-idle":"Glissez-déposez une image ou <span class='filepond--label-action'>Parcourir</span>",credits:!1,files:B.value,"onUpdate:files":A},null,8,["files"]),e[52]||(e[52]=t("small",{class:"form-text text-muted mt-2 d-block"}," Formats acceptés: JPG, PNG, GIF, WEBP. Taille max: 5 Mo. ",-1))])]),t("div",rt,[e[56]||(e[56]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Statut")],-1)),t("div",nt,[t("div",dt,[v(t("input",{"onUpdate:modelValue":e[20]||(e[20]=i=>o(s).is_active=i),class:"form-check-input",type:"checkbox",id:"is_active"},null,512),[[J,o(s).is_active]]),e[54]||(e[54]=t("label",{class:"form-check-label",for:"is_active"}," Produit actif ",-1)),e[55]||(e[55]=t("div",{class:"form-text"}," Un produit inactif ne sera pas visible dans les ventes ",-1))])])]),t("div",ut,[t("button",{type:"button",onClick:G,class:"btn btn-primary",disabled:o(C)},[o(C)?(r(),n("span",pt)):(r(),n("i",mt)),_(" "+u(o(C)?"Modification...":"Modifier le produit"),1)],8,ct),V(o(P),{href:o(x)("products.index"),class:"btn btn-outline-secondary"},{default:w(()=>[...e[57]||(e[57]=[_(" Annuler ",-1)])]),_:1},8,["href"])])])])])]),_:1}))}});export{xt as default};
