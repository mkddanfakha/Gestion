import{_ as D}from"./AppLayout.vue_vue_type_script_setup_true_lang-CUowRV7B.js";import{d as U,r as x,c as k,w as g,a as s,t as l,j as C,u as b,l as p,f,b as d,e as _,o,F as V,g as A,s as M,n as j,h as F}from"./app-CGqa7dvF.js";import{r as v}from"./routes-Ds1K_LXc.js";import{u as O}from"./useSweetAlert-CjcY7Pj8.js";import"./BootstrapLayout-L_TowVZG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const B={class:"d-flex justify-content-between align-items-center mb-4"},$={class:"h2 mb-1"},q={class:"d-flex gap-2"},z={class:"row g-4"},W={class:"col-lg-8"},Q={class:"card mb-4"},G={class:"card-body"},H={class:"row g-3"},J={class:"col-md-6"},K={class:"mb-0 font-monospace"},X={class:"col-md-6"},Y={class:"mb-0"},Z={class:"col-md-6"},ss={class:"mb-0"},es={key:1,class:"text-muted"},ts={class:"col-md-6"},ls={class:"mb-0"},as={class:"col-md-6"},ns={class:"mb-0"},os={class:"badge bg-info"},ds={class:"col-md-6"},is={class:"mb-0 fw-bold text-success fs-5"},rs={key:0,class:"col-md-6"},cs={class:"mb-0"},us={key:0,class:"mt-4 pt-3 border-top"},ms={class:"bg-light p-3 rounded"},bs={class:"mb-0"},fs={class:"card"},vs={class:"card-body"},hs={key:0,class:"text-center py-4 text-muted"},gs={key:1,class:"table-responsive"},_s={class:"table table-hover mb-0"},ys={class:"align-middle"},ps={class:"d-flex align-items-center"},ws={class:"flex-shrink-0 me-3"},xs={key:0,class:"bg-light rounded overflow-hidden d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},ks=["src","alt"],Cs={key:1,class:"bg-light rounded d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},js={class:"fw-medium"},Ss={class:"text-muted small"},Es={class:"align-middle"},Rs={key:1,class:"badge bg-secondary"},Ls={class:"align-middle"},Ps={class:"fw-medium"},Is={class:"text-muted ms-1"},Ns={class:"align-middle"},Ts={class:"align-middle fw-medium text-success"},Ds={class:"col-lg-4"},Us={class:"card mb-4"},Vs={class:"card-body"},As={class:"d-flex justify-content-between mb-2"},Ms={class:"fw-medium"},Fs={class:"d-flex justify-content-between mb-2"},Os={class:"fw-medium"},Bs={class:"d-flex justify-content-between mb-2"},$s={class:"fw-medium"},qs={key:0,class:"d-flex justify-content-between mb-2"},zs={class:"fw-medium text-primary"},Ws={key:1,class:"d-flex justify-content-between mb-2"},Qs={class:"fw-medium text-warning"},Gs={class:"d-flex justify-content-between mb-2"},Hs={class:"fw-medium"},Js={class:"d-flex justify-content-between mb-3"},Ks={class:"fw-bold text-success fs-5"},Xs={class:"card mb-4"},Ys={class:"card-body"},Zs={class:"d-grid gap-2"},se=["disabled"],ee={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},te={key:1,class:"bi bi-download me-1"},le=["disabled"],ae={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},ne={key:1,class:"bi bi-printer me-1"},oe=["disabled"],de={class:"card"},ie={class:"card-body"},re={class:"row g-3 text-center"},ce={class:"col-6"},ue={class:"p-2 bg-light rounded"},me={class:"fw-bold text-primary"},be={class:"col-6"},fe={class:"p-2 bg-light rounded"},ve={class:"fw-bold text-success"},ke=U({__name:"Show",props:{sale:{}},setup(t){const{success:S,error:y,confirm:E}=O(),r=x(!1),i=x(!1),m=t,c=a=>new Intl.NumberFormat("fr-FR").format(a)+" Fcfa",w=a=>new Date(a).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=a=>({cash:"Espèces",card:"Carte",bank_transfer:"Virement bancaire",check:"Chèque",orange_money:"Orange Money",wave:"Wave"})[a]||a,L=a=>({paid:"Payé",partial:"Paiement partiel",pending:"En attente"})[a]||a,P=a=>({paid:"badge bg-success",partial:"badge bg-warning",pending:"badge bg-danger"})[a]||"badge bg-secondary",I=async()=>{await E(`Êtes-vous sûr de vouloir supprimer la vente "${m.sale.sale_number}" ?`)&&F.delete(v("sales.destroy",{id:m.sale.id}),{onSuccess:()=>{S(`Vente "${m.sale.sale_number}" supprimée avec succès !`)},onError:e=>{const n=e.message||"Erreur lors de la suppression de la vente.";y(n)}})},N=async()=>{if(!r.value){r.value=!0;try{const a=v("sales.invoice.download",{sale:m.sale.id}),e=await fetch(a);if(!e.ok)throw new Error("Erreur lors du téléchargement");const n=await e.blob(),h=window.URL.createObjectURL(n),u=document.createElement("a");u.href=h,u.download=`facture_${m.sale.sale_number}.pdf`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(h),setTimeout(()=>{r.value=!1},500)}catch{r.value=!1,y("Erreur lors du téléchargement de la facture")}}},T=async()=>{if(!i.value){i.value=!0;try{const a=v("sales.invoice.print",{sale:m.sale.id}),e=await fetch(a);if(!e.ok)throw new Error("Erreur lors du chargement");const n=await e.blob(),h=window.URL.createObjectURL(n),u=window.open(h,"_blank");u?u.onload=()=>{setTimeout(()=>{u.print(),i.value=!1},500)}:window.location.href=a,setTimeout(()=>{i.value=!1},3e3)}catch{i.value=!1,y("Erreur lors de l'ouverture de la facture")}}};return(a,e)=>(o(),k(D,null,{default:g(()=>[s("div",B,[s("div",null,[s("h1",$,"Vente "+l(t.sale.sale_number),1),e[0]||(e[0]=s("p",{class:"text-muted mb-0"},"Détails de la vente",-1))]),s("div",q,[C(b(p),{href:b(v)("sales.index"),class:"btn btn-outline-secondary"},{default:g(()=>[...e[1]||(e[1]=[s("i",{class:"bi bi-arrow-left me-1"},null,-1),f(" Retour à la liste ",-1)])]),_:1},8,["href"])])]),s("div",z,[s("div",W,[s("div",Q,[e[11]||(e[11]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Informations générales")],-1)),s("div",G,[s("div",H,[s("div",J,[e[2]||(e[2]=s("label",{class:"form-label text-muted"},"Numéro de vente",-1)),s("p",K,l(t.sale.sale_number),1)]),s("div",X,[e[3]||(e[3]=s("label",{class:"form-label text-muted"},"Date",-1)),s("p",Y,l(w(t.sale.created_at)),1)]),s("div",Z,[e[5]||(e[5]=s("label",{class:"form-label text-muted"},"Client",-1)),s("p",ss,[t.sale.customer?.id?(o(),k(b(p),{key:0,href:b(v)("customers.show",{id:t.sale.customer.id}),class:"btn btn-sm btn-outline-primary"},{default:g(()=>[e[4]||(e[4]=s("i",{class:"bi bi-person me-1"},null,-1)),f(" "+l(t.sale.customer.name),1)]),_:1},8,["href"])):(o(),d("span",es,"Client anonyme"))])]),s("div",ts,[e[6]||(e[6]=s("label",{class:"form-label text-muted"},"Vendeur",-1)),s("p",ls,l(t.sale.user?.name||"Non renseigné"),1)]),s("div",as,[e[7]||(e[7]=s("label",{class:"form-label text-muted"},"Mode de paiement",-1)),s("p",ns,[s("span",os,l(R(t.sale.payment_method)),1)])]),s("div",ds,[e[8]||(e[8]=s("label",{class:"form-label text-muted"},"Montant total",-1)),s("p",is,l(c(t.sale.total_amount)),1)]),t.sale.due_date?(o(),d("div",rs,[e[9]||(e[9]=s("label",{class:"form-label text-muted"},"Date d'échéance",-1)),s("p",cs,l(w(t.sale.due_date)),1)])):_("",!0)]),t.sale.notes?(o(),d("div",us,[e[10]||(e[10]=s("label",{class:"form-label text-muted"},"Notes",-1)),s("div",ms,[s("p",bs,l(t.sale.notes),1)])])):_("",!0)])]),s("div",fs,[e[15]||(e[15]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Articles vendus")],-1)),s("div",vs,[!t.sale.saleItems||t.sale.saleItems.length===0?(o(),d("div",hs,[...e[12]||(e[12]=[s("i",{class:"bi bi-cart-x fs-1 mb-3"},null,-1),s("p",null,"Aucun article trouvé pour cette vente.",-1)])])):(o(),d("div",gs,[s("table",_s,[e[14]||(e[14]=s("thead",{class:"table-light"},[s("tr",null,[s("th",null,"Produit"),s("th",null,"Catégorie"),s("th",null,"Quantité"),s("th",null,"Prix unitaire"),s("th",null,"Total")])],-1)),s("tbody",null,[(o(!0),d(V,null,A(t.sale.saleItems,n=>(o(),d("tr",{key:n.id},[s("td",ys,[s("div",ps,[s("div",ws,[n.product?.image_url?(o(),d("div",xs,[s("img",{src:n.product.image_url,alt:n.product?.name||"Produit",class:"img-fluid",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,ks)])):(o(),d("div",Cs,[...e[13]||(e[13]=[s("i",{class:"bi bi-box text-muted"},null,-1)])]))]),s("div",null,[s("div",js,l(n.product?.name||"Produit supprimé"),1),s("div",Ss,l(n.product?.sku||"N/A"),1)])])]),s("td",Es,[n.product?.category?(o(),d("span",{key:0,class:"badge",style:M({backgroundColor:n.product.category.color+"20",color:n.product.category.color})},l(n.product.category.name),5)):(o(),d("span",Rs," Catégorie supprimée "))]),s("td",Ls,[s("span",Ps,l(n.quantity),1),s("span",Is,l(n.product?.unit||"pièce"),1)]),s("td",Ns,l(c(n.unit_price)),1),s("td",Ts,l(c(n.total_price)),1)]))),128))])])]))])])]),s("div",Ds,[s("div",Us,[e[24]||(e[24]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Résumé financier")],-1)),s("div",Vs,[s("div",As,[e[16]||(e[16]=s("span",null,"Sous-total:",-1)),s("span",Ms,l(c(t.sale.subtotal||t.sale.total_amount)),1)]),s("div",Fs,[e[17]||(e[17]=s("span",null,"Taxes:",-1)),s("span",Os,l(c(t.sale.tax_amount||0)),1)]),s("div",Bs,[e[18]||(e[18]=s("span",null,"Remise:",-1)),s("span",$s,l(c(t.sale.discount_amount||0)),1)]),(t.sale.down_payment_amount||0)>0?(o(),d("div",qs,[e[19]||(e[19]=s("span",null,"Acompte:",-1)),s("span",zs,l(c(t.sale.down_payment_amount||0)),1)])):_("",!0),(t.sale.remaining_amount||0)>0?(o(),d("div",Ws,[e[20]||(e[20]=s("span",null,"Reste à payer:",-1)),s("span",Qs,l(c(t.sale.remaining_amount||0)),1)])):_("",!0),s("div",Gs,[e[21]||(e[21]=s("span",null,"Statut de paiement:",-1)),s("span",Hs,[s("span",{class:j(P(t.sale.payment_status||"paid"))},l(L(t.sale.payment_status||"paid")),3)])]),e[23]||(e[23]=s("hr",null,null,-1)),s("div",Js,[e[22]||(e[22]=s("span",{class:"fw-bold"},"Total:",-1)),s("span",Ks,l(c(t.sale.total_amount)),1)])])]),s("div",Xs,[e[27]||(e[27]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Actions rapides")],-1)),s("div",Ys,[s("div",Zs,[s("button",{onClick:N,class:"btn btn-success",disabled:r.value||i.value},[r.value?(o(),d("span",ee)):(o(),d("i",te)),f(" "+l(r.value?"Téléchargement...":"Télécharger la facture"),1)],8,se),s("button",{onClick:T,class:"btn btn-info",disabled:i.value||r.value},[i.value?(o(),d("span",ae)):(o(),d("i",ne)),f(" "+l(i.value?"Ouverture...":"Imprimer la facture"),1)],8,le),C(b(p),{href:b(v)("sales.edit",{id:t.sale.id}),class:j(["btn btn-outline-primary",{disabled:r.value||i.value}]),tabindex:r.value||i.value?-1:0},{default:g(()=>[...e[25]||(e[25]=[s("i",{class:"bi bi-pencil me-1"},null,-1),f(" Modifier la vente ",-1)])]),_:1},8,["href","class","tabindex"]),s("button",{onClick:I,class:"btn btn-outline-danger",disabled:r.value||i.value},[...e[26]||(e[26]=[s("i",{class:"bi bi-trash me-1"},null,-1),f(" Supprimer la vente ",-1)])],8,oe)])])]),s("div",de,[e[30]||(e[30]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Statistiques")],-1)),s("div",ie,[s("div",re,[s("div",ce,[s("div",ue,[s("div",me,l(t.sale.items_count||t.sale.saleItems?.length||0),1),e[28]||(e[28]=s("div",{class:"small text-muted"},"Articles",-1))])]),s("div",be,[s("div",fe,[s("div",ve,l(c(t.sale.total_amount)),1),e[29]||(e[29]=s("div",{class:"small text-muted"},"Montant",-1))])])])])])])])]),_:1}))}});export{ke as default};
