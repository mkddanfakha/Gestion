import{_ as N}from"./AppLayout.vue_vue_type_script_setup_true_lang-DOygplc7.js";import{d as U,r as w,c as x,w as _,a as s,t as l,j as k,u as m,l as p,f,b as d,e as g,o as n,F as V,g as A,s as D,n as C,h as M}from"./app-CGJPUJEO.js";import{r as v}from"./routes-C8N3XD_S.js";import{u as F}from"./useSweetAlert-CjcY7Pj8.js";import{c as O,f as B}from"./BootstrapLayout-Bp9zEE-w.js";import"./sweetalert2.esm.all-NNS-RXd7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const $={class:"d-flex justify-content-between align-items-center mb-4"},q={class:"h2 mb-1"},z={class:"d-flex gap-2"},W={class:"row g-4"},Q={class:"col-lg-8"},G={class:"card mb-4"},H={class:"card-body"},J={class:"row g-3"},K={class:"col-md-6"},X={class:"mb-0 font-monospace"},Y={class:"col-md-6"},Z={class:"mb-0"},ss={class:"col-md-6"},es={class:"mb-0"},ts={key:1,class:"text-muted"},ls={class:"col-md-6"},as={class:"mb-0"},ns={class:"col-md-6"},os={class:"mb-0"},ds={class:"badge bg-info"},is={class:"col-md-6"},rs={class:"mb-0 fw-bold text-success fs-5"},cs={key:0,class:"col-md-6"},us={class:"mb-0"},ms={key:0,class:"mt-4 pt-3 border-top"},bs={class:"bg-light p-3 rounded"},fs={class:"mb-0"},vs={class:"card"},hs={class:"card-body"},_s={key:0,class:"text-center py-4 text-muted"},gs={key:1,class:"table-responsive"},ys={class:"table table-hover mb-0"},ps={class:"align-middle"},ws={class:"d-flex align-items-center"},xs={class:"flex-shrink-0 me-3"},ks={key:0,class:"bg-light rounded overflow-hidden d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},Cs=["src","alt"],js={key:1,class:"bg-light rounded d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},Es={class:"fw-medium"},Ss={class:"text-muted small"},Rs={class:"align-middle"},Ps={key:1,class:"badge bg-secondary"},Ts={class:"align-middle"},Is={class:"fw-medium"},Ls={class:"text-muted ms-1"},Ns={class:"align-middle"},Us={class:"align-middle fw-medium text-success"},Vs={class:"col-lg-4"},As={class:"card mb-4"},Ds={class:"card-body"},Ms={class:"d-flex justify-content-between mb-2"},Fs={class:"fw-medium"},Os={class:"d-flex justify-content-between mb-2"},Bs={class:"fw-medium"},$s={class:"d-flex justify-content-between mb-2"},qs={class:"fw-medium"},zs={key:0,class:"d-flex justify-content-between mb-2"},Ws={class:"fw-medium text-primary"},Qs={key:1,class:"d-flex justify-content-between mb-2"},Gs={class:"fw-medium text-warning"},Hs={class:"d-flex justify-content-between mb-2"},Js={class:"fw-medium"},Ks={class:"d-flex justify-content-between mb-3"},Xs={class:"fw-bold text-success fs-5"},Ys={class:"card mb-4"},Zs={class:"card-body"},se={class:"d-grid gap-2"},ee=["disabled"],te={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},le={key:1,class:"bi bi-download me-1"},ae=["disabled"],ne={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},oe={key:1,class:"bi bi-printer me-1"},de=["disabled"],ie={class:"card"},re={class:"card-body"},ce={class:"row g-3 text-center"},ue={class:"col-6"},me={class:"p-2 bg-light rounded"},be={class:"fw-bold text-primary"},fe={class:"col-6"},ve={class:"p-2 bg-light rounded"},he={class:"fw-bold text-success"},Ce=U({__name:"Show",props:{sale:{}},setup(t){const{success:j,error:y,confirm:E}=F(),r=w(!1),i=w(!1),b=t,c=o=>new Intl.NumberFormat("fr-FR").format(o)+" Fcfa",S=o=>({cash:"Espèces",card:"Carte",bank_transfer:"Virement bancaire",check:"Chèque",orange_money:"Orange Money",wave:"Wave"})[o]||o,R=o=>({paid:"Payé",partial:"Paiement partiel",pending:"En attente"})[o]||o,P=o=>({paid:"badge bg-success",partial:"badge bg-warning",pending:"badge bg-danger"})[o]||"badge bg-secondary",T=async()=>{await E(`Êtes-vous sûr de vouloir supprimer la vente "${b.sale.sale_number}" ?`)&&M.delete(v("sales.destroy",{id:b.sale.id}),{onSuccess:()=>{j(`Vente "${b.sale.sale_number}" supprimée avec succès !`)},onError:e=>{const a=e.message||"Erreur lors de la suppression de la vente.";y(a)}})},I=async()=>{if(!r.value){r.value=!0;try{const o=v("sales.invoice.download",{sale:b.sale.id}),e=await fetch(o);if(!e.ok)throw new Error("Erreur lors du téléchargement");const a=await e.blob(),h=window.URL.createObjectURL(a),u=document.createElement("a");u.href=h,u.download=`facture_${b.sale.sale_number}.pdf`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(h),setTimeout(()=>{r.value=!1},500)}catch{r.value=!1,y("Erreur lors du téléchargement de la facture")}}},L=async()=>{if(!i.value){i.value=!0;try{const o=v("sales.invoice.print",{sale:b.sale.id}),e=await fetch(o);if(!e.ok)throw new Error("Erreur lors du chargement");const a=await e.blob(),h=window.URL.createObjectURL(a),u=window.open(h,"_blank");u?u.onload=()=>{setTimeout(()=>{u.print(),i.value=!1},500)}:window.location.href=o,setTimeout(()=>{i.value=!1},3e3)}catch{i.value=!1,y("Erreur lors de l'ouverture de la facture")}}};return(o,e)=>(n(),x(N,null,{default:_(()=>[s("div",$,[s("div",null,[s("h1",q,"Vente "+l(t.sale.sale_number),1),e[0]||(e[0]=s("p",{class:"text-muted mb-0"},"Détails de la vente",-1))]),s("div",z,[k(m(p),{href:m(v)("sales.index"),class:"btn btn-outline-secondary"},{default:_(()=>[...e[1]||(e[1]=[s("i",{class:"bi bi-arrow-left me-1"},null,-1),f(" Retour à la liste ",-1)])]),_:1},8,["href"])])]),s("div",W,[s("div",Q,[s("div",G,[e[11]||(e[11]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Informations générales")],-1)),s("div",H,[s("div",J,[s("div",K,[e[2]||(e[2]=s("label",{class:"form-label text-muted"},"Numéro de vente",-1)),s("p",X,l(t.sale.sale_number),1)]),s("div",Y,[e[3]||(e[3]=s("label",{class:"form-label text-muted"},"Date",-1)),s("p",Z,l(m(O)(t.sale.created_at)),1)]),s("div",ss,[e[5]||(e[5]=s("label",{class:"form-label text-muted"},"Client",-1)),s("p",es,[t.sale.customer?.id?(n(),x(m(p),{key:0,href:m(v)("customers.show",{id:t.sale.customer.id}),class:"btn btn-sm btn-outline-primary"},{default:_(()=>[e[4]||(e[4]=s("i",{class:"bi bi-person me-1"},null,-1)),f(" "+l(t.sale.customer.name),1)]),_:1},8,["href"])):(n(),d("span",ts,"Client anonyme"))])]),s("div",ls,[e[6]||(e[6]=s("label",{class:"form-label text-muted"},"Vendeur",-1)),s("p",as,l(t.sale.user?.name||"Non renseigné"),1)]),s("div",ns,[e[7]||(e[7]=s("label",{class:"form-label text-muted"},"Mode de paiement",-1)),s("p",os,[s("span",ds,l(S(t.sale.payment_method)),1)])]),s("div",is,[e[8]||(e[8]=s("label",{class:"form-label text-muted"},"Montant total",-1)),s("p",rs,l(c(t.sale.total_amount)),1)]),t.sale.due_date?(n(),d("div",cs,[e[9]||(e[9]=s("label",{class:"form-label text-muted"},"Date d'échéance",-1)),s("p",us,l(m(B)(t.sale.due_date)),1)])):g("",!0)]),t.sale.notes?(n(),d("div",ms,[e[10]||(e[10]=s("label",{class:"form-label text-muted"},"Notes",-1)),s("div",bs,[s("p",fs,l(t.sale.notes),1)])])):g("",!0)])]),s("div",vs,[e[15]||(e[15]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Articles vendus")],-1)),s("div",hs,[!t.sale.saleItems||t.sale.saleItems.length===0?(n(),d("div",_s,[...e[12]||(e[12]=[s("i",{class:"bi bi-cart-x fs-1 mb-3"},null,-1),s("p",null,"Aucun article trouvé pour cette vente.",-1)])])):(n(),d("div",gs,[s("table",ys,[e[14]||(e[14]=s("thead",{class:"table-light"},[s("tr",null,[s("th",null,"Produit"),s("th",null,"Catégorie"),s("th",null,"Quantité"),s("th",null,"Prix unitaire"),s("th",null,"Total")])],-1)),s("tbody",null,[(n(!0),d(V,null,A(t.sale.saleItems,a=>(n(),d("tr",{key:a.id},[s("td",ps,[s("div",ws,[s("div",xs,[a.product?.image_url?(n(),d("div",ks,[s("img",{src:a.product.image_url,alt:a.product?.name||"Produit",class:"img-fluid",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Cs)])):(n(),d("div",js,[...e[13]||(e[13]=[s("i",{class:"bi bi-box text-muted"},null,-1)])]))]),s("div",null,[s("div",Es,l(a.product?.name||"Produit supprimé"),1),s("div",Ss,l(a.product?.sku||"N/A"),1)])])]),s("td",Rs,[a.product?.category?(n(),d("span",{key:0,class:"badge",style:D({backgroundColor:a.product.category.color+"20",color:a.product.category.color})},l(a.product.category.name),5)):(n(),d("span",Ps," Catégorie supprimée "))]),s("td",Ts,[s("span",Is,l(a.quantity),1),s("span",Ls,l(a.product?.unit||"pièce"),1)]),s("td",Ns,l(c(a.unit_price)),1),s("td",Us,l(c(a.total_price)),1)]))),128))])])]))])])]),s("div",Vs,[s("div",As,[e[24]||(e[24]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Résumé financier")],-1)),s("div",Ds,[s("div",Ms,[e[16]||(e[16]=s("span",null,"Sous-total:",-1)),s("span",Fs,l(c(t.sale.subtotal||t.sale.total_amount)),1)]),s("div",Os,[e[17]||(e[17]=s("span",null,"Taxes:",-1)),s("span",Bs,l(c(t.sale.tax_amount||0)),1)]),s("div",$s,[e[18]||(e[18]=s("span",null,"Remise:",-1)),s("span",qs,l(c(t.sale.discount_amount||0)),1)]),(t.sale.down_payment_amount||0)>0?(n(),d("div",zs,[e[19]||(e[19]=s("span",null,"Acompte:",-1)),s("span",Ws,l(c(t.sale.down_payment_amount||0)),1)])):g("",!0),(t.sale.remaining_amount||0)>0?(n(),d("div",Qs,[e[20]||(e[20]=s("span",null,"Reste à payer:",-1)),s("span",Gs,l(c(t.sale.remaining_amount||0)),1)])):g("",!0),s("div",Hs,[e[21]||(e[21]=s("span",null,"Statut de paiement:",-1)),s("span",Js,[s("span",{class:C(P(t.sale.payment_status||"paid"))},l(R(t.sale.payment_status||"paid")),3)])]),e[23]||(e[23]=s("hr",null,null,-1)),s("div",Ks,[e[22]||(e[22]=s("span",{class:"fw-bold"},"Total:",-1)),s("span",Xs,l(c(t.sale.total_amount)),1)])])]),s("div",Ys,[e[27]||(e[27]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Actions rapides")],-1)),s("div",Zs,[s("div",se,[s("button",{onClick:I,class:"btn btn-success",disabled:r.value||i.value},[r.value?(n(),d("span",te)):(n(),d("i",le)),f(" "+l(r.value?"Téléchargement...":"Télécharger la facture"),1)],8,ee),s("button",{onClick:L,class:"btn btn-info",disabled:i.value||r.value},[i.value?(n(),d("span",ne)):(n(),d("i",oe)),f(" "+l(i.value?"Ouverture...":"Imprimer la facture"),1)],8,ae),k(m(p),{href:m(v)("sales.edit",{id:t.sale.id}),class:C(["btn btn-outline-primary",{disabled:r.value||i.value}]),tabindex:r.value||i.value?-1:0},{default:_(()=>[...e[25]||(e[25]=[s("i",{class:"bi bi-pencil me-1"},null,-1),f(" Modifier la vente ",-1)])]),_:1},8,["href","class","tabindex"]),s("button",{onClick:T,class:"btn btn-outline-danger",disabled:r.value||i.value},[...e[26]||(e[26]=[s("i",{class:"bi bi-trash me-1"},null,-1),f(" Supprimer la vente ",-1)])],8,de)])])]),s("div",ie,[e[30]||(e[30]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},"Statistiques")],-1)),s("div",re,[s("div",ce,[s("div",ue,[s("div",me,[s("div",be,l(t.sale.items_count||t.sale.saleItems?.length||0),1),e[28]||(e[28]=s("div",{class:"small text-muted"},"Articles",-1))])]),s("div",fe,[s("div",ve,[s("div",he,l(c(t.sale.total_amount)),1),e[29]||(e[29]=s("div",{class:"small text-muted"},"Montant",-1))])])])])])])])]),_:1}))}});export{Ce as default};
