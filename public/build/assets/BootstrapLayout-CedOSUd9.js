import{d as K,r as A,z as F,C as M,b as o,e as c,a as e,o as n,x as W,H as U,h as B,y as R,B as G,n as $,t as g,k as V,f as m,F as j,g as I,j as h,u as s,l as y,w,A as H,I as ie,c as ne}from"./app-oFHxr63-.js";import{r as p}from"./routes-D3G7R3Tx.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={key:0,class:"loading-overlay"},ae=K({__name:"LoadingSpinner",setup(k){const a=A(!1),x=f=>{a.value=f.detail};return F(()=>{window.addEventListener("loading-state-changed",x),window.addEventListener("inertia:start",()=>{a.value=!0}),window.addEventListener("inertia:finish",()=>{setTimeout(()=>{a.value=!1},300)})}),M(()=>{window.removeEventListener("loading-state-changed",x),window.removeEventListener("inertia:start",()=>{}),window.removeEventListener("inertia:finish",()=>{})}),(f,v)=>a.value?(n(),o("div",oe,[...v[0]||(v[0]=[e("div",{class:"loading-content"},[e("div",{class:"spinner-container"},[e("div",{class:"spinner-grow text-primary",role:"status",style:{"animation-delay":"0s"}},[e("span",{class:"visually-hidden"},"Loading...")]),e("div",{class:"spinner-grow text-success",role:"status",style:{"animation-delay":"0.2s"}},[e("span",{class:"visually-hidden"},"Loading...")]),e("div",{class:"spinner-grow text-warning",role:"status",style:{"animation-delay":"0.4s"}},[e("span",{class:"visually-hidden"},"Loading...")])])],-1)])])):c("",!0)}}),le=X(ae,[["__scopeId","data-v-fe3aa04c"]]);let E=null,Q=!1;const re=async()=>{try{return(!E||E.state==="closed")&&(E=new(window.AudioContext||window.webkitAudioContext),Q=!0),E.state==="suspended"&&await E.resume(),Q=!0,E}catch(k){return console.error("Erreur lors de l'activation du contexte audio:",k),null}},z=()=>{try{if(!E||E.state==="closed")return;E.state==="suspended"?E.resume().then(()=>{Y(E)}).catch(k=>{console.error("Erreur lors de la reprise du contexte audio:",k)}):Y(E)}catch(k){console.error("Erreur lors de la lecture du son:",k)}},Y=k=>{try{const a=k.createOscillator(),x=k.createOscillator(),f=k.createGain();a.connect(f),x.connect(f),f.connect(k.destination),a.frequency.value=800,a.type="sine",x.frequency.value=1e3,x.type="sine";const v=k.currentTime,u=.01,T=.05,r=.2,S=u+T+.1;f.gain.setValueAtTime(0,v),f.gain.linearRampToValueAtTime(.4,v+u),f.gain.exponentialRampToValueAtTime(r,v+u+T),f.gain.setValueAtTime(r,v+u+T),f.gain.exponentialRampToValueAtTime(.01,v+S),a.start(v),x.start(v),a.stop(v+S),x.stop(v+S),a.onended=()=>{a.disconnect()},x.onended=()=>{x.disconnect()}}catch(a){console.error("Erreur lors de la génération du son:",a)}},de=()=>{const a=W().props.auth?.user?.id,x=A({salesDueToday:[],lowStockProducts:[],expiringProducts:[]}),f=A(!1),v=()=>{if(a&&!f.value)try{if(!U){console.error("Echo n'est pas disponible. Vérifiez que Pusher est correctement configuré.");return}const T=U.private(`user.${a}.notifications`);T.subscribed(()=>{f.value=!0}),T.error(r=>{console.error("Erreur lors de la souscription au canal:",r),f.value=!1}),T.listen(".notification.sent",r=>{if(r.notification){z(),window.dispatchEvent(new CustomEvent("notification-received",{detail:r.notification}));const _=r.notification?.type==="expiring_product"?1e3:500;setTimeout(()=>{B.reload({only:["notifications"],preserveScroll:!0,preserveState:!1,onSuccess:S=>{const L=S.props.notifications;window.dispatchEvent(new CustomEvent("notifications-updated",{detail:L}))},onError:S=>{console.error("Erreur lors du rechargement des notifications:",S)},onFinish:()=>{}})},_)}})}catch(T){console.error("Erreur lors de l'écoute des notifications:",T),f.value=!1}},u=()=>{if(!(!a||!f.value))try{U.leave(`user.${a}.notifications`),f.value=!1}catch(T){console.error("Erreur lors de l'arrêt de l'écoute:",T)}};return F(()=>{if(a){v();const T=()=>{re().catch(r=>{console.error("Erreur lors de l'activation de l'audio:",r)})};document.addEventListener("click",T,{once:!1,passive:!0}),document.addEventListener("keydown",T,{once:!1,passive:!0}),document.addEventListener("touchstart",T,{once:!1,passive:!0}),document.addEventListener("mousedown",T,{once:!1,passive:!0})}}),M(()=>{u()}),{notifications:x,startListening:v,stopListening:u,isListening:f,testSound:()=>{z()}}};typeof window<"u"&&(window.testNotificationSound=()=>{z()});const ce={class:"dropdown"},ue=["id"],me=["data-count"],pe=["aria-labelledby"],fe={class:"notification-header"},be={class:"d-flex justify-content-between align-items-center p-3 border-bottom bg-light"},ge={class:"mb-0 fw-bold d-flex align-items-center"},ve={key:0,class:"badge bg-primary ms-2"},he=["disabled"],ye={key:0,class:"spinner-border spinner-border-sm me-1",role:"status"},we={key:1,class:"bi bi-check-all"},ke={key:0,class:"notification-empty"},xe={class:"notification-section-header"},_e={class:"p-2 bg-warning bg-opacity-10 border-bottom"},Te={class:"d-flex justify-content-between align-items-center"},$e={class:"flex-grow-1"},Pe={class:"mb-1 small fw-bold d-flex align-items-center"},Se={class:"badge bg-warning text-dark ms-2"},Ce={class:"mb-0 small text-muted"},Ee={class:"dropdown-item notification-link d-flex align-items-start"},Le={class:"d-flex justify-content-between align-items-start"},Ae={class:"flex-grow-1"},De={class:"fw-medium small d-flex align-items-center"},Ne={class:"text-muted small mt-1"},je={class:"badge bg-warning text-dark ms-2 flex-shrink-0"},qe=["onClick"],Ve={key:0,class:"notification-more"},Re={class:"notification-section-header"},Oe={class:"p-2 bg-info bg-opacity-10 border-bottom"},Be={class:"d-flex justify-content-between align-items-center"},Fe={class:"flex-grow-1"},Ie={class:"mb-1 small fw-bold d-flex align-items-center"},Me={class:"badge bg-info text-white ms-2"},We={class:"mb-0 small text-muted"},Ue={class:"dropdown-item notification-link d-flex align-items-start"},ze={class:"d-flex align-items-start"},Ke={class:"me-2 flex-shrink-0"},Xe=["src","alt"],Je={key:1,class:"bi bi-box-seam text-muted",style:{"font-size":"40px",width:"40px",height:"40px",display:"flex","align-items":"center","justify-content":"center"}},Ge={class:"flex-grow-1 d-flex justify-content-between align-items-start"},He={class:"flex-grow-1"},Qe={class:"fw-medium small d-flex align-items-center"},Ye={class:"text-muted small mt-1"},Ze={class:"badge bg-info text-white ms-2 flex-shrink-0"},et=["onClick"],tt={key:0,class:"notification-more"},st={class:"notification-section-header"},it={class:"p-2 bg-danger bg-opacity-10 border-bottom"},nt={class:"d-flex justify-content-between align-items-center"},ot={class:"flex-grow-1"},at={class:"mb-1 small fw-bold d-flex align-items-center"},lt={class:"badge bg-danger ms-2"},rt={class:"mb-0 small text-muted"},dt={class:"dropdown-item notification-link d-flex align-items-start"},ct={class:"d-flex align-items-start"},ut={class:"me-2 flex-shrink-0"},mt=["src","alt"],pt={key:1,class:"bi bi-box-seam text-muted",style:{"font-size":"40px",width:"40px",height:"40px",display:"flex","align-items":"center","justify-content":"center"}},ft={class:"flex-grow-1 d-flex justify-content-between align-items-start"},bt={class:"flex-grow-1"},gt={class:"fw-medium small d-flex align-items-center"},vt={class:"text-muted small mt-1"},ht={key:0},yt={key:0,class:"text-danger fw-medium"},wt={key:1,class:"text-danger fw-medium"},kt={key:2,class:"text-warning fw-medium"},xt=["onClick"],_t={key:0,class:"notification-more"},Tt={key:2,class:"notification-footer"},$t={class:"p-2 border-top bg-light text-center"},Pt=K({__name:"NotificationBell",props:{notifications:{}},setup(k){const a=k,x=A(`notification-dropdown-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),f=A(0),v=W(),u=A({salesDueToday:[],lowStockProducts:[],lowStockProductsTotal:void 0,expiringProducts:[],expiringProductsTotal:void 0});(()=>{const b=v.props.notifications||a.notifications||{salesDueToday:[],lowStockProducts:[],expiringProducts:[]};u.value={salesDueToday:b.salesDueToday||[],lowStockProducts:b.lowStockProducts||[],lowStockProductsTotal:b.lowStockProductsTotal,expiringProducts:b.expiringProducts||[],expiringProductsTotal:b.expiringProductsTotal}})();const r=R(()=>u.value),_=A(0),S=()=>{const b=u.value.salesDueToday?.length||0,t=u.value.lowStockProductsTotal??(u.value.lowStockProducts?.length||0),l=u.value.expiringProductsTotal??(u.value.expiringProducts?.length||0),P=b+t+l,O=_.value;P!==O&&(_.value=P,H(()=>{f.value++}))};G(u,()=>{S()},{deep:!0,immediate:!0});let L=null;G(()=>v.props.notifications,async b=>{const t=b;t&&({...u.value},u.value={salesDueToday:Array.isArray(t.salesDueToday)?[...t.salesDueToday]:[],lowStockProducts:Array.isArray(t.lowStockProducts)?[...t.lowStockProducts]:[],lowStockProductsTotal:t.lowStockProductsTotal,expiringProducts:Array.isArray(t.expiringProducts)?[...t.expiringProducts]:[],expiringProductsTotal:t.expiringProductsTotal},S())},{deep:!0,immediate:!0});const C=A(!1),D=async(b,t,l)=>{if(l){if(l.target.closest("a")){fetch(p("notifications.mark-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:JSON.stringify({type:b,id:t})}).catch(O=>{});return}l.preventDefault(),l.stopPropagation()}try{(await fetch(p("notifications.mark-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:JSON.stringify({type:b,id:t})})).ok&&B.reload({only:["notifications"]})}catch(P){console.error("Erreur lors du marquage comme lu:",P)}},d=async b=>{if(!C.value){C.value=!0;try{(await fetch(p("notifications.mark-all-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:JSON.stringify({type:b})})).ok&&B.reload({only:["notifications"]})}catch(t){console.error("Erreur lors du marquage de toutes les notifications comme lues:",t)}finally{C.value=!1}}},i=async b=>{if(b.preventDefault(),b.stopPropagation(),!C.value){C.value=!0;try{if((await fetch(p("notifications.mark-all-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:JSON.stringify({type:"all"})})).ok){const l=x.value,P=document.getElementById(l);if(P){const O=window.bootstrap;if(O&&O.Dropdown){const J=O.Dropdown.getInstance(P);J&&J.hide()}}B.reload({only:["notifications"]})}}catch(t){console.error("Erreur lors du marquage de toutes les notifications comme lues:",t)}finally{C.value=!1}}},N=b=>new Intl.NumberFormat("fr-FR").format(b)+" Fcfa",q=b=>new Date(b).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),{startListening:Z,stopListening:ee,testSound:te}=de(),se=async()=>{try{(await fetch(p("notifications.test"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}})).ok&&te()}catch{}};return typeof window<"u"&&(window.testRealtimeNotification=se),F(()=>{Z(),L=()=>{};const b=()=>{H(()=>{S()})};window.addEventListener("notification-received",L),window.addEventListener("notifications-updated",b),M(()=>{window.removeEventListener("notification-received",L),window.removeEventListener("notifications-updated",b)})}),M(()=>{ee(),L&&window.removeEventListener("notification-received",L)}),(b,t)=>(n(),o("div",ce,[e("button",{class:$(["btn btn-sm btn-outline-primary position-relative notification-bell-btn",{"has-notifications":_.value>0}]),type:"button",id:x.value,"data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},[t[4]||(t[4]=e("i",{class:"bi bi-bell fs-5"},null,-1)),_.value>0?(n(),o("span",{key:`badge-${_.value}-${f.value}`,class:$(["position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-badge",{pulse:_.value>0}]),"data-count":_.value},g(_.value>99?"99+":_.value),11,me)):c("",!0)],10,ue),e("ul",{class:"dropdown-menu dropdown-menu-end shadow-lg notification-dropdown","aria-labelledby":x.value,onClick:t[3]||(t[3]=V(()=>{},["stop"]))},[e("li",fe,[e("div",be,[e("h6",ge,[t[5]||(t[5]=e("i",{class:"bi bi-bell-fill me-2 text-primary"},null,-1)),t[6]||(t[6]=m(" Notifications ",-1)),_.value>0?(n(),o("span",ve,g(_.value),1)):c("",!0)]),_.value>0?(n(),o("button",{key:0,onClick:i,class:"btn btn-sm btn-link text-decoration-none p-0 text-muted",type:"button",title:"Tout marquer comme lu",disabled:C.value},[C.value?(n(),o("span",ye)):(n(),o("i",we))],8,he)):c("",!0)])]),_.value===0?(n(),o("li",ke,[...t[7]||(t[7]=[e("div",{class:"p-5 text-center text-muted"},[e("i",{class:"bi bi-bell-slash fs-1 d-block mb-3 text-muted opacity-50"}),e("p",{class:"mb-0 fw-medium"},"Aucune notification"),e("p",{class:"small mb-0 mt-2"},"Vous êtes à jour !")],-1)])])):(n(),o(j,{key:1},[r.value.salesDueToday&&r.value.salesDueToday.length>0?(n(),o(j,{key:0},[e("li",xe,[e("div",_e,[e("div",Te,[e("div",$e,[e("h6",Pe,[t[8]||(t[8]=e("i",{class:"bi bi-calendar-event-fill me-2 text-warning"},null,-1)),t[9]||(t[9]=m(" Ventes avec échéance aujourd'hui ",-1)),e("span",Se,g(r.value.salesDueToday.length),1)]),e("p",Ce,g(r.value.salesDueToday.length)+" vente(s) non payée(s) ",1)]),e("button",{onClick:t[0]||(t[0]=V(l=>d("sale_due_today"),["stop"])),class:"btn btn-sm btn-link text-muted p-0 ms-2",type:"button",title:"Marquer toutes comme lues"},[...t[10]||(t[10]=[e("i",{class:"bi bi-check-all"},null,-1)])])])])]),(n(!0),o(j,null,I(r.value.salesDueToday.slice(0,3),l=>(n(),o("li",{key:l.id,class:"notification-item"},[e("div",Ee,[h(s(y),{href:s(p)("sales.show",{id:l.id}),class:"flex-grow-1 text-decoration-none",onClick:P=>D("sale_due_today",l.id,P)},{default:w(()=>[e("div",Le,[e("div",Ae,[e("div",De,[t[11]||(t[11]=e("i",{class:"bi bi-receipt me-2 text-warning"},null,-1)),m(" Vente "+g(l.sale_number),1)]),e("div",Ne,[t[12]||(t[12]=e("i",{class:"bi bi-person me-1"},null,-1)),m(" "+g(l.customer),1)])]),e("span",je,g(N(l.remaining_amount)),1)])]),_:2},1032,["href","onClick"]),e("button",{onClick:V(P=>D("sale_due_today",l.id),["stop"]),class:"btn btn-sm btn-link text-muted p-0 ms-2 flex-shrink-0",type:"button",title:"Marquer comme lu"},[...t[13]||(t[13]=[e("i",{class:"bi bi-check-circle"},null,-1)])],8,qe)])]))),128)),r.value.salesDueToday.length>3?(n(),o("li",Ve,[h(s(y),{href:s(p)("sales.index",{due_date:new Date().toISOString().split("T")[0]}),class:"dropdown-item text-center text-primary small fw-medium"},{default:w(()=>[t[14]||(t[14]=e("i",{class:"bi bi-arrow-right-circle me-1"},null,-1)),m(" Voir toutes ("+g(r.value.salesDueToday.length)+") ",1)]),_:1},8,["href"])])):c("",!0),t[15]||(t[15]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1))],64)):c("",!0),r.value.lowStockProducts&&r.value.lowStockProducts.length>0?(n(),o(j,{key:1},[e("li",Re,[e("div",Oe,[e("div",Be,[e("div",Fe,[e("h6",Ie,[t[16]||(t[16]=e("i",{class:"bi bi-exclamation-triangle-fill me-2 text-info"},null,-1)),t[17]||(t[17]=m(" Stock faible ",-1)),e("span",Me,g(r.value.lowStockProducts.length),1)]),e("p",We,g(r.value.lowStockProducts.length)+" produit(s) en rupture ou niveau faible ",1)]),e("button",{onClick:t[1]||(t[1]=V(l=>d("low_stock"),["stop"])),class:"btn btn-sm btn-link text-muted p-0 ms-2",type:"button",title:"Marquer toutes comme lues"},[...t[18]||(t[18]=[e("i",{class:"bi bi-check-all"},null,-1)])])])])]),(n(!0),o(j,null,I(r.value.lowStockProducts.slice(0,3),l=>(n(),o("li",{key:l.id,class:"notification-item"},[e("div",Ue,[h(s(y),{href:s(p)("products.show",{id:l.id}),class:"flex-grow-1 text-decoration-none",onClick:P=>D("low_stock",l.id,P)},{default:w(()=>[e("div",ze,[e("div",Ke,[l.image_url?(n(),o("img",{key:0,src:l.image_url,alt:l.name,class:"rounded",style:{width:"40px",height:"40px","object-fit":"contain"}},null,8,Xe)):(n(),o("i",Je))]),e("div",Ge,[e("div",He,[e("div",Qe,g(l.name),1),e("div",Ye,[t[19]||(t[19]=e("i",{class:"bi bi-tag me-1"},null,-1)),m(" "+g(l.category?.name||"Sans catégorie"),1)])]),e("span",Ze,g(l.stock_quantity)+" "+g(l.unit),1)])])]),_:2},1032,["href","onClick"]),e("button",{onClick:V(P=>D("low_stock",l.id),["stop"]),class:"btn btn-sm btn-link text-muted p-0 ms-2 flex-shrink-0",type:"button",title:"Marquer comme lu"},[...t[20]||(t[20]=[e("i",{class:"bi bi-check-circle"},null,-1)])],8,et)])]))),128)),r.value.lowStockProducts.length>3?(n(),o("li",tt,[h(s(y),{href:s(p)("products.index"),class:"dropdown-item text-center text-primary small fw-medium"},{default:w(()=>[t[21]||(t[21]=e("i",{class:"bi bi-arrow-right-circle me-1"},null,-1)),m(" Voir tous ("+g(r.value.lowStockProducts.length)+") ",1)]),_:1},8,["href"])])):c("",!0),t[22]||(t[22]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1))],64)):c("",!0),r.value.expiringProducts&&r.value.expiringProducts.length>0?(n(),o(j,{key:2},[e("li",st,[e("div",it,[e("div",nt,[e("div",ot,[e("h6",at,[t[23]||(t[23]=e("i",{class:"bi bi-exclamation-triangle-fill me-2 text-danger"},null,-1)),t[24]||(t[24]=m(" Produits expirés ou proches de l'expiration ",-1)),e("span",lt,g(r.value.expiringProductsTotal||r.value.expiringProducts.length),1)]),e("p",rt,g(r.value.expiringProductsTotal||r.value.expiringProducts.length)+" produit(s) concerné(s) ",1)]),e("button",{onClick:t[2]||(t[2]=V(l=>d("expiring_product"),["stop"])),class:"btn btn-sm btn-link text-muted p-0 ms-2",type:"button",title:"Marquer toutes comme lues"},[...t[25]||(t[25]=[e("i",{class:"bi bi-check-all"},null,-1)])])])])]),(n(!0),o(j,null,I((r.value.expiringProducts||[]).slice(0,3),l=>(n(),o("li",{key:l.id,class:"notification-item"},[e("div",dt,[h(s(y),{href:s(p)("products.show",{id:l.id}),class:"flex-grow-1 text-decoration-none",onClick:P=>D("expiring_product",l.id,P)},{default:w(()=>[e("div",ct,[e("div",ut,[l.image_url?(n(),o("img",{key:0,src:l.image_url,alt:l.name,class:"rounded",style:{width:"40px",height:"40px","object-fit":"contain"}},null,8,mt)):(n(),o("i",pt))]),e("div",ft,[e("div",bt,[e("div",gt,g(l.name),1),e("div",vt,[l.days_until_expiration!==null?(n(),o("span",ht,[t[26]||(t[26]=e("i",{class:"bi bi-calendar3 me-1"},null,-1)),l.days_until_expiration<0?(n(),o("span",yt," Expiré depuis "+g(Math.abs(l.days_until_expiration))+" jour(s) ",1)):l.days_until_expiration===0?(n(),o("span",wt," Expire aujourd'hui ")):(n(),o("span",kt," Expire dans "+g(l.days_until_expiration)+" jour(s) ",1))])):c("",!0)])]),l.days_until_expiration!==null?(n(),o("span",{key:0,class:$(["badge ms-2 flex-shrink-0",l.days_until_expiration<0||l.days_until_expiration===0?"bg-danger":"bg-warning text-dark"])},g(q(l.expiration_date)),3)):c("",!0)])])]),_:2},1032,["href","onClick"]),e("button",{onClick:V(P=>D("expiring_product",l.id),["stop"]),class:"btn btn-sm btn-link text-muted p-0 ms-2 flex-shrink-0",type:"button",title:"Marquer comme lu"},[...t[27]||(t[27]=[e("i",{class:"bi bi-check-circle"},null,-1)])],8,xt)])]))),128)),(r.value.expiringProductsTotal||r.value.expiringProducts.length)>3?(n(),o("li",_t,[h(s(y),{href:s(p)("products.index",{expiration_alert:!0}),class:"dropdown-item text-center text-primary small fw-medium"},{default:w(()=>[t[28]||(t[28]=e("i",{class:"bi bi-arrow-right-circle me-1"},null,-1)),m(" Voir tous ("+g(r.value.expiringProductsTotal||r.value.expiringProducts.length)+") ",1)]),_:1},8,["href"])])):c("",!0)],64)):c("",!0)],64)),_.value>0?(n(),o("li",Tt,[e("div",$t,[h(s(y),{href:s(p)("dashboard"),class:"btn btn-sm btn-primary w-100"},{default:w(()=>[...t[29]||(t[29]=[e("i",{class:"bi bi-speedometer2 me-1"},null,-1),m(" Voir le tableau de bord ",-1)])]),_:1},8,["href"])])])):c("",!0)],8,pe)]))}}),St=X(Pt,[["__scopeId","data-v-d30eac34"]]),Ct=()=>{const k=W(),a=R(()=>k.props.auth?.user),x=R(()=>a.value?.role==="admin"),f=R(()=>a.value?.role==="vendeur"),v=R(()=>a.value?.permissions||[]),u=(i,N)=>{if(x.value)return!0;const q=`${i}.${N}`;return v.value.includes(q)};return{isAdmin:x,isVendeur:f,userPermissions:v,hasPermission:u,hasPermissionByName:i=>x.value?!0:v.value.includes(i),canCreate:i=>u(i,"create"),canView:i=>u(i,"view"),canEdit:i=>u(i,"edit"),canUpdate:i=>u(i,"update"),canDelete:i=>u(i,"delete"),canDownload:i=>u(i,"download"),canRestore:i=>u(i,"restore")}},Et={class:"d-flex min-vh-100 bg-light"},Lt={class:"sidebar-header p-3 border-bottom border-white border-opacity-25"},At={class:"sidebar-nav p-3"},Dt={class:"nav nav-pills flex-column"},Nt={key:0,class:"nav-item mb-2"},jt={key:1,class:"nav-divider my-2"},qt={key:2,class:"nav-item mb-2"},Vt={key:3,class:"nav-item mb-2"},Rt={key:4,class:"nav-divider my-2"},Ot={key:5,class:"nav-item mb-2"},Bt={key:6,class:"nav-item mb-2"},Ft={key:7,class:"nav-item mb-2"},It={key:8,class:"nav-item mb-2"},Mt={key:9,class:"nav-divider my-2"},Wt={key:10,class:"nav-item mb-2"},Ut={key:11,class:"nav-item mb-2"},zt={key:12,class:"nav-item mb-2"},Kt={key:13,class:"nav-divider my-2"},Xt={key:14,class:"nav-item mb-2"},Jt={key:15,class:"nav-divider my-2"},Gt={key:16,class:"nav-item mb-2"},Ht={key:17,class:"nav-item mb-2"},Qt={class:"main-content flex-grow-1 d-flex flex-column"},Yt={class:"bg-white shadow-sm border-bottom"},Zt={class:"container-fluid px-3 py-2 d-flex justify-content-between align-items-center"},es={key:0,"aria-label":"breadcrumb",class:"flex-grow-1"},ts={class:"breadcrumb mb-0"},ss={key:0,class:"breadcrumb-item"},is={key:1},ns={class:"d-flex align-items-center gap-2 ms-auto"},os={class:"dropdown"},as={class:"btn btn-sm btn-outline-primary d-flex align-items-center gap-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},ls={class:"d-none d-md-inline"},rs={class:"dropdown-menu dropdown-menu-end shadow"},ds={class:"px-3 py-2"},cs={class:"fw-medium"},us={class:"flex-grow-1 container-fluid py-4"},ms=K({__name:"BootstrapLayout",props:{breadcrumbs:{default:()=>[]}},setup(k){const{canView:a,isAdmin:x}=Ct(),f=W(),v=R(()=>x.value),u=A(!1);F(()=>{setTimeout(()=>{const d=f.props.auth?.user;d&&d.id&&!u.value&&(d.role===void 0||d.role===null)&&(u.value=!0,B.reload({only:["auth"]}))},100)});const T=R(()=>f.props.notifications||{salesDueToday:[],lowStockProducts:[],expiringProducts:[]}),r=A(!1),_=A(!1);F(()=>{r.value=document.documentElement.classList.contains("dark"),new MutationObserver(()=>{r.value=document.documentElement.classList.contains("dark")}).observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})});const S=()=>{const i=(document.documentElement.classList.contains("dark")?"dark":"light")==="dark"?"light":"dark";i==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("appearance",i),r.value=i==="dark"},L=()=>{const d=document.querySelector(".sidebar");d&&(d.classList.toggle("show"),_.value=d.classList.contains("show"))},C=d=>({admin:"Administrateur",vendeur:"Vendeur",gestionnaire:"Gestionnaire",user:"Utilisateur"})[d||"user"]||"Utilisateur",D=d=>({admin:"bg-danger",vendeur:"bg-primary",gestionnaire:"bg-info",user:"bg-secondary"})[d||"user"]||"bg-secondary";return(d,i)=>(n(),o("div",Et,[e("div",{class:$(["sidebar bg-primary text-white",{"sidebar-dark":r.value}])},[e("div",Lt,[h(s(y),{href:s(p)("dashboard"),class:"d-flex align-items-center text-white text-decoration-none"},{default:w(()=>[...i[0]||(i[0]=[e("div",{class:"me-2"},[e("img",{src:"/logo.png",alt:"Logo",class:"logo-img",style:{width:"120px",height:"120px","object-fit":"contain"}})],-1),e("span",{class:"fw-bold"},"Gestion",-1)])]),_:1},8,["href"])]),e("nav",At,[e("ul",Dt,[s(a)("dashboard")?(n(),o("li",Nt,[h(s(y),{href:s(p)("dashboard"),class:$(["nav-link",{active:d.$page.url==="/"}])},{default:w(()=>[...i[1]||(i[1]=[e("i",{class:"bi bi-house-door me-2"},null,-1),m(" Dashboard ",-1)])]),_:1},8,["href","class"])])):c("",!0),s(a)("products")||s(a)("categories")?(n(),o("li",jt)):c("",!0),s(a)("products")?(n(),o("li",qt,[h(s(y),{href:s(p)("products.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/products")}])},{default:w(()=>[...i[2]||(i[2]=[e("i",{class:"bi bi-box me-2"},null,-1),m(" Produits ",-1)])]),_:1},8,["href","class"])])):c("",!0),s(a)("categories")?(n(),o("li",Vt,[h(s(y),{href:s(p)("categories.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/categories")}])},{default:w(()=>[...i[3]||(i[3]=[e("i",{class:"bi bi-tags me-2"},null,-1),m(" Catégories ",-1)])]),_:1},8,["href","class"])])):c("",!0),s(a)("customers")||s(a)("sales")||s(a)("quotes")||s(a)("expenses")?(n(),o("li",Rt)):c("",!0),s(a)("customers")?(n(),o("li",Ot,[h(s(y),{href:s(p)("customers.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/customers")}])},{default:w(()=>[...i[4]||(i[4]=[e("i",{class:"bi bi-people me-2"},null,-1),m(" Clients ",-1)])]),_:1},8,["href","class"])])):c("",!0),s(a)("sales")?(n(),o("li",Bt,[h(s(y),{href:s(p)("sales.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/sales")}])},{default:w(()=>[...i[5]||(i[5]=[e("i",{class:"bi bi-cart me-2"},null,-1),m(" Ventes ",-1)])]),_:1},8,["href","class"])])):c("",!0),s(a)("quotes")?(n(),o("li",Ft,[h(s(y),{href:s(p)("quotes.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/quotes")}])},{default:w(()=>[...i[6]||(i[6]=[e("i",{class:"bi bi-file-earmark-check me-2"},null,-1),m(" Devis ",-1)])]),_:1},8,["href","class"])])):c("",!0),s(a)("expenses")?(n(),o("li",It,[h(s(y),{href:s(p)("expenses.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/expenses")}])},{default:w(()=>[...i[7]||(i[7]=[e("i",{class:"bi bi-receipt me-2"},null,-1),m(" Dépenses ",-1)])]),_:1},8,["href","class"])])):c("",!0),s(a)("suppliers")||s(a)("purchase-orders")||s(a)("delivery-notes")?(n(),o("li",Mt)):c("",!0),s(a)("suppliers")?(n(),o("li",Wt,[h(s(y),{href:s(p)("suppliers.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/suppliers")}])},{default:w(()=>[...i[8]||(i[8]=[e("i",{class:"bi bi-truck me-2"},null,-1),m(" Fournisseurs ",-1)])]),_:1},8,["href","class"])])):c("",!0),s(a)("purchase-orders")?(n(),o("li",Ut,[h(s(y),{href:s(p)("purchase-orders.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/purchase-orders")}])},{default:w(()=>[...i[9]||(i[9]=[e("i",{class:"bi bi-file-earmark-text me-2"},null,-1),m(" Bons de commande ",-1)])]),_:1},8,["href","class"])])):c("",!0),s(a)("delivery-notes")?(n(),o("li",zt,[h(s(y),{href:s(p)("delivery-notes.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/delivery-notes")}])},{default:w(()=>[...i[10]||(i[10]=[e("i",{class:"bi bi-clipboard-check me-2"},null,-1),m(" Bons de livraison ",-1)])]),_:1},8,["href","class"])])):c("",!0),s(a)("company")?(n(),o("li",Kt)):c("",!0),s(a)("company")?(n(),o("li",Xt,[h(s(y),{href:s(p)("company.edit"),class:$(["nav-link",{active:d.$page.url.startsWith("/company")}])},{default:w(()=>[...i[11]||(i[11]=[e("i",{class:"bi bi-building me-2"},null,-1),m(" Entreprise ",-1)])]),_:1},8,["href","class"])])):c("",!0),v.value?(n(),o("li",Jt)):c("",!0),v.value?(n(),o("li",Gt,[h(s(y),{href:s(p)("admin.users.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/admin/users")}])},{default:w(()=>[...i[12]||(i[12]=[e("i",{class:"bi bi-shield-lock me-2"},null,-1),m(" Utilisateurs ",-1)])]),_:1},8,["href","class"])])):c("",!0),v.value&&s(a)("backups")?(n(),o("li",Ht,[h(s(y),{href:s(p)("admin.backups.index"),class:$(["nav-link",{active:d.$page.url.startsWith("/admin/backups")}])},{default:w(()=>[...i[13]||(i[13]=[e("i",{class:"bi bi-database me-2"},null,-1),m(" Sauvegardes ",-1)])]),_:1},8,["href","class"])])):c("",!0)])])],2),e("div",Qt,[e("header",Yt,[e("div",Zt,[e("button",{class:"btn btn-sm btn-outline-primary d-md-none me-2",onClick:L,type:"button"},[...i[14]||(i[14]=[e("i",{class:"bi bi-list"},null,-1)])]),k.breadcrumbs&&k.breadcrumbs.length>0?(n(),o("nav",es,[e("ol",ts,[s(f).url.includes("/settings")?c("",!0):(n(),o("li",ss,[h(s(y),{href:s(p)("dashboard")},{default:w(()=>[...i[15]||(i[15]=[e("i",{class:"bi bi-house-door me-1"},null,-1),m(" Accueil ",-1)])]),_:1},8,["href"])])),(n(!0),o(j,null,I(k.breadcrumbs,(N,q)=>(n(),o("li",{key:q,class:$(["breadcrumb-item",{active:q===k.breadcrumbs.length-1}])},[N.href&&q<k.breadcrumbs.length-1?(n(),ne(s(y),{key:0,href:N.href},{default:w(()=>[m(g(N.title),1)]),_:2},1032,["href"])):(n(),o("span",is,g(N.title),1))],2))),128))])])):c("",!0),e("div",ns,[h(St,{notifications:T.value},null,8,["notifications"]),e("button",{onClick:S,class:"btn btn-sm btn-outline-primary",type:"button"},[e("i",{class:$(r.value?"bi bi-sun":"bi bi-moon")},null,2)]),e("div",os,[e("button",as,[i[16]||(i[16]=e("i",{class:"bi bi-person-circle"},null,-1)),e("span",ls,[m(g(d.$page.props.auth.user?.name||"Utilisateur")+" ",1),e("span",{class:$(["badge ms-2",D(d.$page.props.auth.user?.role)])},g(C(d.$page.props.auth.user?.role)),3)])]),e("ul",rs,[e("li",ds,[i[17]||(i[17]=e("div",{class:"small text-muted"},"Rôle",-1)),e("div",cs,g(C(d.$page.props.auth.user?.role)),1)]),i[20]||(i[20]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[h(s(y),{href:s(p)("profile.edit"),class:"dropdown-item"},{default:w(()=>[...i[18]||(i[18]=[e("i",{class:"bi bi-person me-2"},null,-1),m(" Profil ",-1)])]),_:1},8,["href"])]),i[21]||(i[21]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[h(s(y),{href:s(p)("logout"),method:"post",class:"dropdown-item text-danger"},{default:w(()=>[...i[19]||(i[19]=[e("i",{class:"bi bi-box-arrow-right me-2"},null,-1),m(" Déconnexion ",-1)])]),_:1},8,["href"])])])])])])]),_.value?(n(),o("div",{key:0,class:"sidebar-overlay d-md-none",onClick:L})):c("",!0),e("main",us,[ie(d.$slots,"default",{},void 0,!0)])]),h(le)]))}}),gs=X(ms,[["__scopeId","data-v-2de516f2"]]);export{gs as B,Ct as u};
