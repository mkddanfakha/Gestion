import{d as N,r as f,y as U,B as L,A as Y,z as $,C as H,b as o,a as l,c as O,m as Q,e as g,v as X,K as x,n as q,k as _,T as G,s as z,F as J,g as W,t as p,o as n}from"./app-eiUHFRb-.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"input-group"},te=["placeholder","disabled","onKeydown"],se=["onMousedown","onMouseenter"],le={class:"d-flex align-items-center"},ne={class:"flex-shrink-0 me-3"},oe={key:0,class:"bg-light rounded overflow-hidden d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"}},ae=["src","alt"],ie={key:1,class:"bg-light rounded d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px"}},de={class:"flex-grow-1"},ue={class:"d-flex align-items-center justify-content-between"},ce={class:"fw-medium"},re={class:"text-muted small ms-2"},ve={class:"d-flex align-items-center gap-2 mt-1"},fe={key:0,class:"badge bg-danger"},me={key:1,class:"badge bg-warning text-dark"},pe={key:2,class:"badge bg-success"},he={key:3,class:"badge bg-secondary"},we=N({__name:"ProductAutocomplete",props:{products:{},modelValue:{},placeholder:{default:"Rechercher un produit..."},disabled:{type:Boolean,default:!1},excludeProductIds:{default:()=>[]},isInvalid:{type:Boolean,default:!1},isValid:{type:Boolean,default:!1}},emits:["update:modelValue","selected"],setup(h,{expose:E,emit:F}){const c=h,b=F,P=f(null),w=f(null),a=f(""),i=f(!1),d=f(-1),m=f(null),r=f({top:0,left:0,width:0}),u=U(()=>{if(!a.value)return c.products.filter(s=>!c.excludeProductIds.includes(s.id)).slice(0,10);const e=a.value.toLowerCase();return c.products.filter(s=>{const t=s.name.toLowerCase().includes(e),y=!c.excludeProductIds.includes(s.id);return t&&y}).slice(0,10)}),k=e=>c.excludeProductIds.includes(e),v=()=>{if(w.value){const e=w.value.getBoundingClientRect();r.value={top:e.bottom+window.scrollY,left:e.left+window.scrollX,width:e.width}}},M=()=>{v(),i.value=!0},R=()=>{v(),i.value=!0,d.value=-1},S=()=>{setTimeout(()=>{i.value=!1},200)},I=e=>{k(e.id)||e.stock_quantity<=0||(m.value=e,a.value=e.name,b("update:modelValue",e.id),b("selected",e),i.value=!1)},V=()=>{u.value.length>0&&d.value>=0?I(u.value[d.value]):u.value.length>0&&I(u.value[0])},D=()=>{d.value<u.value.length-1&&d.value++},j=()=>{d.value>0&&d.value--},T=()=>{i.value=!1,d.value=-1},B=()=>{m.value=null,a.value="",b("update:modelValue",null),i.value=!1},A=e=>new Intl.NumberFormat("fr-FR").format(e)+" Fcfa";L(()=>c.modelValue,e=>{if(e&&e>0){const s=c.products.find(t=>t.id===e);s?(m.value=s,a.value=s.name):(m.value=null,a.value="")}else m.value=null,a.value=""},{immediate:!0}),L(i,e=>{e&&Y(()=>{v()})});const C=e=>{const s=e.target;if(w.value&&!w.value.contains(s)){const t=document.querySelector(".product-dropdown-menu");t&&!t.contains(s)&&(i.value=!1)}};return $(()=>{document.addEventListener("click",C),window.addEventListener("scroll",v,!0),window.addEventListener("resize",v)}),H(()=>{document.removeEventListener("click",C),window.removeEventListener("scroll",v,!0),window.removeEventListener("resize",v)}),E({focus:()=>P.value?.focus(),clear:B}),(e,s)=>(n(),o("div",{ref_key:"containerRef",ref:w,class:"product-autocomplete position-relative",style:{"z-index":"1"}},[l("div",ee,[Q(l("input",{ref_key:"inputRef",ref:P,"onUpdate:modelValue":s[0]||(s[0]=t=>a.value=t),type:"text",class:q(["form-control",{"is-invalid":h.isInvalid,"is-valid":h.isValid}]),placeholder:h.placeholder,disabled:h.disabled,onInput:R,onFocus:M,onBlur:S,onKeydown:[x(_(V,["prevent"]),["enter"]),x(_(D,["prevent"]),["arrow-down"]),x(_(j,["prevent"]),["arrow-up"]),x(T,["escape"])]},null,42,te),[[X,a.value]]),m.value?(n(),o("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:B},[...s[1]||(s[1]=[l("i",{class:"bi bi-x"},null,-1)])])):g("",!0)]),(n(),O(G,{to:"body"},[i.value&&u.value.length>0?(n(),o("div",{key:0,class:"product-dropdown-menu dropdown-menu show",style:z({position:"absolute",top:r.value.top+"px",left:r.value.left+"px",width:r.value.width+"px",zIndex:1050,maxHeight:"400px",overflowY:"auto"})},[(n(!0),o(J,null,W(u.value,(t,y)=>(n(),o("div",{key:t.id,class:q(["dropdown-item",{active:y===d.value,disabled:k(t.id)||t.stock_quantity<=0}]),onMousedown:_(K=>I(t),["prevent"]),onMouseenter:K=>d.value=y},[l("div",le,[l("div",ne,[t.image_url?(n(),o("div",oe,[l("img",{src:t.image_url,alt:t.name,class:"img-fluid",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,ae)])):(n(),o("div",ie,[...s[2]||(s[2]=[l("i",{class:"bi bi-box text-muted"},null,-1)])]))]),l("div",de,[l("div",ue,[l("div",ce,p(t.name),1),l("div",re,p(A(t.price)),1)]),l("div",ve,[t.stock_quantity<=0?(n(),o("span",fe," Rupture de stock ")):t.stock_quantity<=5?(n(),o("span",me," Stock faible: "+p(t.stock_quantity)+" "+p(t.unit),1)):(n(),o("span",pe," Stock: "+p(t.stock_quantity)+" "+p(t.unit),1)),k(t.id)?(n(),o("span",he," Déjà sélectionné ")):g("",!0)])])])],42,se))),128))],4)):g("",!0),i.value&&a.value&&u.value.length===0?(n(),o("div",{key:1,class:"product-dropdown-menu dropdown-menu show",style:z({position:"absolute",top:r.value.top+"px",left:r.value.left+"px",width:r.value.width+"px",zIndex:1050})},[...s[3]||(s[3]=[l("div",{class:"dropdown-item text-muted"}," Aucun produit trouvé ",-1)])],4)):g("",!0)]))],512))}}),xe=Z(we,[["__scopeId","data-v-5ed39f61"]]);export{xe as P};
