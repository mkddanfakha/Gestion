import{d as Q,r as G,i as H,y as h,c as J,w as I,a as t,j,u as i,l as D,f as _,m as v,b as a,e as m,n as f,o as n,F,g as P,t as c,p as T,v as y}from"./app-CGJPUJEO.js";import{_ as W}from"./AppLayout.vue_vue_type_script_setup_true_lang-DOygplc7.js";import{r as L}from"./routes-C8N3XD_S.js";import{u as X}from"./useSweetAlert-CjcY7Pj8.js";import{P as Y}from"./ProductAutocomplete-DOquYZIO.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BootstrapLayout-Bp9zEE-w.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const ee={class:"d-flex justify-content-between align-items-center mb-4"},te={class:"row"},se={class:"col-lg-8"},oe={class:"card mb-4"},ie={class:"card-body"},re={class:"row g-3"},de={class:"col-md-6"},le=["value"],ne={key:0,class:"invalid-feedback"},ae={key:1,class:"invalid-feedback"},ue={class:"col-md-6"},ce={key:0,class:"invalid-feedback"},pe={key:1,class:"invalid-feedback"},me={class:"col-md-6"},_e={key:0,class:"invalid-feedback"},ve={key:1,class:"invalid-feedback"},be={class:"col-md-6"},fe={key:0,class:"invalid-feedback"},ye={key:1,class:"invalid-feedback"},ke={class:"col-12"},xe={key:0,class:"invalid-feedback"},ge={class:"card mb-4"},qe={class:"card-body"},we={key:0,class:"text-center py-4 text-muted"},$e={key:1},Ce={class:"row g-3"},Ve={class:"col-md-5"},Ie={key:0,class:"invalid-feedback d-block"},je={key:1,class:"invalid-feedback d-block"},Le={class:"col-md-2"},Ae=["onUpdate:modelValue","onInput","onBlur"],Be={key:0,class:"invalid-feedback"},Se={class:"col-md-3"},Ue=["onUpdate:modelValue","onInput","onBlur"],he={key:0,class:"invalid-feedback"},De={class:"col-md-2"},Fe=["value"],Pe={class:"col-12 text-end"},Te=["onClick"],Ee={class:"col-lg-4"},Re={class:"card sticky-top",style:{top:"20px"}},ze={class:"card-body"},Me={class:"mb-3"},Ne={class:"d-flex justify-content-between mb-2"},Oe={class:"fw-medium"},Ke={class:"d-flex justify-content-between mb-2"},Qe={class:"fw-medium"},Ge={class:"d-flex justify-content-between mb-2"},He={class:"d-flex justify-content-between mb-2"},Je={class:"d-flex justify-content-between"},We={class:"fw-bold text-success fs-5"},Xe={class:"d-grid gap-2"},Ye=["disabled"],Ze={key:0,class:"spinner-border spinner-border-sm me-2"},et={key:1,class:"bi bi-check-circle me-1"},tt=Q({__name:"Create",props:{suppliers:{},products:{}},setup(A){const{success:E,error:x}=X(),d=G({}),R=()=>{const r={};return o.supplier_id||(r.supplier_id="Le fournisseur est requis."),o.order_date||(r.order_date="La date de commande est requise."),o.expected_delivery_date&&o.order_date&&new Date(o.expected_delivery_date)<new Date(o.order_date)&&(r.expected_delivery_date="La date de livraison ne peut pas être antérieure à la date de commande."),o.status||(r.status="Le statut est requis."),o.items.length===0?r.items="Au moins un article est requis.":o.items.forEach((e,s)=>{!e.product_id||e.product_id===0?r[`items.${s}.product_id`]="Le produit est requis.":g(e.product_id,s)&&(r[`items.${s}.product_id`]="Ce produit est déjà sélectionné."),e.quantity<=0&&(r[`items.${s}.quantity`]="La quantité doit être supérieure à 0."),e.unit_price<=0&&(r[`items.${s}.unit_price`]="Le prix unitaire doit être supérieur à 0.")}),r},b=(r,e)=>{d.value[r]&&delete d.value[r];let s="";switch(r){case"supplier_id":e||(s="Le fournisseur est requis.");break;case"order_date":e||(s="La date de commande est requise.");break;case"expected_delivery_date":e&&o.order_date&&new Date(e)<new Date(o.order_date)&&(s="La date de livraison ne peut pas être antérieure à la date de commande.");break;case"status":e||(s="Le statut est requis.");break}s&&(d.value[r]=s)},k=(r,e,s)=>{const l=`items.${r}.${e}`;d.value[l]&&delete d.value[l];let u="";switch(e){case"product_id":!s||s===0?u="Le produit est requis.":g(s,r)&&(u="Ce produit est déjà sélectionné.");break;case"quantity":s<=0&&(u="La quantité doit être supérieure à 0.");break;case"unit_price":s<=0&&(u="Le prix unitaire doit être supérieur à 0.");break}u&&(d.value[l]=u)},o=H({supplier_id:"",order_date:new Date().toISOString().split("T")[0],expected_delivery_date:"",status:"draft",notes:"",tax_amount:0,discount_amount:0,subtotal:0,total_amount:0,items:[]}),z=()=>{o.items.push({product_id:0,quantity:1,unit_price:0,total_price:0})},M=r=>{o.items.splice(r,1),S()},g=(r,e)=>o.items.some((s,l)=>s.product_id===r&&l!==e),B=r=>{const e=o.items[r];return!e.product_id||e.product_id===0?!1:g(e.product_id,r)},N=r=>o.items.map((e,s)=>s!==r?e.product_id:null).filter(e=>e!==null&&e>0),O=(r,e)=>{const s=o.items[e];s.product_id=r.id,s.unit_price=r.cost_price||r.price,q(e),k(e,"product_id",s.product_id)},q=r=>{const e=o.items[r];e.total_price=e.quantity*e.unit_price,S()},S=()=>{o.subtotal=o.items.reduce((r,e)=>r+e.total_price,0),w()},w=()=>{o.total_amount=o.subtotal+o.tax_amount-o.discount_amount},$=h(()=>o.items.reduce((r,e)=>r+e.total_price,0)),U=h(()=>$.value+o.tax_amount-o.discount_amount),C=r=>new Intl.NumberFormat("fr-FR").format(r)+" Fcfa",K=()=>{d.value={};const r=R();if(r&&Object.keys(r).length>0){d.value=r,r.items?x("Au moins un article est requis pour créer un bon de commande."):x("Veuillez corriger les erreurs dans le formulaire.");return}o.subtotal=$.value,o.total_amount=U.value,o.post(L("purchase-orders.store"),{onSuccess:()=>{E("Bon de commande créé avec succès !")},onError:()=>{x("Erreur lors de la création du bon de commande.")}})},{errors:p,processing:V}=o;return(r,e)=>(n(),J(W,null,{default:I(()=>[t("div",ee,[e[16]||(e[16]=t("div",null,[t("h1",{class:"h2 mb-1"},"Nouveau bon de commande"),t("p",{class:"text-muted mb-0"},"Créez un nouveau bon de commande")],-1)),j(i(D),{href:i(L)("purchase-orders.index"),class:"btn btn-outline-secondary"},{default:I(()=>[...e[15]||(e[15]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),_(" Retour à la liste ",-1)])]),_:1},8,["href"])]),t("form",null,[t("div",te,[t("div",se,[t("div",oe,[e[24]||(e[24]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Informations générales")],-1)),t("div",ie,[t("div",re,[t("div",de,[e[18]||(e[18]=t("label",{class:"form-label"},[_(" Fournisseur "),t("span",{class:"text-danger"},"*")],-1)),v(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>i(o).supplier_id=s),required:"",class:f(["form-select",{"is-invalid":i(p).supplier_id||d.value.supplier_id}]),onBlur:e[1]||(e[1]=s=>b("supplier_id",i(o).supplier_id)),onChange:e[2]||(e[2]=s=>b("supplier_id",i(o).supplier_id))},[e[17]||(e[17]=t("option",{value:""},"Sélectionner un fournisseur",-1)),(n(!0),a(F,null,P(A.suppliers,s=>(n(),a("option",{key:s.id,value:s.id},c(s.name),9,le))),128))],34),[[T,i(o).supplier_id]]),i(p).supplier_id?(n(),a("div",ne,c(i(p).supplier_id),1)):m("",!0),d.value.supplier_id?(n(),a("div",ae,c(d.value.supplier_id),1)):m("",!0)]),t("div",ue,[e[20]||(e[20]=t("label",{class:"form-label"},[_(" Statut "),t("span",{class:"text-danger"},"*")],-1)),v(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>i(o).status=s),required:"",class:f(["form-select",{"is-invalid":i(p).status||d.value.status}]),onBlur:e[4]||(e[4]=s=>b("status",i(o).status)),onChange:e[5]||(e[5]=s=>b("status",i(o).status))},[...e[19]||(e[19]=[t("option",{value:"draft"},"Brouillon",-1),t("option",{value:"sent"},"Envoyé",-1),t("option",{value:"confirmed"},"Confirmé",-1),t("option",{value:"partially_received"},"Partiellement reçu",-1),t("option",{value:"received"},"Reçu",-1),t("option",{value:"cancelled"},"Annulé",-1)])],34),[[T,i(o).status]]),i(p).status?(n(),a("div",ce,c(i(p).status),1)):m("",!0),d.value.status?(n(),a("div",pe,c(d.value.status),1)):m("",!0)]),t("div",me,[e[21]||(e[21]=t("label",{class:"form-label"},[_(" Date de commande "),t("span",{class:"text-danger"},"*")],-1)),v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>i(o).order_date=s),type:"date",required:"",class:f(["form-control",{"is-invalid":i(p).order_date||d.value.order_date}]),onBlur:e[7]||(e[7]=s=>b("order_date",i(o).order_date)),onInput:e[8]||(e[8]=s=>b("order_date",i(o).order_date))},null,34),[[y,i(o).order_date]]),i(p).order_date?(n(),a("div",_e,c(i(p).order_date),1)):m("",!0),d.value.order_date?(n(),a("div",ve,c(d.value.order_date),1)):m("",!0)]),t("div",be,[e[22]||(e[22]=t("label",{class:"form-label"},"Date de livraison prévue",-1)),v(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>i(o).expected_delivery_date=s),type:"date",class:f(["form-control",{"is-invalid":i(p).expected_delivery_date||d.value.expected_delivery_date}]),onBlur:e[10]||(e[10]=s=>b("expected_delivery_date",i(o).expected_delivery_date)),onInput:e[11]||(e[11]=s=>b("expected_delivery_date",i(o).expected_delivery_date))},null,34),[[y,i(o).expected_delivery_date]]),i(p).expected_delivery_date?(n(),a("div",fe,c(i(p).expected_delivery_date),1)):m("",!0),d.value.expected_delivery_date?(n(),a("div",ye,c(d.value.expected_delivery_date),1)):m("",!0)]),t("div",ke,[e[23]||(e[23]=t("label",{class:"form-label"},"Notes",-1)),v(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=s=>i(o).notes=s),rows:"3",class:f(["form-control",{"is-invalid":i(p).notes}]),placeholder:"Ajoutez des notes sur ce bon de commande..."},null,2),[[y,i(o).notes]]),i(p).notes?(n(),a("div",xe,c(i(p).notes),1)):m("",!0)])])])]),t("div",ge,[t("div",{class:"card-header d-flex justify-content-between align-items-center"},[e[26]||(e[26]=t("h5",{class:"card-title mb-0"},"Articles",-1)),t("button",{type:"button",onClick:z,class:"btn btn-primary btn-sm"},[...e[25]||(e[25]=[t("i",{class:"bi bi-plus-circle me-1"},null,-1),_(" Ajouter un article ",-1)])])]),t("div",qe,[i(o).items.length===0?(n(),a("div",we,[...e[27]||(e[27]=[t("i",{class:"bi bi-cart-x fs-1 mb-3"},null,-1),t("p",null,'Aucun article ajouté. Cliquez sur "Ajouter un article" pour commencer.',-1)])])):(n(),a("div",$e,[(n(!0),a(F,null,P(i(o).items,(s,l)=>(n(),a("div",{key:l,class:"border rounded p-3 mb-3"},[t("div",Ce,[t("div",Ve,[e[28]||(e[28]=t("label",{class:"form-label"},[_("Produit "),t("span",{class:"text-danger"},"*")],-1)),j(Y,{modelValue:s.product_id,"onUpdate:modelValue":u=>s.product_id=u,products:A.products,"exclude-product-ids":N(l),"is-invalid":!!d.value[`items.${l}.product_id`]||B(l),placeholder:"Rechercher un produit...",onSelected:u=>O(u,l)},null,8,["modelValue","onUpdate:modelValue","products","exclude-product-ids","is-invalid","onSelected"]),d.value[`items.${l}.product_id`]?(n(),a("div",Ie,c(d.value[`items.${l}.product_id`]),1)):m("",!0),B(l)?(n(),a("div",je," Ce produit est déjà sélectionné dans ce bon de commande. ")):m("",!0)]),t("div",Le,[e[29]||(e[29]=t("label",{class:"form-label"},[_("Quantité "),t("span",{class:"text-danger"},"*")],-1)),v(t("input",{"onUpdate:modelValue":u=>s.quantity=u,type:"number",min:"1",required:"",class:f(["form-control",{"is-invalid":d.value[`items.${l}.quantity`]}]),onInput:u=>{q(l),k(l,"quantity",s.quantity)},onBlur:u=>k(l,"quantity",s.quantity)},null,42,Ae),[[y,s.quantity,void 0,{number:!0}]]),d.value[`items.${l}.quantity`]?(n(),a("div",Be,c(d.value[`items.${l}.quantity`]),1)):m("",!0)]),t("div",Se,[e[30]||(e[30]=t("label",{class:"form-label"},[_("Prix unitaire "),t("span",{class:"text-danger"},"*")],-1)),v(t("input",{"onUpdate:modelValue":u=>s.unit_price=u,type:"number",step:"0.01",min:"0",required:"",class:f(["form-control",{"is-invalid":d.value[`items.${l}.unit_price`]}]),onInput:u=>{q(l),k(l,"unit_price",s.unit_price)},onBlur:u=>k(l,"unit_price",s.unit_price)},null,42,Ue),[[y,s.unit_price,void 0,{number:!0}]]),d.value[`items.${l}.unit_price`]?(n(),a("div",he,c(d.value[`items.${l}.unit_price`]),1)):m("",!0)]),t("div",De,[e[31]||(e[31]=t("label",{class:"form-label"},"Total",-1)),t("input",{value:C(s.total_price),type:"text",class:"form-control",readonly:""},null,8,Fe)]),t("div",Pe,[t("button",{type:"button",onClick:u=>M(l),class:"btn btn-sm btn-outline-danger"},[...e[32]||(e[32]=[t("i",{class:"bi bi-trash me-1"},null,-1),_(" Supprimer ",-1)])],8,Te)])])]))),128))]))])])]),t("div",Ee,[t("div",Re,[e[40]||(e[40]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Résumé")],-1)),t("div",ze,[t("div",Me,[t("div",Ne,[e[33]||(e[33]=t("span",null,"Articles:",-1)),t("span",Oe,c(i(o).items.length),1)]),t("div",Ke,[e[34]||(e[34]=t("span",null,"Sous-total:",-1)),t("span",Qe,c(C($.value)),1)]),t("div",Ge,[e[35]||(e[35]=t("span",null,"Taxes:",-1)),v(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>i(o).tax_amount=s),type:"number",step:"0.01",min:"0",class:"form-control form-control-sm",style:{width:"120px"},onInput:w},null,544),[[y,i(o).tax_amount,void 0,{number:!0}]])]),t("div",He,[e[36]||(e[36]=t("span",null,"Remise:",-1)),v(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>i(o).discount_amount=s),type:"number",step:"0.01",min:"0",class:"form-control form-control-sm",style:{width:"120px"},onInput:w},null,544),[[y,i(o).discount_amount,void 0,{number:!0}]])]),e[38]||(e[38]=t("hr",null,null,-1)),t("div",Je,[e[37]||(e[37]=t("span",{class:"fw-bold"},"Total:",-1)),t("span",We,c(C(U.value)),1)])]),t("div",Xe,[t("button",{type:"button",onClick:K,class:"btn btn-success",disabled:i(V)||i(o).items.length===0},[i(V)?(n(),a("span",Ze)):(n(),a("i",et)),_(" "+c(i(V)?"Création...":"Créer le bon de commande"),1)],8,Ye),j(i(D),{href:i(L)("purchase-orders.index"),class:"btn btn-outline-secondary"},{default:I(()=>[...e[39]||(e[39]=[_(" Annuler ",-1)])]),_:1},8,["href"])])])])])])])]),_:1}))}}),ut=Z(tt,[["__scopeId","data-v-ece825c5"]]);export{ut as default};
