import{d as J,r as L,z as B,C as X,b as a,e as u,a as e,o,x as z,I as U,h as F,y as R,B as Y,n as P,t as v,k as O,f as m,F as N,g as W,j as h,u as s,l as y,w,A as Q,J as ae,c as le}from"./app-C-EDQi3A.js";import{r as p}from"./routes-C8N3XD_S.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={key:0,class:"loading-overlay"},de=J({__name:"LoadingSpinner",setup(r){const n=L(!1),_=f=>{n.value=f.detail};return B(()=>{window.addEventListener("loading-state-changed",_),window.addEventListener("inertia:start",()=>{n.value=!0}),window.addEventListener("inertia:finish",()=>{setTimeout(()=>{n.value=!1},300)})}),X(()=>{window.removeEventListener("loading-state-changed",_),window.removeEventListener("inertia:start",()=>{}),window.removeEventListener("inertia:finish",()=>{})}),(f,b)=>n.value?(o(),a("div",re,[...b[0]||(b[0]=[e("div",{class:"loading-content"},[e("div",{class:"spinner-container"},[e("div",{class:"spinner-grow text-primary",role:"status",style:{"animation-delay":"0s"}},[e("span",{class:"visually-hidden"},"Loading...")]),e("div",{class:"spinner-grow text-success",role:"status",style:{"animation-delay":"0.2s"}},[e("span",{class:"visually-hidden"},"Loading...")]),e("div",{class:"spinner-grow text-warning",role:"status",style:{"animation-delay":"0.4s"}},[e("span",{class:"visually-hidden"},"Loading...")])])],-1)])])):u("",!0)}}),ce=H(de,[["__scopeId","data-v-fe3aa04c"]]);let C=null,ee=!1;const ue=async()=>{try{return(!C||C.state==="closed")&&(C=new(window.AudioContext||window.webkitAudioContext),ee=!0),C.state==="suspended"&&await C.resume(),ee=!0,C}catch(r){return console.error("Erreur lors de l'activation du contexte audio:",r),null}},Z=()=>{try{if(!C||C.state==="closed")return;C.state==="suspended"?C.resume().then(()=>{te(C)}).catch(r=>{console.error("Erreur lors de la reprise du contexte audio:",r)}):te(C)}catch(r){console.error("Erreur lors de la lecture du son:",r)}},te=r=>{try{const n=r.createOscillator(),_=r.createOscillator(),f=r.createGain();n.connect(f),_.connect(f),f.connect(r.destination),n.frequency.value=800,n.type="sine",_.frequency.value=1e3,_.type="sine";const b=r.currentTime,k=.01,g=.05,S=.2,x=k+g+.1;f.gain.setValueAtTime(0,b),f.gain.linearRampToValueAtTime(.4,b+k),f.gain.exponentialRampToValueAtTime(S,b+k+g),f.gain.setValueAtTime(S,b+k+g),f.gain.exponentialRampToValueAtTime(.01,b+x),n.start(b),_.start(b),n.stop(b+x),_.stop(b+x),n.onended=()=>{n.disconnect()},_.onended=()=>{_.disconnect()}}catch(n){console.error("Erreur lors de la génération du son:",n)}},me=()=>{const n=z().props.auth?.user?.id,_=L({salesDueToday:[],lowStockProducts:[],expiringProducts:[]}),f=L(!1),b=()=>{if(n&&!f.value)try{if(!U){console.error("Echo n'est pas disponible. Vérifiez que Pusher est correctement configuré."),console.error("Vérifiez que VITE_PUSHER_APP_KEY est défini dans .env et que les assets ont été recompilés avec npm run build");return}if(!window.Echo?.connector?.pusher?.key){console.error("La clé Pusher n'est pas configurée. Vérifiez VITE_PUSHER_APP_KEY dans .env et recompilez les assets.");return}const S=U.private(`user.${n}.notifications`);S.subscribed(()=>{f.value=!0}),S.error(c=>{console.error("Erreur lors de la souscription au canal:",c),c.status===403?console.error("Accès refusé: Vérifiez les permissions dans routes/channels.php"):c.status===404&&console.error("Canal non trouvé: Vérifiez que la route /broadcasting/auth est accessible"),f.value=!1}),S.listen(".notification.sent",c=>{if(c.notification){Z(),window.dispatchEvent(new CustomEvent("notification-received",{detail:c.notification}));const x=c.notification?.type==="expiring_product"?1e3:500;setTimeout(()=>{F.reload({only:["notifications"],preserveScroll:!0,preserveState:!1,onSuccess:E=>{const A=E.props.notifications;window.dispatchEvent(new CustomEvent("notifications-updated",{detail:A}))},onError:E=>{console.error("Erreur lors du rechargement des notifications:",E)},onFinish:()=>{}})},x)}})}catch(g){console.error("Erreur lors de l'écoute des notifications:",g),f.value=!1}},k=()=>{if(!(!n||!f.value))try{U.leave(`user.${n}.notifications`),f.value=!1}catch(g){console.error("Erreur lors de l'arrêt de l'écoute:",g)}};return B(()=>{if(n){b();const g=()=>{ue().catch(S=>{console.error("Erreur lors de l'activation de l'audio:",S)})};document.addEventListener("click",g,{once:!1,passive:!0}),document.addEventListener("keydown",g,{once:!1,passive:!0}),document.addEventListener("touchstart",g,{once:!1,passive:!0}),document.addEventListener("mousedown",g,{once:!1,passive:!0})}}),X(()=>{k()}),{notifications:_,startListening:b,stopListening:k,isListening:f,testSound:()=>{Z()}}};typeof window<"u"&&(window.testNotificationSound=()=>{Z()});const I="Africa/Dakar",K="fr-FR",pe=r=>{const n=typeof r=="string"?new Date(r):r;return new Intl.DateTimeFormat(K,{timeZone:I,day:"2-digit",month:"2-digit",year:"numeric"}).format(n)},_s=r=>{const n=typeof r=="string"?new Date(r):r;return new Intl.DateTimeFormat(K,{timeZone:I,day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(n)},xs=r=>{const n=typeof r=="string"?new Date(r):r;return new Intl.DateTimeFormat(K,{timeZone:I,hour:"2-digit",minute:"2-digit"}).format(n)},fe=()=>new Date(new Date().toLocaleString("en-US",{timeZone:I})),Ts=r=>{if(!r)return"";const n=typeof r=="string"?new Date(r):r;return new Intl.DateTimeFormat("en-CA",{timeZone:I,year:"numeric",month:"2-digit",day:"2-digit"}).format(n)},Ps=()=>{const r=fe();return new Intl.DateTimeFormat(K,{timeZone:I,month:"long"}).format(r)},be={class:"dropdown"},ge=["id"],ve=["data-count"],he=["aria-labelledby"],ye={class:"notification-header"},we={class:"d-flex justify-content-between align-items-center p-3 border-bottom bg-light"},ke={class:"mb-0 fw-bold d-flex align-items-center"},_e={key:0,class:"badge bg-primary ms-2"},xe=["disabled"],Te={key:0,class:"spinner-border spinner-border-sm me-1",role:"status"},Pe={key:1,class:"bi bi-check-all"},$e={key:0,class:"notification-empty"},Se={class:"notification-section-header"},Ce={class:"p-2 bg-warning bg-opacity-10 border-bottom"},Ee={class:"d-flex justify-content-between align-items-center"},De={class:"flex-grow-1"},Le={class:"mb-1 small fw-bold d-flex align-items-center"},Ae={class:"badge bg-warning text-dark ms-2"},je={class:"mb-0 small text-muted"},Ne={class:"dropdown-item notification-link d-flex align-items-start"},Ve={class:"d-flex justify-content-between align-items-start"},Oe={class:"flex-grow-1"},Re={class:"fw-medium small d-flex align-items-center"},qe={class:"text-muted small mt-1"},Ie={class:"badge bg-warning text-dark ms-2 flex-shrink-0"},Fe=["onClick"],Be={key:0,class:"notification-more"},Me={class:"notification-section-header"},We={class:"p-2 bg-info bg-opacity-10 border-bottom"},ze={class:"d-flex justify-content-between align-items-center"},Ke={class:"flex-grow-1"},Ue={class:"mb-1 small fw-bold d-flex align-items-center"},Ze={class:"badge bg-info text-white ms-2"},Je={class:"mb-0 small text-muted"},Xe={class:"dropdown-item notification-link d-flex align-items-start"},He={class:"d-flex align-items-start"},Ge={class:"me-2 flex-shrink-0"},Ye=["src","alt"],Qe={key:1,class:"bi bi-box-seam text-muted",style:{"font-size":"40px",width:"40px",height:"40px",display:"flex","align-items":"center","justify-content":"center"}},et={class:"flex-grow-1 d-flex justify-content-between align-items-start"},tt={class:"flex-grow-1"},st={class:"fw-medium small d-flex align-items-center"},it={class:"text-muted small mt-1"},nt={class:"badge bg-info text-white ms-2 flex-shrink-0"},ot=["onClick"],at={key:0,class:"notification-more"},lt={class:"notification-section-header"},rt={class:"p-2 bg-danger bg-opacity-10 border-bottom"},dt={class:"d-flex justify-content-between align-items-center"},ct={class:"flex-grow-1"},ut={class:"mb-1 small fw-bold d-flex align-items-center"},mt={class:"badge bg-danger ms-2"},pt={class:"mb-0 small text-muted"},ft={class:"dropdown-item notification-link d-flex align-items-start"},bt={class:"d-flex align-items-start"},gt={class:"me-2 flex-shrink-0"},vt=["src","alt"],ht={key:1,class:"bi bi-box-seam text-muted",style:{"font-size":"40px",width:"40px",height:"40px",display:"flex","align-items":"center","justify-content":"center"}},yt={class:"flex-grow-1 d-flex justify-content-between align-items-start"},wt={class:"flex-grow-1"},kt={class:"fw-medium small d-flex align-items-center"},_t={class:"text-muted small mt-1"},xt={key:0},Tt={key:0,class:"text-danger fw-medium"},Pt={key:1,class:"text-danger fw-medium"},$t={key:2,class:"text-warning fw-medium"},St=["onClick"],Ct={key:0,class:"notification-more"},Et={key:2,class:"notification-footer"},Dt={class:"p-2 border-top bg-light text-center"},Lt=J({__name:"NotificationBell",props:{notifications:{}},setup(r){const n=r,_=L(`notification-dropdown-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),f=L(0),b=z(),k=()=>b.props.csrf_token||document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",g=L({salesDueToday:[],lowStockProducts:[],lowStockProductsTotal:void 0,expiringProducts:[],expiringProductsTotal:void 0});(()=>{const T=b.props.notifications||n.notifications||{salesDueToday:[],lowStockProducts:[],expiringProducts:[]};g.value={salesDueToday:T.salesDueToday||[],lowStockProducts:T.lowStockProducts||[],lowStockProductsTotal:T.lowStockProductsTotal,expiringProducts:T.expiringProducts||[],expiringProductsTotal:T.expiringProductsTotal}})();const c=R(()=>g.value),x=L(0),E=()=>{const T=g.value.salesDueToday?.length||0,t=g.value.lowStockProductsTotal??(g.value.lowStockProducts?.length||0),l=g.value.expiringProductsTotal??(g.value.expiringProducts?.length||0),$=T+t+l,q=x.value;$!==q&&(x.value=$,Q(()=>{f.value++}))};Y(g,()=>{E()},{deep:!0,immediate:!0});let A=null;Y(()=>b.props.notifications,async T=>{const t=T;t&&({...g.value},g.value={salesDueToday:Array.isArray(t.salesDueToday)?[...t.salesDueToday]:[],lowStockProducts:Array.isArray(t.lowStockProducts)?[...t.lowStockProducts]:[],lowStockProductsTotal:t.lowStockProductsTotal,expiringProducts:Array.isArray(t.expiringProducts)?[...t.expiringProducts]:[],expiringProductsTotal:t.expiringProductsTotal},E())},{deep:!0,immediate:!0});const D=L(!1),d=async(T,t,l)=>{if(l){if(l.target.closest("a")){fetch(p("notifications.mark-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":k(),Accept:"application/json"},body:JSON.stringify({type:T,id:t})}).catch(q=>{});return}l.preventDefault(),l.stopPropagation()}try{(await fetch(p("notifications.mark-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":k(),Accept:"application/json"},body:JSON.stringify({type:T,id:t})})).ok&&F.reload({only:["notifications"]})}catch($){console.error("Erreur lors du marquage comme lu:",$)}},i=async T=>{if(!D.value){D.value=!0;try{(await fetch(p("notifications.mark-all-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":k(),Accept:"application/json"},body:JSON.stringify({type:T})})).ok&&F.reload({only:["notifications"]})}catch(t){console.error("Erreur lors du marquage de toutes les notifications comme lues:",t)}finally{D.value=!1}}},j=async T=>{if(T.preventDefault(),T.stopPropagation(),!D.value){D.value=!0;try{if((await fetch(p("notifications.mark-all-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":k(),Accept:"application/json"},body:JSON.stringify({type:"all"})})).ok){const l=_.value,$=document.getElementById(l);if($){const q=window.bootstrap;if(q&&q.Dropdown){const G=q.Dropdown.getInstance($);G&&G.hide()}}F.reload({only:["notifications"]})}}catch(t){console.error("Erreur lors du marquage de toutes les notifications comme lues:",t)}finally{D.value=!1}}},V=T=>new Intl.NumberFormat("fr-FR").format(T)+" Fcfa",{startListening:se,stopListening:ie,testSound:ne}=me(),oe=async()=>{try{(await fetch(p("notifications.test"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}})).ok&&ne()}catch{}};typeof window<"u"&&(window.testRealtimeNotification=oe);let M=null;return B(()=>{se(),A=()=>{},M=()=>{Q(()=>{E()})},window.addEventListener("notification-received",A),window.addEventListener("notifications-updated",M)}),X(()=>{ie(),A&&window.removeEventListener("notification-received",A),M&&window.removeEventListener("notifications-updated",M)}),(T,t)=>(o(),a("div",be,[e("button",{class:P(["btn btn-sm btn-outline-primary position-relative notification-bell-btn",{"has-notifications":x.value>0}]),type:"button",id:_.value,"data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},[t[4]||(t[4]=e("i",{class:"bi bi-bell fs-5"},null,-1)),x.value>0?(o(),a("span",{key:`badge-${x.value}-${f.value}`,class:P(["position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-badge",{pulse:x.value>0}]),"data-count":x.value},v(x.value>99?"99+":x.value),11,ve)):u("",!0)],10,ge),e("ul",{class:"dropdown-menu dropdown-menu-end shadow-lg notification-dropdown","aria-labelledby":_.value,onClick:t[3]||(t[3]=O(()=>{},["stop"]))},[e("li",ye,[e("div",we,[e("h6",ke,[t[5]||(t[5]=e("i",{class:"bi bi-bell-fill me-2 text-primary"},null,-1)),t[6]||(t[6]=m(" Notifications ",-1)),x.value>0?(o(),a("span",_e,v(x.value),1)):u("",!0)]),x.value>0?(o(),a("button",{key:0,onClick:j,class:"btn btn-sm btn-link text-decoration-none p-0 text-muted",type:"button",title:"Tout marquer comme lu",disabled:D.value},[D.value?(o(),a("span",Te)):(o(),a("i",Pe))],8,xe)):u("",!0)])]),x.value===0?(o(),a("li",$e,[...t[7]||(t[7]=[e("div",{class:"p-5 text-center text-muted"},[e("i",{class:"bi bi-bell-slash fs-1 d-block mb-3 text-muted opacity-50"}),e("p",{class:"mb-0 fw-medium"},"Aucune notification"),e("p",{class:"small mb-0 mt-2"},"Vous êtes à jour !")],-1)])])):(o(),a(N,{key:1},[c.value.salesDueToday&&c.value.salesDueToday.length>0?(o(),a(N,{key:0},[e("li",Se,[e("div",Ce,[e("div",Ee,[e("div",De,[e("h6",Le,[t[8]||(t[8]=e("i",{class:"bi bi-calendar-event-fill me-2 text-warning"},null,-1)),t[9]||(t[9]=m(" Ventes avec échéance aujourd'hui ",-1)),e("span",Ae,v(c.value.salesDueToday.length),1)]),e("p",je,v(c.value.salesDueToday.length)+" vente(s) non payée(s) ",1)]),e("button",{onClick:t[0]||(t[0]=O(l=>i("sale_due_today"),["stop"])),class:"btn btn-sm btn-link text-muted p-0 ms-2",type:"button",title:"Marquer toutes comme lues"},[...t[10]||(t[10]=[e("i",{class:"bi bi-check-all"},null,-1)])])])])]),(o(!0),a(N,null,W(c.value.salesDueToday.slice(0,3),l=>(o(),a("li",{key:l.id,class:"notification-item"},[e("div",Ne,[h(s(y),{href:s(p)("sales.show",{id:l.id}),class:"flex-grow-1 text-decoration-none",onClick:$=>d("sale_due_today",l.id,$)},{default:w(()=>[e("div",Ve,[e("div",Oe,[e("div",Re,[t[11]||(t[11]=e("i",{class:"bi bi-receipt me-2 text-warning"},null,-1)),m(" Vente "+v(l.sale_number),1)]),e("div",qe,[t[12]||(t[12]=e("i",{class:"bi bi-person me-1"},null,-1)),m(" "+v(l.customer),1)])]),e("span",Ie,v(V(l.remaining_amount)),1)])]),_:2},1032,["href","onClick"]),e("button",{onClick:O($=>d("sale_due_today",l.id),["stop"]),class:"btn btn-sm btn-link text-muted p-0 ms-2 flex-shrink-0",type:"button",title:"Marquer comme lu"},[...t[13]||(t[13]=[e("i",{class:"bi bi-check-circle"},null,-1)])],8,Fe)])]))),128)),c.value.salesDueToday.length>3?(o(),a("li",Be,[h(s(y),{href:s(p)("sales.index",{due_date:new Date().toISOString().split("T")[0]}),class:"dropdown-item text-center text-primary small fw-medium"},{default:w(()=>[t[14]||(t[14]=e("i",{class:"bi bi-arrow-right-circle me-1"},null,-1)),m(" Voir toutes ("+v(c.value.salesDueToday.length)+") ",1)]),_:1},8,["href"])])):u("",!0),t[15]||(t[15]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1))],64)):u("",!0),c.value.lowStockProducts&&c.value.lowStockProducts.length>0?(o(),a(N,{key:1},[e("li",Me,[e("div",We,[e("div",ze,[e("div",Ke,[e("h6",Ue,[t[16]||(t[16]=e("i",{class:"bi bi-exclamation-triangle-fill me-2 text-info"},null,-1)),t[17]||(t[17]=m(" Stock faible ",-1)),e("span",Ze,v(c.value.lowStockProducts.length),1)]),e("p",Je,v(c.value.lowStockProducts.length)+" produit(s) en rupture ou niveau faible ",1)]),e("button",{onClick:t[1]||(t[1]=O(l=>i("low_stock"),["stop"])),class:"btn btn-sm btn-link text-muted p-0 ms-2",type:"button",title:"Marquer toutes comme lues"},[...t[18]||(t[18]=[e("i",{class:"bi bi-check-all"},null,-1)])])])])]),(o(!0),a(N,null,W(c.value.lowStockProducts.slice(0,3),l=>(o(),a("li",{key:l.id,class:"notification-item"},[e("div",Xe,[h(s(y),{href:s(p)("products.show",{id:l.id}),class:"flex-grow-1 text-decoration-none",onClick:$=>d("low_stock",l.id,$)},{default:w(()=>[e("div",He,[e("div",Ge,[l.image_url?(o(),a("img",{key:0,src:l.image_url,alt:l.name,class:"rounded",style:{width:"40px",height:"40px","object-fit":"contain"}},null,8,Ye)):(o(),a("i",Qe))]),e("div",et,[e("div",tt,[e("div",st,v(l.name),1),e("div",it,[t[19]||(t[19]=e("i",{class:"bi bi-tag me-1"},null,-1)),m(" "+v(l.category?.name||"Sans catégorie"),1)])]),e("span",nt,v(l.stock_quantity)+" "+v(l.unit),1)])])]),_:2},1032,["href","onClick"]),e("button",{onClick:O($=>d("low_stock",l.id),["stop"]),class:"btn btn-sm btn-link text-muted p-0 ms-2 flex-shrink-0",type:"button",title:"Marquer comme lu"},[...t[20]||(t[20]=[e("i",{class:"bi bi-check-circle"},null,-1)])],8,ot)])]))),128)),c.value.lowStockProducts.length>3?(o(),a("li",at,[h(s(y),{href:s(p)("products.index"),class:"dropdown-item text-center text-primary small fw-medium"},{default:w(()=>[t[21]||(t[21]=e("i",{class:"bi bi-arrow-right-circle me-1"},null,-1)),m(" Voir tous ("+v(c.value.lowStockProducts.length)+") ",1)]),_:1},8,["href"])])):u("",!0),t[22]||(t[22]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1))],64)):u("",!0),c.value.expiringProducts&&c.value.expiringProducts.length>0?(o(),a(N,{key:2},[e("li",lt,[e("div",rt,[e("div",dt,[e("div",ct,[e("h6",ut,[t[23]||(t[23]=e("i",{class:"bi bi-exclamation-triangle-fill me-2 text-danger"},null,-1)),t[24]||(t[24]=m(" Produits expirés ou proches de l'expiration ",-1)),e("span",mt,v(c.value.expiringProductsTotal||c.value.expiringProducts.length),1)]),e("p",pt,v(c.value.expiringProductsTotal||c.value.expiringProducts.length)+" produit(s) concerné(s) ",1)]),e("button",{onClick:t[2]||(t[2]=O(l=>i("expiring_product"),["stop"])),class:"btn btn-sm btn-link text-muted p-0 ms-2",type:"button",title:"Marquer toutes comme lues"},[...t[25]||(t[25]=[e("i",{class:"bi bi-check-all"},null,-1)])])])])]),(o(!0),a(N,null,W((c.value.expiringProducts||[]).slice(0,3),l=>(o(),a("li",{key:l.id,class:"notification-item"},[e("div",ft,[h(s(y),{href:s(p)("products.show",{id:l.id}),class:"flex-grow-1 text-decoration-none",onClick:$=>d("expiring_product",l.id,$)},{default:w(()=>[e("div",bt,[e("div",gt,[l.image_url?(o(),a("img",{key:0,src:l.image_url,alt:l.name,class:"rounded",style:{width:"40px",height:"40px","object-fit":"contain"}},null,8,vt)):(o(),a("i",ht))]),e("div",yt,[e("div",wt,[e("div",kt,v(l.name),1),e("div",_t,[l.days_until_expiration!==null?(o(),a("span",xt,[t[26]||(t[26]=e("i",{class:"bi bi-calendar3 me-1"},null,-1)),l.days_until_expiration<0?(o(),a("span",Tt," Expiré depuis "+v(Math.abs(l.days_until_expiration))+" jour(s) ",1)):l.days_until_expiration===0?(o(),a("span",Pt," Expire aujourd'hui ")):(o(),a("span",$t," Expire dans "+v(l.days_until_expiration)+" jour(s) ",1))])):u("",!0)])]),l.days_until_expiration!==null?(o(),a("span",{key:0,class:P(["badge ms-2 flex-shrink-0",l.days_until_expiration<0||l.days_until_expiration===0?"bg-danger":"bg-warning text-dark"])},v(s(pe)(l.expiration_date)),3)):u("",!0)])])]),_:2},1032,["href","onClick"]),e("button",{onClick:O($=>d("expiring_product",l.id),["stop"]),class:"btn btn-sm btn-link text-muted p-0 ms-2 flex-shrink-0",type:"button",title:"Marquer comme lu"},[...t[27]||(t[27]=[e("i",{class:"bi bi-check-circle"},null,-1)])],8,St)])]))),128)),(c.value.expiringProductsTotal||c.value.expiringProducts.length)>3?(o(),a("li",Ct,[h(s(y),{href:s(p)("products.index",{expiration_alert:!0}),class:"dropdown-item text-center text-primary small fw-medium"},{default:w(()=>[t[28]||(t[28]=e("i",{class:"bi bi-arrow-right-circle me-1"},null,-1)),m(" Voir tous ("+v(c.value.expiringProductsTotal||c.value.expiringProducts.length)+") ",1)]),_:1},8,["href"])])):u("",!0)],64)):u("",!0)],64)),x.value>0?(o(),a("li",Et,[e("div",Dt,[h(s(y),{href:s(p)("dashboard"),class:"btn btn-sm btn-primary w-100"},{default:w(()=>[...t[29]||(t[29]=[e("i",{class:"bi bi-speedometer2 me-1"},null,-1),m(" Voir le tableau de bord ",-1)])]),_:1},8,["href"])])])):u("",!0)],8,he)]))}}),At=H(Lt,[["__scopeId","data-v-0291dd8d"]]),jt=()=>{const r=z(),n=R(()=>r.props.auth?.user),_=R(()=>n.value?.role==="admin"),f=R(()=>n.value?.role==="vendeur"),b=R(()=>n.value?.permissions||[]),k=(i,j)=>{if(_.value)return!0;const V=`${i}.${j}`;return b.value.includes(V)};return{isAdmin:_,isVendeur:f,userPermissions:b,hasPermission:k,hasPermissionByName:i=>_.value?!0:b.value.includes(i),canCreate:i=>k(i,"create"),canView:i=>k(i,"view"),canEdit:i=>k(i,"edit"),canUpdate:i=>k(i,"update"),canDelete:i=>k(i,"delete"),canDownload:i=>k(i,"download"),canRestore:i=>k(i,"restore")}},Nt={class:"d-flex min-vh-100 bg-light"},Vt={class:"sidebar text-white sidebar-dark"},Ot={class:"sidebar-header p-3 border-bottom border-white border-opacity-25"},Rt={class:"sidebar-nav p-3"},qt={class:"nav nav-pills flex-column"},It={key:0,class:"nav-item mb-2"},Ft={key:1,class:"nav-divider my-2"},Bt={key:2,class:"nav-item mb-2"},Mt={key:3,class:"nav-item mb-2"},Wt={key:4,class:"nav-divider my-2"},zt={key:5,class:"nav-item mb-2"},Kt={key:6,class:"nav-item mb-2"},Ut={key:7,class:"nav-item mb-2"},Zt={key:8,class:"nav-item mb-2"},Jt={key:9,class:"nav-divider my-2"},Xt={key:10,class:"nav-item mb-2"},Ht={key:11,class:"nav-item mb-2"},Gt={key:12,class:"nav-item mb-2"},Yt={key:13,class:"nav-divider my-2"},Qt={key:14,class:"nav-item mb-2"},es={key:15,class:"nav-divider my-2"},ts={key:16,class:"nav-item mb-2"},ss={key:17,class:"nav-item mb-2"},is={class:"main-content flex-grow-1 d-flex flex-column"},ns={class:"bg-white shadow-sm border-bottom"},os={class:"container-fluid px-3 py-2 d-flex justify-content-between align-items-center"},as={key:0,"aria-label":"breadcrumb",class:"flex-grow-1"},ls={class:"breadcrumb mb-0"},rs={key:0,class:"breadcrumb-item"},ds={key:1},cs={class:"d-flex align-items-center gap-2 ms-auto"},us={class:"dropdown"},ms={class:"btn btn-sm btn-outline-primary d-flex align-items-center gap-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},ps={class:"d-none d-md-inline"},fs={class:"dropdown-menu dropdown-menu-end shadow"},bs={class:"px-3 py-2"},gs={class:"fw-medium"},vs={class:"flex-grow-1 container-fluid py-4"},hs=J({__name:"BootstrapLayout",props:{breadcrumbs:{default:()=>[]}},setup(r){const{canView:n,isAdmin:_}=jt(),f=z(),b=R(()=>_.value),k=L(!1);B(()=>{setTimeout(()=>{const d=f.props.auth?.user;d&&d.id&&!k.value&&(d.role===void 0||d.role===null)&&(k.value=!0,F.reload({only:["auth"]}))},100)});const g=R(()=>f.props.notifications||{salesDueToday:[],lowStockProducts:[],expiringProducts:[]}),S=L(!1),c=L(!1);B(()=>{S.value=document.documentElement.classList.contains("dark"),new MutationObserver(()=>{S.value=document.documentElement.classList.contains("dark")}).observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})});const x=()=>{const i=(document.documentElement.classList.contains("dark")?"dark":"light")==="dark"?"light":"dark";i==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("appearance",i),S.value=i==="dark"},E=()=>{const d=document.querySelector(".sidebar");d&&(d.classList.toggle("show"),c.value=d.classList.contains("show"))},A=d=>({admin:"Administrateur",vendeur:"Vendeur",gestionnaire:"Gestionnaire",user:"Utilisateur"})[d||"user"]||"Utilisateur",D=d=>({admin:"bg-danger",vendeur:"bg-primary",gestionnaire:"bg-info",user:"bg-secondary"})[d||"user"]||"bg-secondary";return(d,i)=>(o(),a("div",Nt,[e("div",Vt,[e("div",Ot,[h(s(y),{href:s(p)("dashboard"),class:"d-flex align-items-center text-white text-decoration-none"},{default:w(()=>[...i[0]||(i[0]=[e("div",{class:"me-2"},[e("img",{src:"/logo.png",alt:"Logo",class:"logo-img",style:{width:"120px",height:"120px","object-fit":"contain"}})],-1),e("span",{class:"fw-bold"},"Gestion",-1)])]),_:1},8,["href"])]),e("nav",Rt,[e("ul",qt,[s(n)("dashboard")?(o(),a("li",It,[h(s(y),{href:s(p)("dashboard"),class:P(["nav-link",{active:d.$page.url==="/"}])},{default:w(()=>[...i[1]||(i[1]=[e("i",{class:"bi bi-house-door me-2"},null,-1),m(" Dashboard ",-1)])]),_:1},8,["href","class"])])):u("",!0),s(n)("products")||s(n)("categories")?(o(),a("li",Ft)):u("",!0),s(n)("products")?(o(),a("li",Bt,[h(s(y),{href:s(p)("products.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/products")}])},{default:w(()=>[...i[2]||(i[2]=[e("i",{class:"bi bi-box me-2"},null,-1),m(" Produits ",-1)])]),_:1},8,["href","class"])])):u("",!0),s(n)("categories")?(o(),a("li",Mt,[h(s(y),{href:s(p)("categories.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/categories")}])},{default:w(()=>[...i[3]||(i[3]=[e("i",{class:"bi bi-tags me-2"},null,-1),m(" Catégories ",-1)])]),_:1},8,["href","class"])])):u("",!0),s(n)("customers")||s(n)("sales")||s(n)("quotes")||s(n)("expenses")?(o(),a("li",Wt)):u("",!0),s(n)("customers")?(o(),a("li",zt,[h(s(y),{href:s(p)("customers.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/customers")}])},{default:w(()=>[...i[4]||(i[4]=[e("i",{class:"bi bi-people me-2"},null,-1),m(" Clients ",-1)])]),_:1},8,["href","class"])])):u("",!0),s(n)("sales")?(o(),a("li",Kt,[h(s(y),{href:s(p)("sales.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/sales")}])},{default:w(()=>[...i[5]||(i[5]=[e("i",{class:"bi bi-cart me-2"},null,-1),m(" Ventes ",-1)])]),_:1},8,["href","class"])])):u("",!0),s(n)("quotes")?(o(),a("li",Ut,[h(s(y),{href:s(p)("quotes.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/quotes")}])},{default:w(()=>[...i[6]||(i[6]=[e("i",{class:"bi bi-file-earmark-check me-2"},null,-1),m(" Devis ",-1)])]),_:1},8,["href","class"])])):u("",!0),s(n)("expenses")?(o(),a("li",Zt,[h(s(y),{href:s(p)("expenses.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/expenses")}])},{default:w(()=>[...i[7]||(i[7]=[e("i",{class:"bi bi-receipt me-2"},null,-1),m(" Dépenses ",-1)])]),_:1},8,["href","class"])])):u("",!0),s(n)("suppliers")||s(n)("purchase-orders")||s(n)("delivery-notes")?(o(),a("li",Jt)):u("",!0),s(n)("suppliers")?(o(),a("li",Xt,[h(s(y),{href:s(p)("suppliers.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/suppliers")}])},{default:w(()=>[...i[8]||(i[8]=[e("i",{class:"bi bi-truck me-2"},null,-1),m(" Fournisseurs ",-1)])]),_:1},8,["href","class"])])):u("",!0),s(n)("purchase-orders")?(o(),a("li",Ht,[h(s(y),{href:s(p)("purchase-orders.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/purchase-orders")}])},{default:w(()=>[...i[9]||(i[9]=[e("i",{class:"bi bi-file-earmark-text me-2"},null,-1),m(" Bons de commande ",-1)])]),_:1},8,["href","class"])])):u("",!0),s(n)("delivery-notes")?(o(),a("li",Gt,[h(s(y),{href:s(p)("delivery-notes.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/delivery-notes")}])},{default:w(()=>[...i[10]||(i[10]=[e("i",{class:"bi bi-clipboard-check me-2"},null,-1),m(" Bons de livraison ",-1)])]),_:1},8,["href","class"])])):u("",!0),s(n)("company")?(o(),a("li",Yt)):u("",!0),s(n)("company")?(o(),a("li",Qt,[h(s(y),{href:s(p)("company.edit"),class:P(["nav-link",{active:d.$page.url.startsWith("/company")}])},{default:w(()=>[...i[11]||(i[11]=[e("i",{class:"bi bi-building me-2"},null,-1),m(" Entreprise ",-1)])]),_:1},8,["href","class"])])):u("",!0),b.value?(o(),a("li",es)):u("",!0),b.value?(o(),a("li",ts,[h(s(y),{href:s(p)("admin.users.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/admin/users")}])},{default:w(()=>[...i[12]||(i[12]=[e("i",{class:"bi bi-shield-lock me-2"},null,-1),m(" Utilisateurs ",-1)])]),_:1},8,["href","class"])])):u("",!0),b.value&&s(n)("backups")?(o(),a("li",ss,[h(s(y),{href:s(p)("admin.backups.index"),class:P(["nav-link",{active:d.$page.url.startsWith("/admin/backups")}])},{default:w(()=>[...i[13]||(i[13]=[e("i",{class:"bi bi-database me-2"},null,-1),m(" Sauvegardes ",-1)])]),_:1},8,["href","class"])])):u("",!0)])])]),e("div",is,[e("header",ns,[e("div",os,[e("button",{class:"btn btn-sm btn-outline-primary d-md-none me-2",onClick:E,type:"button"},[...i[14]||(i[14]=[e("i",{class:"bi bi-list"},null,-1)])]),r.breadcrumbs&&r.breadcrumbs.length>0?(o(),a("nav",as,[e("ol",ls,[s(f).url.includes("/settings")?u("",!0):(o(),a("li",rs,[h(s(y),{href:s(p)("dashboard")},{default:w(()=>[...i[15]||(i[15]=[e("i",{class:"bi bi-house-door me-1"},null,-1),m(" Accueil ",-1)])]),_:1},8,["href"])])),(o(!0),a(N,null,W(r.breadcrumbs,(j,V)=>(o(),a("li",{key:V,class:P(["breadcrumb-item",{active:V===r.breadcrumbs.length-1}])},[j.href&&V<r.breadcrumbs.length-1?(o(),le(s(y),{key:0,href:j.href},{default:w(()=>[m(v(j.title),1)]),_:2},1032,["href"])):(o(),a("span",ds,v(j.title),1))],2))),128))])])):u("",!0),e("div",cs,[h(At,{notifications:g.value},null,8,["notifications"]),e("button",{onClick:x,class:"btn btn-sm btn-outline-primary",type:"button"},[e("i",{class:P(S.value?"bi bi-sun":"bi bi-moon")},null,2)]),e("div",us,[e("button",ms,[i[16]||(i[16]=e("i",{class:"bi bi-person-circle"},null,-1)),e("span",ps,[m(v(d.$page.props.auth.user?.name||"Utilisateur")+" ",1),e("span",{class:P(["badge ms-2",D(d.$page.props.auth.user?.role)])},v(A(d.$page.props.auth.user?.role)),3)])]),e("ul",fs,[e("li",bs,[i[17]||(i[17]=e("div",{class:"small text-muted"},"Rôle",-1)),e("div",gs,v(A(d.$page.props.auth.user?.role)),1)]),i[20]||(i[20]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[h(s(y),{href:s(p)("profile.edit"),class:"dropdown-item"},{default:w(()=>[...i[18]||(i[18]=[e("i",{class:"bi bi-person me-2"},null,-1),m(" Profil ",-1)])]),_:1},8,["href"])]),i[21]||(i[21]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[h(s(y),{href:s(p)("logout"),method:"post",class:"dropdown-item text-danger"},{default:w(()=>[...i[19]||(i[19]=[e("i",{class:"bi bi-box-arrow-right me-2"},null,-1),m(" Déconnexion ",-1)])]),_:1},8,["href"])])])])])])]),c.value?(o(),a("div",{key:0,class:"sidebar-overlay d-md-none",onClick:E})):u("",!0),e("main",vs,[ae(d.$slots,"default",{},void 0,!0)])]),h(ce)]))}}),$s=H(hs,[["__scopeId","data-v-134625a8"]]);export{$s as B,Ts as a,xs as b,_s as c,pe as f,Ps as g,jt as u};
