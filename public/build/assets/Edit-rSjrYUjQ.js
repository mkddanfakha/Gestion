import{d as S,r as O,i as F,c as T,w as k,a as e,j as x,u as t,l as q,f as b,k as z,b as l,e as c,m as v,n as _,v as w,o as a,t as u,p as D,q as V,F as j,g as B}from"./app-BrkohfQq.js";import{B as $}from"./BootstrapLayout-DdWhaGDh.js";import{r as g}from"./routes-C8N3XD_S.js";import{u as G}from"./useSweetAlert-CjcY7Pj8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const H={class:"d-flex justify-content-between align-items-center mb-4"},J={class:"row justify-content-center"},K={class:"col-lg-8"},Q={class:"card mb-4"},W={class:"card-body"},X={class:"row g-3"},Y={class:"col-md-6"},Z={key:0,class:"invalid-feedback"},ee={key:1,class:"invalid-feedback"},se={class:"col-md-6"},te={key:0,class:"invalid-feedback"},ie={key:1,class:"invalid-feedback"},oe={class:"col-md-6"},ae={key:0,class:"invalid-feedback"},re={key:1,class:"invalid-feedback"},le={class:"col-md-6"},ne={key:0,class:"invalid-feedback"},de={key:1,class:"invalid-feedback"},ue={class:"col-md-6"},ce={key:0,class:"invalid-feedback"},me={key:1,class:"invalid-feedback"},pe={class:"col-md-6"},ve={class:"form-check form-switch"},fe={class:"form-check-label",for:"is_active"},be={key:0,class:"invalid-feedback"},_e={key:1,class:"invalid-feedback"},ye={key:0,class:"card mb-4"},we={class:"card-body"},he={class:"mb-3 text-capitalize"},ke={class:"row g-2"},ge={class:"form-check"},xe=["id","onUpdate:modelValue","value"],qe=["for"],Ve={class:"text-muted"},je={key:0,class:"my-3"},Be={class:"d-flex justify-content-end gap-2"},Ee=["disabled"],Ce={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Re={key:1,class:"bi bi-check-circle me-1"},Ne=S({__name:"Edit",props:{user:{},permissionsByResource:{},userPermissionIds:{}},setup(y){const{success:E,error:C}=G(),m=y,r=O({}),R=()=>{const o={};return(!i.name||i.name.trim().length<2)&&(o.name="Le nom est requis (minimum 2 caractères)"),(!i.email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.email))&&(o.email="Adresse email invalide"),i.password&&i.password.length<8&&(o.password="Le mot de passe doit contenir au moins 8 caractères"),i.password&&i.password!==i.password_confirmation&&(o.password_confirmation="Les mots de passe ne correspondent pas"),(!i.role||!["admin","user","vendeur","gestionnaire"].includes(i.role))&&(o.role="Rôle invalide"),Object.keys(o).length===0?null:o},i=F({name:m.user.name,email:m.user.email,password:"",password_confirmation:"",role:m.user.role,is_active:m.user.is_active??!0,permissions:[...m.userPermissionIds]}),M=o=>({products:"Produits",categories:"Catégories",customers:"Clients",sales:"Ventes",quotes:"Devis",expenses:"Dépenses",suppliers:"Fournisseurs","purchase-orders":"Bons de commande","delivery-notes":"Bons de livraison",company:"Entreprise",dashboard:"Tableau de bord"})[o]||o,U=o=>({view:"Voir",create:"Créer",edit:"Modifier",update:"Mettre à jour",delete:"Supprimer",export:"Exporter",invoice:"Factures",download:"Télécharger",print:"Imprimer",validate:"Valider"})[o]||o,L=()=>{if(i.role==="admin")i.permissions=[];else if(i.role==="vendeur"){const o=["sales.create","sales.edit","sales.update","sales.delete","sales.view","sales.invoice","quotes.create","quotes.edit","quotes.update","quotes.delete","quotes.view","quotes.download","quotes.print","products.view","customers.view","customers.create","customers.edit","customers.update"],s=[];Object.values(m.permissionsByResource).forEach(n=>{n.forEach(p=>{o.includes(p.name)&&s.push(p.id)})}),i.permissions=s}else if(i.role==="gestionnaire"){const o=["dashboard.view","products.view","products.create","products.edit","products.update","products.delete","categories.view","categories.create","categories.edit","categories.update","categories.delete","quotes.view","quotes.create","quotes.edit","quotes.update","quotes.delete","quotes.download","quotes.print","expenses.view","expenses.create","expenses.edit","expenses.update","expenses.delete","suppliers.view","suppliers.create","suppliers.edit","suppliers.update","suppliers.delete","suppliers.export","purchase-orders.view","purchase-orders.create","purchase-orders.edit","purchase-orders.update","purchase-orders.delete","purchase-orders.download","purchase-orders.print","delivery-notes.view","delivery-notes.create","delivery-notes.edit","delivery-notes.update","delivery-notes.delete","delivery-notes.validate","delivery-notes.download","delivery-notes.print","delivery-notes.invoice"],s=[];Object.values(m.permissionsByResource).forEach(n=>{n.forEach(p=>{o.includes(p.name)&&s.push(p.id)})}),i.permissions=s}},P=()=>{const o=[];Object.values(m.permissionsByResource).forEach(s=>{s.forEach(n=>{o.push(n.id)})}),i.permissions=o},A=()=>{i.permissions=[]},I=()=>{r.value={};const o=R();if(o){r.value=o;return}i.put(g("admin.users.update",m.user.id),{onSuccess:()=>{E("Utilisateur mis à jour avec succès !")},onError:()=>{C("Erreur lors de la mise à jour de l'utilisateur.")}})},{errors:d,processing:h}=i;return(o,s)=>(a(),T($,null,{default:k(()=>[e("div",H,[s[7]||(s[7]=e("div",null,[e("h1",{class:"h2 mb-1"},"Modifier l'utilisateur"),e("p",{class:"text-muted mb-0"},"Modifiez les informations de l'utilisateur")],-1)),x(t(q),{href:t(g)("admin.users.index"),class:"btn btn-outline-secondary"},{default:k(()=>[...s[6]||(s[6]=[e("i",{class:"bi bi-arrow-left me-1"},null,-1),b(" Retour à la liste ",-1)])]),_:1},8,["href"])]),e("form",{onSubmit:z(I,["prevent"])},[e("div",J,[e("div",K,[e("div",Q,[s[17]||(s[17]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Informations de l'utilisateur")],-1)),e("div",W,[e("div",X,[e("div",Y,[s[8]||(s[8]=e("label",{class:"form-label"},[b(" Nom complet "),e("span",{class:"text-danger"},"*")],-1)),v(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>t(i).name=n),type:"text",required:"",class:_(["form-control",{"is-invalid":t(d).name||r.value.name}])},null,2),[[w,t(i).name]]),t(d).name?(a(),l("div",Z,u(t(d).name),1)):c("",!0),r.value.name?(a(),l("div",ee,u(r.value.name),1)):c("",!0)]),e("div",se,[s[9]||(s[9]=e("label",{class:"form-label"},[b(" Email "),e("span",{class:"text-danger"},"*")],-1)),v(e("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>t(i).email=n),type:"email",required:"",class:_(["form-control",{"is-invalid":t(d).email||r.value.email}])},null,2),[[w,t(i).email]]),t(d).email?(a(),l("div",te,u(t(d).email),1)):c("",!0),r.value.email?(a(),l("div",ie,u(r.value.email),1)):c("",!0)]),e("div",oe,[s[10]||(s[10]=e("label",{class:"form-label"}," Nouveau mot de passe (laisser vide pour ne pas changer) ",-1)),v(e("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>t(i).password=n),type:"password",class:_(["form-control",{"is-invalid":t(d).password||r.value.password}])},null,2),[[w,t(i).password]]),t(d).password?(a(),l("div",ae,u(t(d).password),1)):c("",!0),r.value.password?(a(),l("div",re,u(r.value.password),1)):c("",!0)]),e("div",le,[s[11]||(s[11]=e("label",{class:"form-label"}," Confirmer le nouveau mot de passe ",-1)),v(e("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>t(i).password_confirmation=n),type:"password",class:_(["form-control",{"is-invalid":t(d).password_confirmation||r.value.password_confirmation}])},null,2),[[w,t(i).password_confirmation]]),t(d).password_confirmation?(a(),l("div",ne,u(t(d).password_confirmation),1)):c("",!0),r.value.password_confirmation?(a(),l("div",de,u(r.value.password_confirmation),1)):c("",!0)]),e("div",ue,[s[13]||(s[13]=e("label",{class:"form-label"},[b(" Rôle "),e("span",{class:"text-danger"},"*")],-1)),v(e("select",{"onUpdate:modelValue":s[4]||(s[4]=n=>t(i).role=n),required:"",class:_(["form-select",{"is-invalid":t(d).role||r.value.role}]),onChange:L},[...s[12]||(s[12]=[e("option",{value:"user"},"Utilisateur",-1),e("option",{value:"vendeur"},"Vendeur",-1),e("option",{value:"gestionnaire"},"Gestionnaire",-1),e("option",{value:"admin"},"Administrateur",-1)])],34),[[D,t(i).role]]),t(d).role?(a(),l("div",ce,u(t(d).role),1)):c("",!0),r.value.role?(a(),l("div",me,u(r.value.role),1)):c("",!0),s[14]||(s[14]=e("small",{class:"form-text text-muted"}," Les administrateurs ont automatiquement toutes les permissions. ",-1))]),e("div",pe,[s[15]||(s[15]=e("label",{class:"form-label"},"Statut",-1)),e("div",ve,[v(e("input",{"onUpdate:modelValue":s[5]||(s[5]=n=>t(i).is_active=n),class:_(["form-check-input",{"is-invalid":t(d).is_active||r.value.is_active}]),type:"checkbox",id:"is_active"},null,2),[[V,t(i).is_active]]),e("label",fe,u(t(i).is_active?"Actif":"Inactif"),1)]),t(d).is_active?(a(),l("div",be,u(t(d).is_active),1)):c("",!0),r.value.is_active?(a(),l("div",_e,u(r.value.is_active),1)):c("",!0),s[16]||(s[16]=e("small",{class:"form-text text-muted"}," Les utilisateurs inactifs ne peuvent pas se connecter. ",-1))])])])]),t(i).role!=="admin"?(a(),l("div",ye,[s[19]||(s[19]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Permissions"),e("small",{class:"text-muted"},"Sélectionnez les permissions pour cet utilisateur")],-1)),e("div",we,[(a(!0),l(j,null,B(y.permissionsByResource,(n,p)=>(a(),l("div",{key:p,class:"mb-4"},[e("h6",he,u(M(p)),1),e("div",ke,[(a(!0),l(j,null,B(n,f=>(a(),l("div",{key:f.id,class:"col-md-6 col-lg-4"},[e("div",ge,[v(e("input",{id:`permission-${f.id}`,"onUpdate:modelValue":N=>t(i).permissions=N,type:"checkbox",value:f.id,class:"form-check-input"},null,8,xe),[[V,t(i).permissions]]),e("label",{for:`permission-${f.id}`,class:"form-check-label"},[e("strong",null,u(U(f.action)),1),s[18]||(s[18]=e("br",null,null,-1)),e("small",Ve,u(f.description),1)],8,qe)])]))),128))]),Object.keys(y.permissionsByResource).indexOf(p)<Object.keys(y.permissionsByResource).length-1?(a(),l("hr",je)):c("",!0)]))),128)),e("div",{class:"mt-3"},[e("button",{type:"button",class:"btn btn-sm btn-outline-primary me-2",onClick:P}," Tout sélectionner "),e("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:A}," Tout désélectionner ")])])])):c("",!0),e("div",Be,[x(t(q),{href:t(g)("admin.users.index"),class:"btn btn-outline-secondary"},{default:k(()=>[...s[20]||(s[20]=[b(" Annuler ",-1)])]),_:1},8,["href"]),e("button",{type:"submit",class:"btn btn-primary",disabled:t(h)},[t(h)?(a(),l("span",Ce)):(a(),l("i",Re)),b(" "+u(t(h)?"Mise à jour...":"Mettre à jour"),1)],8,Ee)])])])],32)]),_:1}))}});export{Ne as default};
