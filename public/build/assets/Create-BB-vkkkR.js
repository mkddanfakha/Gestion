import{d as R,r as h,i as G,B as T,c as K,w as S,a as t,j as C,u as s,l as A,f as g,m as p,b as r,e as u,n as v,v as f,o as n,t as d,F as P,g as O,p as x}from"./app-Ctez1HXG.js";import{_ as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-DkXoEYZQ.js";import{r as q}from"./routes-C8N3XD_S.js";import{u as J}from"./useSweetAlert-CjcY7Pj8.js";import{F as W}from"./FilePondImageUpload-nTrXaWBu.js";import"./BootstrapLayout-ri-ER_V1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const X={class:"d-flex justify-content-between align-items-center mb-4"},H={class:"row"},Q={class:"col-lg-8"},Y={class:"card mb-4"},ee={class:"card-body"},te={class:"row g-3"},se={class:"col-md-6"},ie={key:0,class:"invalid-feedback"},oe={key:1,class:"invalid-feedback"},ae={class:"col-md-6"},le=["value"],ne={key:0,class:"invalid-feedback"},re={key:1,class:"invalid-feedback"},de={class:"mt-3"},ce={key:0,class:"invalid-feedback"},ue={class:"card mb-4"},me={class:"card-body"},pe={class:"row g-3"},ve={class:"col-md-6"},fe={class:"input-group"},_e=["disabled"],be={key:0,class:"spinner-border spinner-border-sm me-1"},ge={key:0,class:"text-danger small"},ke={class:"col-md-6"},ye={key:0,class:"invalid-feedback"},he={class:"card mb-4"},xe={class:"card-body"},qe={class:"row g-3"},Fe={class:"col-md-4"},we={class:"input-group"},Le={key:0,class:"invalid-feedback"},Ue={key:1,class:"invalid-feedback"},Se={class:"col-md-4"},Ce={class:"input-group"},Ae={key:0,class:"invalid-feedback"},Pe={key:1,class:"invalid-feedback"},Ve={class:"col-md-4"},je={key:0,class:"invalid-feedback"},Ee={key:1,class:"invalid-feedback"},Ne={class:"col-md-4"},Be={key:0,class:"invalid-feedback"},$e={key:1,class:"invalid-feedback"},De={class:"row g-3 mt-2"},ze={class:"col-md-6"},Ie={key:0,class:"invalid-feedback"},Me={class:"row g-3 mt-2"},Re={class:"col-md-6"},Ge={key:0,class:"invalid-feedback"},Te={class:"col-md-6"},Ke={key:0,class:"invalid-feedback"},Oe={class:"card mb-4"},Ze={class:"card-body"},Je={class:"row g-3"},We={class:"col-md-6"},Xe={key:0,class:"invalid-feedback"},He={key:0,class:"col-md-6"},Qe={class:"row g-2"},Ye={class:"col-6"},et={key:0,class:"invalid-feedback"},tt={class:"col-6"},st={key:0,class:"invalid-feedback"},it={class:"col-lg-4"},ot={class:"card mb-4"},at={class:"card-body"},lt={class:"card"},nt={class:"card-body"},rt={class:"d-grid gap-2"},dt=["disabled"],ct={key:0,class:"spinner-border spinner-border-sm me-2"},ut={key:1,class:"bi bi-check-circle me-1"},mt={class:"card mt-3"},pt={class:"card-body"},vt={class:"text-center"},ft={class:"mb-3",style:{"min-height":"200px",display:"flex","align-items":"center","justify-content":"center","background-color":"#f8f9fa","border-radius":"0.375rem",padding:"1rem"}},_t=["src","alt"],bt={key:1,class:"w-100 d-flex align-items-center justify-content-center",style:{"min-height":"200px"}},gt={class:"fw-medium"},kt={class:"text-muted small mb-2"},yt={class:"d-flex justify-content-between align-items-center"},ht={class:"fw-medium text-success"},xt={class:"badge bg-light text-dark"},qt={key:1,class:"small text-muted"},Vt=R({__name:"Create",props:{categories:{}},setup(V){const{success:j,error:E}=J(),c=h({}),N=()=>{const a={};return(!i.name||i.name.trim().length<2)&&(a.name="Le nom du produit est requis (minimum 2 caractères)"),i.name&&i.name.length>255&&(a.name="Le nom ne peut pas dépasser 255 caractères"),i.sku&&i.sku.length>6&&(a.sku="Le SKU ne peut pas dépasser 6 caractères"),i.sku&&!/^[A-Z]{2}[0-9]{4}$/.test(i.sku)&&(a.sku="Le SKU doit être au format CCNNNN (2 lettres majuscules + 4 chiffres)"),i.barcode&&i.barcode.length>255&&(a.barcode="Le code-barres ne peut pas dépasser 255 caractères"),i.barcode&&!/^[a-zA-Z0-9]+$/.test(i.barcode)&&(a.barcode="Le code-barres ne peut contenir que des caractères alphanumériques"),(!i.price||i.price<0)&&(a.price="Le prix est requis et doit être positif"),i.cost_price&&i.cost_price<0&&(a.cost_price="Le prix de revient ne peut pas être négatif"),(!i.stock_quantity||i.stock_quantity<0)&&(a.stock_quantity="La quantité en stock est requise et doit être positive"),(!i.min_stock_level||i.min_stock_level<0)&&(a.min_stock_level="Le niveau de stock minimum est requis et doit être positif"),(!i.unit||i.unit.length>50)&&(a.unit="L'unité est requise et ne peut pas dépasser 50 caractères"),i.category_id||(a.category_id="La catégorie est requise"),Object.keys(a).length===0?null:a},_=(a,e)=>{c.value[a]&&delete c.value[a];let o="";switch(a){case"name":!e||e.trim().length<2?o="Le nom du produit est requis (minimum 2 caractères)":e.length>255&&(o="Le nom ne peut pas dépasser 255 caractères");break;case"sku":e&&e.length>6?o="Le SKU ne peut pas dépasser 6 caractères":e&&!/^[A-Z]{2}[0-9]{4}$/.test(e)&&(o="Le SKU doit être au format CCNNNN (2 lettres majuscules + 4 chiffres)");break;case"barcode":e&&e.length>255?o="Le code-barres ne peut pas dépasser 255 caractères":e&&!/^[a-zA-Z0-9]+$/.test(e)&&(o="Le code-barres ne peut contenir que des caractères alphanumériques");break;case"price":(!e||e<0)&&(o="Le prix est requis et doit être positif");break;case"cost_price":e&&e<0&&(o="Le prix de revient ne peut pas être négatif");break;case"stock_quantity":(!e||e<0)&&(o="La quantité en stock est requise et doit être positive");break;case"min_stock_level":(!e||e<0)&&(o="Le niveau de stock minimum est requis et doit être positif");break;case"unit":(!e||e.length>50)&&(o="L'unité est requise et ne peut pas dépasser 50 caractères");break;case"category_id":e||(o="La catégorie est requise");break}o&&(c.value[a]=o)},B=a=>new Intl.NumberFormat("fr-FR").format(a)+" Fcfa",i=G({name:"",description:"",sku:"",barcode:"",price:0,cost_price:null,stock_quantity:0,min_stock_level:0,unit:"pièce",location:"",category_id:"",is_active:!0,expiration_date:"",alert_threshold_value:null,alert_threshold_unit:""}),F=h(null),w=h([]),m=h(null),$=a=>{setTimeout(()=>{L(a)},200)},D=a=>{L(a)},L=a=>{if(!a){m.value=null;return}let e=null;if(a.file instanceof File)e=a.file;else if(a.getFile&&typeof a.getFile=="function")try{e=a.getFile()}catch{}else if(a.source&&(a.source.startsWith("http")||a.source.startsWith("/"))){m.value=a.source;return}if(e instanceof File){const o=new FileReader;o.onload=b=>{m.value=b.target?.result},o.onerror=()=>{m.value=null},o.readAsDataURL(e)}else a.getFileEncode&&typeof a.getFileEncode=="function"?a.getFileEncode().then(o=>{m.value=o}).catch(()=>{a.source?m.value=a.source:m.value=null}):m.value=null},z=a=>{w.value=a.map(e=>e.file||(e.getFile?e.getFile():null)).filter(Boolean),a.length>0?setTimeout(()=>{L(a[0])},100):m.value=null};T(w,a=>{if(a.length>0&&a[0]instanceof File){const e=new FileReader;e.onload=o=>{m.value=o.target?.result},e.onerror=()=>{m.value=null},e.readAsDataURL(a[0])}else a.length===0&&(m.value=null)},{deep:!0});const k=h(!1),I=async()=>{if(!(!i.name||!i.category_id)){k.value=!0;try{const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),e=await fetch(q("products.generate-sku"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a||"",Accept:"application/json"},body:JSON.stringify({name:i.name,category_id:i.category_id})});if(e.ok){const o=await e.json();i.sku=o.sku}}catch(a){console.error("Erreur lors de la génération du SKU:",a)}finally{k.value=!1}}},M=()=>{c.value={};const a=N();if(a){c.value=a;return}const e=new FormData,o=i.data();Object.keys(o).forEach(b=>{const y=o[b];y!=null&&y!==""&&(b==="is_active"?e.append(b,y?"1":"0"):e.append(b,String(y)))}),w.value.forEach(b=>{e.append("images[]",b)}),i.transform(()=>e).post(q("products.store"),{forceFormData:!0,onSuccess:()=>{j("Produit créé avec succès !"),i.reset(),c.value={},m.value=null,F.value&&F.value.removeFiles()},onError:()=>{E("Erreur lors de la création du produit.")}})},{errors:l,processing:U}=i;return(a,e)=>(n(),K(Z,null,{default:S(()=>[t("div",X,[e[24]||(e[24]=t("div",null,[t("h1",{class:"h2 mb-1"},"Nouveau produit"),t("p",{class:"text-muted mb-0"},"Ajoutez un nouveau produit à votre inventaire")],-1)),C(s(A),{href:s(q)("products.index"),class:"btn btn-outline-secondary"},{default:S(()=>[...e[23]||(e[23]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),g(" Retour à la liste ",-1)])]),_:1},8,["href"])]),t("form",null,[t("div",H,[t("div",Q,[t("div",Y,[e[29]||(e[29]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Informations générales")],-1)),t("div",ee,[t("div",te,[t("div",se,[e[25]||(e[25]=t("label",{class:"form-label"},[g(" Nom du produit "),t("span",{class:"text-danger"},"*")],-1)),p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s(i).name=o),type:"text",required:"",class:v(["form-control",{"is-invalid":s(l).name||c.value.name}]),onBlur:e[1]||(e[1]=o=>_("name",s(i).name)),onInput:e[2]||(e[2]=o=>_("name",s(i).name))},null,34),[[f,s(i).name]]),s(l).name?(n(),r("div",ie,d(s(l).name),1)):u("",!0),c.value.name?(n(),r("div",oe,d(c.value.name),1)):u("",!0)]),t("div",ae,[e[27]||(e[27]=t("label",{class:"form-label"},[g(" Catégorie "),t("span",{class:"text-danger"},"*")],-1)),p(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>s(i).category_id=o),required:"",class:v(["form-select",{"is-invalid":s(l).category_id||c.value.category_id}]),onBlur:e[4]||(e[4]=o=>_("category_id",s(i).category_id)),onChange:e[5]||(e[5]=o=>_("category_id",s(i).category_id))},[e[26]||(e[26]=t("option",{value:""},"Sélectionner une catégorie",-1)),(n(!0),r(P,null,O(V.categories,o=>(n(),r("option",{key:o.id,value:o.id},d(o.name),9,le))),128))],34),[[x,s(i).category_id]]),s(l).category_id?(n(),r("div",ne,d(s(l).category_id),1)):u("",!0),c.value.category_id?(n(),r("div",re,d(c.value.category_id),1)):u("",!0)])]),t("div",de,[e[28]||(e[28]=t("label",{class:"form-label"},"Description",-1)),p(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=o=>s(i).description=o),rows:"3",class:v(["form-control",{"is-invalid":s(l).description}])},null,2),[[f,s(i).description]]),s(l).description?(n(),r("div",ce,d(s(l).description),1)):u("",!0)])])]),t("div",ue,[e[32]||(e[32]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Codes et identification")],-1)),t("div",me,[t("div",pe,[t("div",ve,[e[30]||(e[30]=t("label",{class:"form-label"},"SKU (Code produit)",-1)),t("div",fe,[p(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>s(i).sku=o),type:"text",placeholder:"Généré automatiquement",class:v(["form-control",{"is-invalid":s(l).sku}])},null,2),[[f,s(i).sku]]),t("button",{type:"button",onClick:I,disabled:!s(i).name||!s(i).category_id||k.value,class:"btn btn-outline-primary"},[k.value?(n(),r("span",be)):u("",!0),g(" "+d(k.value?"Génération...":"Générer"),1)],8,_e)]),s(l).sku?(n(),r("div",ge,d(s(l).sku),1)):u("",!0)]),t("div",ke,[e[31]||(e[31]=t("label",{class:"form-label"},"Code-barres",-1)),p(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>s(i).barcode=o),type:"text",class:v(["form-control",{"is-invalid":s(l).barcode}])},null,2),[[f,s(i).barcode]]),s(l).barcode?(n(),r("div",ye,d(s(l).barcode),1)):u("",!0)])])])]),t("div",he,[e[45]||(e[45]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Prix et stock")],-1)),t("div",xe,[t("div",qe,[t("div",Fe,[e[34]||(e[34]=t("label",{class:"form-label"},[g(" Prix de vente "),t("span",{class:"text-danger"},"*")],-1)),t("div",we,[e[33]||(e[33]=t("span",{class:"input-group-text"},"Fcfa",-1)),p(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>s(i).price=o),type:"number",step:"0.01",min:"0",required:"",class:v(["form-control",{"is-invalid":s(l).price||c.value.price}]),onBlur:e[10]||(e[10]=o=>_("price",s(i).price)),onInput:e[11]||(e[11]=o=>_("price",s(i).price))},null,34),[[f,s(i).price]])]),s(l).price?(n(),r("div",Le,d(s(l).price),1)):u("",!0),c.value.price?(n(),r("div",Ue,d(c.value.price),1)):u("",!0)]),t("div",Se,[e[36]||(e[36]=t("label",{class:"form-label"},"Prix de revient",-1)),t("div",Ce,[e[35]||(e[35]=t("span",{class:"input-group-text"},"Fcfa",-1)),p(t("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>s(i).cost_price=o),type:"number",step:"0.01",min:"0",class:v(["form-control",{"is-invalid":s(l).cost_price||c.value.cost_price}]),onBlur:e[13]||(e[13]=o=>_("cost_price",s(i).cost_price)),onInput:e[14]||(e[14]=o=>_("cost_price",s(i).cost_price))},null,34),[[f,s(i).cost_price]])]),s(l).cost_price?(n(),r("div",Ae,d(s(l).cost_price),1)):u("",!0),c.value.cost_price?(n(),r("div",Pe,d(c.value.cost_price),1)):u("",!0)]),t("div",Ve,[e[37]||(e[37]=t("label",{class:"form-label"},[g(" Stock initial "),t("span",{class:"text-danger"},"*")],-1)),p(t("input",{"onUpdate:modelValue":e[15]||(e[15]=o=>s(i).stock_quantity=o),type:"number",min:"0",required:"",class:v(["form-control",{"is-invalid":s(l).stock_quantity||c.value.stock_quantity}])},null,2),[[f,s(i).stock_quantity]]),s(l).stock_quantity?(n(),r("div",je,d(s(l).stock_quantity),1)):u("",!0),c.value.stock_quantity?(n(),r("div",Ee,d(c.value.stock_quantity),1)):u("",!0)]),t("div",Ne,[e[39]||(e[39]=t("label",{class:"form-label"},"Unité",-1)),p(t("select",{"onUpdate:modelValue":e[16]||(e[16]=o=>s(i).unit=o),class:v(["form-select",{"is-invalid":s(l).unit||c.value.unit}])},[...e[38]||(e[38]=[t("option",{value:"pièce"},"Pièce",-1),t("option",{value:"kg"},"Kilogramme",-1),t("option",{value:"g"},"Gramme",-1),t("option",{value:"L"},"Litre",-1),t("option",{value:"mL"},"Millilitre",-1),t("option",{value:"m"},"Mètre",-1),t("option",{value:"cm"},"Centimètre",-1),t("option",{value:"m²"},"Mètre carré",-1),t("option",{value:"m³"},"Mètre cube",-1),t("option",{value:"paquet"},"Paquet",-1),t("option",{value:"boîte"},"Boîte",-1),t("option",{value:"carton"},"Carton",-1)])],2),[[x,s(i).unit]]),s(l).unit?(n(),r("div",Be,d(s(l).unit),1)):u("",!0),c.value.unit?(n(),r("div",$e,d(c.value.unit),1)):u("",!0)])]),t("div",De,[t("div",ze,[e[40]||(e[40]=t("label",{class:"form-label"},"Emplacement (optionnel)",-1)),p(t("input",{"onUpdate:modelValue":e[17]||(e[17]=o=>s(i).location=o),type:"text",class:v(["form-control",{"is-invalid":s(l).location}]),placeholder:"Ex: Rayon A, Étagère 3, etc."},null,2),[[f,s(i).location]]),s(l).location?(n(),r("div",Ie,d(s(l).location),1)):u("",!0),e[41]||(e[41]=t("small",{class:"form-text text-muted"},"Emplacement du produit dans le magasin",-1))])]),t("div",Me,[t("div",Re,[e[42]||(e[42]=t("label",{class:"form-label"},"Stock minimum",-1)),p(t("input",{"onUpdate:modelValue":e[18]||(e[18]=o=>s(i).min_stock_level=o),type:"number",min:"0",class:v(["form-control",{"is-invalid":s(l).min_stock_level}])},null,2),[[f,s(i).min_stock_level]]),s(l).min_stock_level?(n(),r("div",Ge,d(s(l).min_stock_level),1)):u("",!0)]),t("div",Te,[e[44]||(e[44]=t("label",{class:"form-label"},"Statut",-1)),p(t("select",{"onUpdate:modelValue":e[19]||(e[19]=o=>s(i).is_active=o),class:v(["form-select",{"is-invalid":s(l).is_active}])},[...e[43]||(e[43]=[t("option",{value:!0},"Actif",-1),t("option",{value:!1},"Inactif",-1)])],2),[[x,s(i).is_active]]),s(l).is_active?(n(),r("div",Ke,d(s(l).is_active),1)):u("",!0)])])])]),t("div",Oe,[e[51]||(e[51]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Date d'expiration et alerte")],-1)),t("div",Ze,[t("div",Je,[t("div",We,[e[46]||(e[46]=t("label",{class:"form-label"},"Date d'expiration (optionnel)",-1)),p(t("input",{"onUpdate:modelValue":e[20]||(e[20]=o=>s(i).expiration_date=o),type:"date",class:v(["form-control",{"is-invalid":s(l).expiration_date}])},null,2),[[f,s(i).expiration_date]]),s(l).expiration_date?(n(),r("div",Xe,d(s(l).expiration_date),1)):u("",!0),e[47]||(e[47]=t("small",{class:"form-text text-muted"},"Date à laquelle le produit expire",-1))]),s(i).expiration_date?(n(),r("div",He,[e[49]||(e[49]=t("label",{class:"form-label"},"Seuil d'alerte",-1)),t("div",Qe,[t("div",Ye,[p(t("input",{"onUpdate:modelValue":e[21]||(e[21]=o=>s(i).alert_threshold_value=o),type:"number",min:"1",class:v(["form-control",{"is-invalid":s(l).alert_threshold_value}]),placeholder:"Nombre"},null,2),[[f,s(i).alert_threshold_value,void 0,{number:!0}]]),s(l).alert_threshold_value?(n(),r("div",et,d(s(l).alert_threshold_value),1)):u("",!0)]),t("div",tt,[p(t("select",{"onUpdate:modelValue":e[22]||(e[22]=o=>s(i).alert_threshold_unit=o),class:v(["form-select",{"is-invalid":s(l).alert_threshold_unit}])},[...e[48]||(e[48]=[t("option",{value:""},"Unité",-1),t("option",{value:"days"},"Jours",-1),t("option",{value:"weeks"},"Semaines",-1),t("option",{value:"months"},"Mois",-1)])],2),[[x,s(i).alert_threshold_unit]]),s(l).alert_threshold_unit?(n(),r("div",st,d(s(l).alert_threshold_unit),1)):u("",!0)])]),e[50]||(e[50]=t("small",{class:"form-text text-muted"},"Alerter X jours/semaines/mois avant l'expiration",-1))])):u("",!0)])])])]),t("div",it,[t("div",ot,[e[53]||(e[53]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Image du produit")],-1)),t("div",at,[C(W,{ref_key:"filePondRef",ref:F,name:"images","accepted-file-types":["image/jpeg","image/png","image/jpg","image/gif","image/webp"],"max-file-size":"5MB","max-files":1,"allow-multiple":!1,"image-resize-target-width":1200,"image-resize-target-height":1200,"image-resize-mode":"contain","image-resize-upscale":!1,"label-idle":"Glissez-déposez une image ou <span class='filepond--label-action'>Parcourir</span>",credits:!1,"onUpdate:files":z,onProcessfile:D,onAddfile:$},null,512),e[52]||(e[52]=t("small",{class:"form-text text-muted mt-2 d-block"}," Formats acceptés: JPG, PNG, GIF, WEBP. Taille max: 5 Mo. ",-1))])]),t("div",lt,[e[55]||(e[55]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Actions")],-1)),t("div",nt,[t("div",rt,[t("button",{type:"button",onClick:M,class:"btn btn-primary",disabled:s(U)},[s(U)?(n(),r("span",ct)):(n(),r("i",ut)),g(" "+d(s(U)?"Création...":"Créer le produit"),1)],8,dt),C(s(A),{href:s(q)("products.index"),class:"btn btn-outline-secondary"},{default:S(()=>[...e[54]||(e[54]=[g(" Annuler ",-1)])]),_:1},8,["href"])])])]),t("div",mt,[e[57]||(e[57]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Aperçu")],-1)),t("div",pt,[t("div",vt,[t("div",ft,[m.value?(n(),r("img",{key:0,src:m.value,alt:s(i).name||"Produit",class:"img-fluid rounded",style:{"max-height":"200px","max-width":"100%","object-fit":"contain"}},null,8,_t)):(n(),r("div",bt,[...e[56]||(e[56]=[t("i",{class:"bi bi-box fs-1 text-muted"},null,-1)])]))]),s(i).name?(n(),r(P,{key:0},[t("h6",gt,d(s(i).name),1),t("p",kt,d(s(i).description||"Aucune description"),1),t("div",yt,[t("span",ht,d(B(s(i).price)),1),t("span",xt,d(s(i).stock_quantity||0)+" "+d(s(i).unit),1)])],64)):(n(),r("p",qt,"Aperçu du produit"))])])])])])])]),_:1}))}});export{Vt as default};
