import{d as K,r as L,z as F,C as M,b as o,e as d,a as e,o as n,x as W,H as U,h as B,y as q,B as G,n as $,t as v,k as R,f as m,F as j,g as I,j as h,u as i,l as w,w as k,A as H,I as ne,c as oe}from"./app--1_n6QmE.js";import{r as p}from"./routes-BdA70M5q.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={key:0,class:"loading-overlay"},le=K({__name:"LoadingSpinner",setup(_){const a=L(!1),T=f=>{a.value=f.detail};return F(()=>{window.addEventListener("loading-state-changed",T),window.addEventListener("inertia:start",()=>{a.value=!0}),window.addEventListener("inertia:finish",()=>{setTimeout(()=>{a.value=!1},300)})}),M(()=>{window.removeEventListener("loading-state-changed",T),window.removeEventListener("inertia:start",()=>{}),window.removeEventListener("inertia:finish",()=>{})}),(f,b)=>a.value?(n(),o("div",ae,[...b[0]||(b[0]=[e("div",{class:"loading-content"},[e("div",{class:"spinner-container"},[e("div",{class:"spinner-grow text-primary",role:"status",style:{"animation-delay":"0s"}},[e("span",{class:"visually-hidden"},"Loading...")]),e("div",{class:"spinner-grow text-success",role:"status",style:{"animation-delay":"0.2s"}},[e("span",{class:"visually-hidden"},"Loading...")]),e("div",{class:"spinner-grow text-warning",role:"status",style:{"animation-delay":"0.4s"}},[e("span",{class:"visually-hidden"},"Loading...")])])],-1)])])):d("",!0)}}),re=X(le,[["__scopeId","data-v-fe3aa04c"]]);let C=null,Q=!1;const de=async()=>{try{return(!C||C.state==="closed")&&(C=new(window.AudioContext||window.webkitAudioContext),Q=!0),C.state==="suspended"&&await C.resume(),Q=!0,C}catch(_){return console.error("Erreur lors de l'activation du contexte audio:",_),null}},z=()=>{try{if(!C||C.state==="closed")return;C.state==="suspended"?C.resume().then(()=>{Y(C)}).catch(_=>{console.error("Erreur lors de la reprise du contexte audio:",_)}):Y(C)}catch(_){console.error("Erreur lors de la lecture du son:",_)}},Y=_=>{try{const a=_.createOscillator(),T=_.createOscillator(),f=_.createGain();a.connect(f),T.connect(f),f.connect(_.destination),a.frequency.value=800,a.type="sine",T.frequency.value=1e3,T.type="sine";const b=_.currentTime,x=.01,u=.05,P=.2,y=x+u+.1;f.gain.setValueAtTime(0,b),f.gain.linearRampToValueAtTime(.4,b+x),f.gain.exponentialRampToValueAtTime(P,b+x+u),f.gain.setValueAtTime(P,b+x+u),f.gain.exponentialRampToValueAtTime(.01,b+y),a.start(b),T.start(b),a.stop(b+y),T.stop(b+y),a.onended=()=>{a.disconnect()},T.onended=()=>{T.disconnect()}}catch(a){console.error("Erreur lors de la génération du son:",a)}},ce=()=>{const a=W().props.auth?.user?.id,T=L({salesDueToday:[],lowStockProducts:[],expiringProducts:[]}),f=L(!1),b=()=>{if(a&&!f.value)try{if(!U){console.error("Echo n'est pas disponible. Vérifiez que Pusher est correctement configuré.");return}const u=U.private(`user.${a}.notifications`);u.subscribed(()=>{f.value=!0}),u.error(P=>{console.error("Erreur lors de la souscription au canal:",P),f.value=!1}),u.listen(".notification.sent",P=>{if(P.notification){z(),window.dispatchEvent(new CustomEvent("notification-received",{detail:P.notification}));const c=P.notification?.type==="expiring_product"?1e3:500;setTimeout(()=>{B.reload({only:["notifications"],preserveScroll:!0,preserveState:!1,onSuccess:y=>{const A=y.props.notifications;window.dispatchEvent(new CustomEvent("notifications-updated",{detail:A}))},onError:y=>{console.error("Erreur lors du rechargement des notifications:",y)},onFinish:()=>{}})},c)}})}catch(u){console.error("Erreur lors de l'écoute des notifications:",u),f.value=!1}},x=()=>{if(!(!a||!f.value))try{U.leave(`user.${a}.notifications`),f.value=!1}catch(u){console.error("Erreur lors de l'arrêt de l'écoute:",u)}};return F(()=>{if(a){b();const u=()=>{de().catch(P=>{console.error("Erreur lors de l'activation de l'audio:",P)})};document.addEventListener("click",u,{once:!1,passive:!0}),document.addEventListener("keydown",u,{once:!1,passive:!0}),document.addEventListener("touchstart",u,{once:!1,passive:!0}),document.addEventListener("mousedown",u,{once:!1,passive:!0})}}),M(()=>{x()}),{notifications:T,startListening:b,stopListening:x,isListening:f,testSound:()=>{z()}}};typeof window<"u"&&(window.testNotificationSound=()=>{z()});const ue={class:"dropdown"},me=["id"],pe=["data-count"],fe=["aria-labelledby"],be={class:"notification-header"},ge={class:"d-flex justify-content-between align-items-center p-3 border-bottom bg-light"},ve={class:"mb-0 fw-bold d-flex align-items-center"},he={key:0,class:"badge bg-primary ms-2"},ye=["disabled"],we={key:0,class:"spinner-border spinner-border-sm me-1",role:"status"},ke={key:1,class:"bi bi-check-all"},xe={key:0,class:"notification-empty"},_e={class:"notification-section-header"},Te={class:"p-2 bg-warning bg-opacity-10 border-bottom"},$e={class:"d-flex justify-content-between align-items-center"},Pe={class:"flex-grow-1"},Se={class:"mb-1 small fw-bold d-flex align-items-center"},Ce={class:"badge bg-warning text-dark ms-2"},Ee={class:"mb-0 small text-muted"},Le={class:"dropdown-item notification-link d-flex align-items-start"},Ae={class:"d-flex justify-content-between align-items-start"},De={class:"flex-grow-1"},Ne={class:"fw-medium small d-flex align-items-center"},je={class:"text-muted small mt-1"},Ve={class:"badge bg-warning text-dark ms-2 flex-shrink-0"},Re=["onClick"],qe={key:0,class:"notification-more"},Oe={class:"notification-section-header"},Be={class:"p-2 bg-info bg-opacity-10 border-bottom"},Fe={class:"d-flex justify-content-between align-items-center"},Ie={class:"flex-grow-1"},Me={class:"mb-1 small fw-bold d-flex align-items-center"},We={class:"badge bg-info text-white ms-2"},Ue={class:"mb-0 small text-muted"},ze={class:"dropdown-item notification-link d-flex align-items-start"},Ke={class:"d-flex align-items-start"},Xe={class:"me-2 flex-shrink-0"},Je=["src","alt"],Ge={key:1,class:"bi bi-box-seam text-muted",style:{"font-size":"40px",width:"40px",height:"40px",display:"flex","align-items":"center","justify-content":"center"}},He={class:"flex-grow-1 d-flex justify-content-between align-items-start"},Qe={class:"flex-grow-1"},Ye={class:"fw-medium small d-flex align-items-center"},Ze={class:"text-muted small mt-1"},et={class:"badge bg-info text-white ms-2 flex-shrink-0"},tt=["onClick"],st={key:0,class:"notification-more"},it={class:"notification-section-header"},nt={class:"p-2 bg-danger bg-opacity-10 border-bottom"},ot={class:"d-flex justify-content-between align-items-center"},at={class:"flex-grow-1"},lt={class:"mb-1 small fw-bold d-flex align-items-center"},rt={class:"badge bg-danger ms-2"},dt={class:"mb-0 small text-muted"},ct={class:"dropdown-item notification-link d-flex align-items-start"},ut={class:"d-flex align-items-start"},mt={class:"me-2 flex-shrink-0"},pt=["src","alt"],ft={key:1,class:"bi bi-box-seam text-muted",style:{"font-size":"40px",width:"40px",height:"40px",display:"flex","align-items":"center","justify-content":"center"}},bt={class:"flex-grow-1 d-flex justify-content-between align-items-start"},gt={class:"flex-grow-1"},vt={class:"fw-medium small d-flex align-items-center"},ht={class:"text-muted small mt-1"},yt={key:0},wt={key:0,class:"text-danger fw-medium"},kt={key:1,class:"text-danger fw-medium"},xt={key:2,class:"text-warning fw-medium"},_t=["onClick"],Tt={key:0,class:"notification-more"},$t={key:2,class:"notification-footer"},Pt={class:"p-2 border-top bg-light text-center"},St=K({__name:"NotificationBell",props:{notifications:{}},setup(_){const a=_,T=L(`notification-dropdown-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),f=L(0),b=W(),x=()=>b.props.csrf_token||document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",u=L({salesDueToday:[],lowStockProducts:[],lowStockProductsTotal:void 0,expiringProducts:[],expiringProductsTotal:void 0});(()=>{const g=b.props.notifications||a.notifications||{salesDueToday:[],lowStockProducts:[],expiringProducts:[]};u.value={salesDueToday:g.salesDueToday||[],lowStockProducts:g.lowStockProducts||[],lowStockProductsTotal:g.lowStockProductsTotal,expiringProducts:g.expiringProducts||[],expiringProductsTotal:g.expiringProductsTotal}})();const c=q(()=>u.value),y=L(0),A=()=>{const g=u.value.salesDueToday?.length||0,t=u.value.lowStockProductsTotal??(u.value.lowStockProducts?.length||0),l=u.value.expiringProductsTotal??(u.value.expiringProducts?.length||0),S=g+t+l,O=y.value;S!==O&&(y.value=S,H(()=>{f.value++}))};G(u,()=>{A()},{deep:!0,immediate:!0});let D=null;G(()=>b.props.notifications,async g=>{const t=g;t&&({...u.value},u.value={salesDueToday:Array.isArray(t.salesDueToday)?[...t.salesDueToday]:[],lowStockProducts:Array.isArray(t.lowStockProducts)?[...t.lowStockProducts]:[],lowStockProductsTotal:t.lowStockProductsTotal,expiringProducts:Array.isArray(t.expiringProducts)?[...t.expiringProducts]:[],expiringProductsTotal:t.expiringProductsTotal},A())},{deep:!0,immediate:!0});const E=L(!1),r=async(g,t,l)=>{if(l){if(l.target.closest("a")){fetch(p("notifications.mark-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":x(),Accept:"application/json"},body:JSON.stringify({type:g,id:t})}).catch(O=>{});return}l.preventDefault(),l.stopPropagation()}try{(await fetch(p("notifications.mark-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":x(),Accept:"application/json"},body:JSON.stringify({type:g,id:t})})).ok&&B.reload({only:["notifications"]})}catch(S){console.error("Erreur lors du marquage comme lu:",S)}},s=async g=>{if(!E.value){E.value=!0;try{(await fetch(p("notifications.mark-all-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":x(),Accept:"application/json"},body:JSON.stringify({type:g})})).ok&&B.reload({only:["notifications"]})}catch(t){console.error("Erreur lors du marquage de toutes les notifications comme lues:",t)}finally{E.value=!1}}},N=async g=>{if(g.preventDefault(),g.stopPropagation(),!E.value){E.value=!0;try{if((await fetch(p("notifications.mark-all-as-read"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":x(),Accept:"application/json"},body:JSON.stringify({type:"all"})})).ok){const l=T.value,S=document.getElementById(l);if(S){const O=window.bootstrap;if(O&&O.Dropdown){const J=O.Dropdown.getInstance(S);J&&J.hide()}}B.reload({only:["notifications"]})}}catch(t){console.error("Erreur lors du marquage de toutes les notifications comme lues:",t)}finally{E.value=!1}}},V=g=>new Intl.NumberFormat("fr-FR").format(g)+" Fcfa",Z=g=>new Date(g).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),{startListening:ee,stopListening:te,testSound:se}=ce(),ie=async()=>{try{(await fetch(p("notifications.test"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"}})).ok&&se()}catch{}};return typeof window<"u"&&(window.testRealtimeNotification=ie),F(()=>{ee(),D=()=>{};const g=()=>{H(()=>{A()})};window.addEventListener("notification-received",D),window.addEventListener("notifications-updated",g),M(()=>{window.removeEventListener("notification-received",D),window.removeEventListener("notifications-updated",g)})}),M(()=>{te(),D&&window.removeEventListener("notification-received",D)}),(g,t)=>(n(),o("div",ue,[e("button",{class:$(["btn btn-sm btn-outline-primary position-relative notification-bell-btn",{"has-notifications":y.value>0}]),type:"button",id:T.value,"data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},[t[4]||(t[4]=e("i",{class:"bi bi-bell fs-5"},null,-1)),y.value>0?(n(),o("span",{key:`badge-${y.value}-${f.value}`,class:$(["position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-badge",{pulse:y.value>0}]),"data-count":y.value},v(y.value>99?"99+":y.value),11,pe)):d("",!0)],10,me),e("ul",{class:"dropdown-menu dropdown-menu-end shadow-lg notification-dropdown","aria-labelledby":T.value,onClick:t[3]||(t[3]=R(()=>{},["stop"]))},[e("li",be,[e("div",ge,[e("h6",ve,[t[5]||(t[5]=e("i",{class:"bi bi-bell-fill me-2 text-primary"},null,-1)),t[6]||(t[6]=m(" Notifications ",-1)),y.value>0?(n(),o("span",he,v(y.value),1)):d("",!0)]),y.value>0?(n(),o("button",{key:0,onClick:N,class:"btn btn-sm btn-link text-decoration-none p-0 text-muted",type:"button",title:"Tout marquer comme lu",disabled:E.value},[E.value?(n(),o("span",we)):(n(),o("i",ke))],8,ye)):d("",!0)])]),y.value===0?(n(),o("li",xe,[...t[7]||(t[7]=[e("div",{class:"p-5 text-center text-muted"},[e("i",{class:"bi bi-bell-slash fs-1 d-block mb-3 text-muted opacity-50"}),e("p",{class:"mb-0 fw-medium"},"Aucune notification"),e("p",{class:"small mb-0 mt-2"},"Vous êtes à jour !")],-1)])])):(n(),o(j,{key:1},[c.value.salesDueToday&&c.value.salesDueToday.length>0?(n(),o(j,{key:0},[e("li",_e,[e("div",Te,[e("div",$e,[e("div",Pe,[e("h6",Se,[t[8]||(t[8]=e("i",{class:"bi bi-calendar-event-fill me-2 text-warning"},null,-1)),t[9]||(t[9]=m(" Ventes avec échéance aujourd'hui ",-1)),e("span",Ce,v(c.value.salesDueToday.length),1)]),e("p",Ee,v(c.value.salesDueToday.length)+" vente(s) non payée(s) ",1)]),e("button",{onClick:t[0]||(t[0]=R(l=>s("sale_due_today"),["stop"])),class:"btn btn-sm btn-link text-muted p-0 ms-2",type:"button",title:"Marquer toutes comme lues"},[...t[10]||(t[10]=[e("i",{class:"bi bi-check-all"},null,-1)])])])])]),(n(!0),o(j,null,I(c.value.salesDueToday.slice(0,3),l=>(n(),o("li",{key:l.id,class:"notification-item"},[e("div",Le,[h(i(w),{href:i(p)("sales.show",{id:l.id}),class:"flex-grow-1 text-decoration-none",onClick:S=>r("sale_due_today",l.id,S)},{default:k(()=>[e("div",Ae,[e("div",De,[e("div",Ne,[t[11]||(t[11]=e("i",{class:"bi bi-receipt me-2 text-warning"},null,-1)),m(" Vente "+v(l.sale_number),1)]),e("div",je,[t[12]||(t[12]=e("i",{class:"bi bi-person me-1"},null,-1)),m(" "+v(l.customer),1)])]),e("span",Ve,v(V(l.remaining_amount)),1)])]),_:2},1032,["href","onClick"]),e("button",{onClick:R(S=>r("sale_due_today",l.id),["stop"]),class:"btn btn-sm btn-link text-muted p-0 ms-2 flex-shrink-0",type:"button",title:"Marquer comme lu"},[...t[13]||(t[13]=[e("i",{class:"bi bi-check-circle"},null,-1)])],8,Re)])]))),128)),c.value.salesDueToday.length>3?(n(),o("li",qe,[h(i(w),{href:i(p)("sales.index",{due_date:new Date().toISOString().split("T")[0]}),class:"dropdown-item text-center text-primary small fw-medium"},{default:k(()=>[t[14]||(t[14]=e("i",{class:"bi bi-arrow-right-circle me-1"},null,-1)),m(" Voir toutes ("+v(c.value.salesDueToday.length)+") ",1)]),_:1},8,["href"])])):d("",!0),t[15]||(t[15]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1))],64)):d("",!0),c.value.lowStockProducts&&c.value.lowStockProducts.length>0?(n(),o(j,{key:1},[e("li",Oe,[e("div",Be,[e("div",Fe,[e("div",Ie,[e("h6",Me,[t[16]||(t[16]=e("i",{class:"bi bi-exclamation-triangle-fill me-2 text-info"},null,-1)),t[17]||(t[17]=m(" Stock faible ",-1)),e("span",We,v(c.value.lowStockProducts.length),1)]),e("p",Ue,v(c.value.lowStockProducts.length)+" produit(s) en rupture ou niveau faible ",1)]),e("button",{onClick:t[1]||(t[1]=R(l=>s("low_stock"),["stop"])),class:"btn btn-sm btn-link text-muted p-0 ms-2",type:"button",title:"Marquer toutes comme lues"},[...t[18]||(t[18]=[e("i",{class:"bi bi-check-all"},null,-1)])])])])]),(n(!0),o(j,null,I(c.value.lowStockProducts.slice(0,3),l=>(n(),o("li",{key:l.id,class:"notification-item"},[e("div",ze,[h(i(w),{href:i(p)("products.show",{id:l.id}),class:"flex-grow-1 text-decoration-none",onClick:S=>r("low_stock",l.id,S)},{default:k(()=>[e("div",Ke,[e("div",Xe,[l.image_url?(n(),o("img",{key:0,src:l.image_url,alt:l.name,class:"rounded",style:{width:"40px",height:"40px","object-fit":"contain"}},null,8,Je)):(n(),o("i",Ge))]),e("div",He,[e("div",Qe,[e("div",Ye,v(l.name),1),e("div",Ze,[t[19]||(t[19]=e("i",{class:"bi bi-tag me-1"},null,-1)),m(" "+v(l.category?.name||"Sans catégorie"),1)])]),e("span",et,v(l.stock_quantity)+" "+v(l.unit),1)])])]),_:2},1032,["href","onClick"]),e("button",{onClick:R(S=>r("low_stock",l.id),["stop"]),class:"btn btn-sm btn-link text-muted p-0 ms-2 flex-shrink-0",type:"button",title:"Marquer comme lu"},[...t[20]||(t[20]=[e("i",{class:"bi bi-check-circle"},null,-1)])],8,tt)])]))),128)),c.value.lowStockProducts.length>3?(n(),o("li",st,[h(i(w),{href:i(p)("products.index"),class:"dropdown-item text-center text-primary small fw-medium"},{default:k(()=>[t[21]||(t[21]=e("i",{class:"bi bi-arrow-right-circle me-1"},null,-1)),m(" Voir tous ("+v(c.value.lowStockProducts.length)+") ",1)]),_:1},8,["href"])])):d("",!0),t[22]||(t[22]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1))],64)):d("",!0),c.value.expiringProducts&&c.value.expiringProducts.length>0?(n(),o(j,{key:2},[e("li",it,[e("div",nt,[e("div",ot,[e("div",at,[e("h6",lt,[t[23]||(t[23]=e("i",{class:"bi bi-exclamation-triangle-fill me-2 text-danger"},null,-1)),t[24]||(t[24]=m(" Produits expirés ou proches de l'expiration ",-1)),e("span",rt,v(c.value.expiringProductsTotal||c.value.expiringProducts.length),1)]),e("p",dt,v(c.value.expiringProductsTotal||c.value.expiringProducts.length)+" produit(s) concerné(s) ",1)]),e("button",{onClick:t[2]||(t[2]=R(l=>s("expiring_product"),["stop"])),class:"btn btn-sm btn-link text-muted p-0 ms-2",type:"button",title:"Marquer toutes comme lues"},[...t[25]||(t[25]=[e("i",{class:"bi bi-check-all"},null,-1)])])])])]),(n(!0),o(j,null,I((c.value.expiringProducts||[]).slice(0,3),l=>(n(),o("li",{key:l.id,class:"notification-item"},[e("div",ct,[h(i(w),{href:i(p)("products.show",{id:l.id}),class:"flex-grow-1 text-decoration-none",onClick:S=>r("expiring_product",l.id,S)},{default:k(()=>[e("div",ut,[e("div",mt,[l.image_url?(n(),o("img",{key:0,src:l.image_url,alt:l.name,class:"rounded",style:{width:"40px",height:"40px","object-fit":"contain"}},null,8,pt)):(n(),o("i",ft))]),e("div",bt,[e("div",gt,[e("div",vt,v(l.name),1),e("div",ht,[l.days_until_expiration!==null?(n(),o("span",yt,[t[26]||(t[26]=e("i",{class:"bi bi-calendar3 me-1"},null,-1)),l.days_until_expiration<0?(n(),o("span",wt," Expiré depuis "+v(Math.abs(l.days_until_expiration))+" jour(s) ",1)):l.days_until_expiration===0?(n(),o("span",kt," Expire aujourd'hui ")):(n(),o("span",xt," Expire dans "+v(l.days_until_expiration)+" jour(s) ",1))])):d("",!0)])]),l.days_until_expiration!==null?(n(),o("span",{key:0,class:$(["badge ms-2 flex-shrink-0",l.days_until_expiration<0||l.days_until_expiration===0?"bg-danger":"bg-warning text-dark"])},v(Z(l.expiration_date)),3)):d("",!0)])])]),_:2},1032,["href","onClick"]),e("button",{onClick:R(S=>r("expiring_product",l.id),["stop"]),class:"btn btn-sm btn-link text-muted p-0 ms-2 flex-shrink-0",type:"button",title:"Marquer comme lu"},[...t[27]||(t[27]=[e("i",{class:"bi bi-check-circle"},null,-1)])],8,_t)])]))),128)),(c.value.expiringProductsTotal||c.value.expiringProducts.length)>3?(n(),o("li",Tt,[h(i(w),{href:i(p)("products.index",{expiration_alert:!0}),class:"dropdown-item text-center text-primary small fw-medium"},{default:k(()=>[t[28]||(t[28]=e("i",{class:"bi bi-arrow-right-circle me-1"},null,-1)),m(" Voir tous ("+v(c.value.expiringProductsTotal||c.value.expiringProducts.length)+") ",1)]),_:1},8,["href"])])):d("",!0)],64)):d("",!0)],64)),y.value>0?(n(),o("li",$t,[e("div",Pt,[h(i(w),{href:i(p)("dashboard"),class:"btn btn-sm btn-primary w-100"},{default:k(()=>[...t[29]||(t[29]=[e("i",{class:"bi bi-speedometer2 me-1"},null,-1),m(" Voir le tableau de bord ",-1)])]),_:1},8,["href"])])])):d("",!0)],8,fe)]))}}),Ct=X(St,[["__scopeId","data-v-c3074d17"]]),Et=()=>{const _=W(),a=q(()=>_.props.auth?.user),T=q(()=>a.value?.role==="admin"),f=q(()=>a.value?.role==="vendeur"),b=q(()=>a.value?.permissions||[]),x=(s,N)=>{if(T.value)return!0;const V=`${s}.${N}`;return b.value.includes(V)};return{isAdmin:T,isVendeur:f,userPermissions:b,hasPermission:x,hasPermissionByName:s=>T.value?!0:b.value.includes(s),canCreate:s=>x(s,"create"),canView:s=>x(s,"view"),canEdit:s=>x(s,"edit"),canUpdate:s=>x(s,"update"),canDelete:s=>x(s,"delete"),canDownload:s=>x(s,"download"),canRestore:s=>x(s,"restore")}},Lt={class:"d-flex min-vh-100 bg-light"},At={class:"sidebar-header p-3 border-bottom border-white border-opacity-25"},Dt={class:"sidebar-nav p-3"},Nt={class:"nav nav-pills flex-column"},jt={key:0,class:"nav-item mb-2"},Vt={key:1,class:"nav-divider my-2"},Rt={key:2,class:"nav-item mb-2"},qt={key:3,class:"nav-item mb-2"},Ot={key:4,class:"nav-divider my-2"},Bt={key:5,class:"nav-item mb-2"},Ft={key:6,class:"nav-item mb-2"},It={key:7,class:"nav-item mb-2"},Mt={key:8,class:"nav-item mb-2"},Wt={key:9,class:"nav-divider my-2"},Ut={key:10,class:"nav-item mb-2"},zt={key:11,class:"nav-item mb-2"},Kt={key:12,class:"nav-item mb-2"},Xt={key:13,class:"nav-divider my-2"},Jt={key:14,class:"nav-item mb-2"},Gt={key:15,class:"nav-divider my-2"},Ht={key:16,class:"nav-item mb-2"},Qt={key:17,class:"nav-item mb-2"},Yt={class:"main-content flex-grow-1 d-flex flex-column"},Zt={class:"bg-white shadow-sm border-bottom"},es={class:"container-fluid px-3 py-2 d-flex justify-content-between align-items-center"},ts={key:0,"aria-label":"breadcrumb",class:"flex-grow-1"},ss={class:"breadcrumb mb-0"},is={key:0,class:"breadcrumb-item"},ns={key:1},os={class:"d-flex align-items-center gap-2 ms-auto"},as={class:"dropdown"},ls={class:"btn btn-sm btn-outline-primary d-flex align-items-center gap-2",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},rs={class:"d-none d-md-inline"},ds={class:"dropdown-menu dropdown-menu-end shadow"},cs={class:"px-3 py-2"},us={class:"fw-medium"},ms={class:"flex-grow-1 container-fluid py-4"},ps=K({__name:"BootstrapLayout",props:{breadcrumbs:{default:()=>[]}},setup(_){const{canView:a,isAdmin:T}=Et(),f=W(),b=q(()=>T.value),x=L(!1);F(()=>{setTimeout(()=>{const r=f.props.auth?.user;r&&r.id&&!x.value&&(r.role===void 0||r.role===null)&&(x.value=!0,B.reload({only:["auth"]}))},100)});const u=q(()=>f.props.notifications||{salesDueToday:[],lowStockProducts:[],expiringProducts:[]}),P=L(!1),c=L(!1);F(()=>{P.value=document.documentElement.classList.contains("dark"),new MutationObserver(()=>{P.value=document.documentElement.classList.contains("dark")}).observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})});const y=()=>{const s=(document.documentElement.classList.contains("dark")?"dark":"light")==="dark"?"light":"dark";s==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("appearance",s),P.value=s==="dark"},A=()=>{const r=document.querySelector(".sidebar");r&&(r.classList.toggle("show"),c.value=r.classList.contains("show"))},D=r=>({admin:"Administrateur",vendeur:"Vendeur",gestionnaire:"Gestionnaire",user:"Utilisateur"})[r||"user"]||"Utilisateur",E=r=>({admin:"bg-danger",vendeur:"bg-primary",gestionnaire:"bg-info",user:"bg-secondary"})[r||"user"]||"bg-secondary";return(r,s)=>(n(),o("div",Lt,[e("div",{class:$(["sidebar bg-primary text-white",{"sidebar-dark":P.value}])},[e("div",At,[h(i(w),{href:i(p)("dashboard"),class:"d-flex align-items-center text-white text-decoration-none"},{default:k(()=>[...s[0]||(s[0]=[e("div",{class:"me-2"},[e("img",{src:"/logo.png",alt:"Logo",class:"logo-img",style:{width:"120px",height:"120px","object-fit":"contain"}})],-1),e("span",{class:"fw-bold"},"Gestion",-1)])]),_:1},8,["href"])]),e("nav",Dt,[e("ul",Nt,[i(a)("dashboard")?(n(),o("li",jt,[h(i(w),{href:i(p)("dashboard"),class:$(["nav-link",{active:r.$page.url==="/"}])},{default:k(()=>[...s[1]||(s[1]=[e("i",{class:"bi bi-house-door me-2"},null,-1),m(" Dashboard ",-1)])]),_:1},8,["href","class"])])):d("",!0),i(a)("products")||i(a)("categories")?(n(),o("li",Vt)):d("",!0),i(a)("products")?(n(),o("li",Rt,[h(i(w),{href:i(p)("products.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/products")}])},{default:k(()=>[...s[2]||(s[2]=[e("i",{class:"bi bi-box me-2"},null,-1),m(" Produits ",-1)])]),_:1},8,["href","class"])])):d("",!0),i(a)("categories")?(n(),o("li",qt,[h(i(w),{href:i(p)("categories.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/categories")}])},{default:k(()=>[...s[3]||(s[3]=[e("i",{class:"bi bi-tags me-2"},null,-1),m(" Catégories ",-1)])]),_:1},8,["href","class"])])):d("",!0),i(a)("customers")||i(a)("sales")||i(a)("quotes")||i(a)("expenses")?(n(),o("li",Ot)):d("",!0),i(a)("customers")?(n(),o("li",Bt,[h(i(w),{href:i(p)("customers.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/customers")}])},{default:k(()=>[...s[4]||(s[4]=[e("i",{class:"bi bi-people me-2"},null,-1),m(" Clients ",-1)])]),_:1},8,["href","class"])])):d("",!0),i(a)("sales")?(n(),o("li",Ft,[h(i(w),{href:i(p)("sales.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/sales")}])},{default:k(()=>[...s[5]||(s[5]=[e("i",{class:"bi bi-cart me-2"},null,-1),m(" Ventes ",-1)])]),_:1},8,["href","class"])])):d("",!0),i(a)("quotes")?(n(),o("li",It,[h(i(w),{href:i(p)("quotes.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/quotes")}])},{default:k(()=>[...s[6]||(s[6]=[e("i",{class:"bi bi-file-earmark-check me-2"},null,-1),m(" Devis ",-1)])]),_:1},8,["href","class"])])):d("",!0),i(a)("expenses")?(n(),o("li",Mt,[h(i(w),{href:i(p)("expenses.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/expenses")}])},{default:k(()=>[...s[7]||(s[7]=[e("i",{class:"bi bi-receipt me-2"},null,-1),m(" Dépenses ",-1)])]),_:1},8,["href","class"])])):d("",!0),i(a)("suppliers")||i(a)("purchase-orders")||i(a)("delivery-notes")?(n(),o("li",Wt)):d("",!0),i(a)("suppliers")?(n(),o("li",Ut,[h(i(w),{href:i(p)("suppliers.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/suppliers")}])},{default:k(()=>[...s[8]||(s[8]=[e("i",{class:"bi bi-truck me-2"},null,-1),m(" Fournisseurs ",-1)])]),_:1},8,["href","class"])])):d("",!0),i(a)("purchase-orders")?(n(),o("li",zt,[h(i(w),{href:i(p)("purchase-orders.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/purchase-orders")}])},{default:k(()=>[...s[9]||(s[9]=[e("i",{class:"bi bi-file-earmark-text me-2"},null,-1),m(" Bons de commande ",-1)])]),_:1},8,["href","class"])])):d("",!0),i(a)("delivery-notes")?(n(),o("li",Kt,[h(i(w),{href:i(p)("delivery-notes.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/delivery-notes")}])},{default:k(()=>[...s[10]||(s[10]=[e("i",{class:"bi bi-clipboard-check me-2"},null,-1),m(" Bons de livraison ",-1)])]),_:1},8,["href","class"])])):d("",!0),i(a)("company")?(n(),o("li",Xt)):d("",!0),i(a)("company")?(n(),o("li",Jt,[h(i(w),{href:i(p)("company.edit"),class:$(["nav-link",{active:r.$page.url.startsWith("/company")}])},{default:k(()=>[...s[11]||(s[11]=[e("i",{class:"bi bi-building me-2"},null,-1),m(" Entreprise ",-1)])]),_:1},8,["href","class"])])):d("",!0),b.value?(n(),o("li",Gt)):d("",!0),b.value?(n(),o("li",Ht,[h(i(w),{href:i(p)("admin.users.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/admin/users")}])},{default:k(()=>[...s[12]||(s[12]=[e("i",{class:"bi bi-shield-lock me-2"},null,-1),m(" Utilisateurs ",-1)])]),_:1},8,["href","class"])])):d("",!0),b.value&&i(a)("backups")?(n(),o("li",Qt,[h(i(w),{href:i(p)("admin.backups.index"),class:$(["nav-link",{active:r.$page.url.startsWith("/admin/backups")}])},{default:k(()=>[...s[13]||(s[13]=[e("i",{class:"bi bi-database me-2"},null,-1),m(" Sauvegardes ",-1)])]),_:1},8,["href","class"])])):d("",!0)])])],2),e("div",Yt,[e("header",Zt,[e("div",es,[e("button",{class:"btn btn-sm btn-outline-primary d-md-none me-2",onClick:A,type:"button"},[...s[14]||(s[14]=[e("i",{class:"bi bi-list"},null,-1)])]),_.breadcrumbs&&_.breadcrumbs.length>0?(n(),o("nav",ts,[e("ol",ss,[i(f).url.includes("/settings")?d("",!0):(n(),o("li",is,[h(i(w),{href:i(p)("dashboard")},{default:k(()=>[...s[15]||(s[15]=[e("i",{class:"bi bi-house-door me-1"},null,-1),m(" Accueil ",-1)])]),_:1},8,["href"])])),(n(!0),o(j,null,I(_.breadcrumbs,(N,V)=>(n(),o("li",{key:V,class:$(["breadcrumb-item",{active:V===_.breadcrumbs.length-1}])},[N.href&&V<_.breadcrumbs.length-1?(n(),oe(i(w),{key:0,href:N.href},{default:k(()=>[m(v(N.title),1)]),_:2},1032,["href"])):(n(),o("span",ns,v(N.title),1))],2))),128))])])):d("",!0),e("div",os,[h(Ct,{notifications:u.value},null,8,["notifications"]),e("button",{onClick:y,class:"btn btn-sm btn-outline-primary",type:"button"},[e("i",{class:$(P.value?"bi bi-sun":"bi bi-moon")},null,2)]),e("div",as,[e("button",ls,[s[16]||(s[16]=e("i",{class:"bi bi-person-circle"},null,-1)),e("span",rs,[m(v(r.$page.props.auth.user?.name||"Utilisateur")+" ",1),e("span",{class:$(["badge ms-2",E(r.$page.props.auth.user?.role)])},v(D(r.$page.props.auth.user?.role)),3)])]),e("ul",ds,[e("li",cs,[s[17]||(s[17]=e("div",{class:"small text-muted"},"Rôle",-1)),e("div",us,v(D(r.$page.props.auth.user?.role)),1)]),s[20]||(s[20]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[h(i(w),{href:i(p)("profile.edit"),class:"dropdown-item"},{default:k(()=>[...s[18]||(s[18]=[e("i",{class:"bi bi-person me-2"},null,-1),m(" Profil ",-1)])]),_:1},8,["href"])]),s[21]||(s[21]=e("li",null,[e("hr",{class:"dropdown-divider"})],-1)),e("li",null,[h(i(w),{href:i(p)("logout"),method:"post",class:"dropdown-item text-danger"},{default:k(()=>[...s[19]||(s[19]=[e("i",{class:"bi bi-box-arrow-right me-2"},null,-1),m(" Déconnexion ",-1)])]),_:1},8,["href"])])])])])])]),c.value?(n(),o("div",{key:0,class:"sidebar-overlay d-md-none",onClick:A})):d("",!0),e("main",ms,[ne(r.$slots,"default",{},void 0,!0)])]),h(re)]))}}),vs=X(ps,[["__scopeId","data-v-2de516f2"]]);export{vs as B,Et as u};
