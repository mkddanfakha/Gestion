import{d as P,r as c,y as U,B as V,A as q,z as Y,C as $,b as u,a as r,c as j,m as H,e as v,v as O,K as y,n as L,k as x,T as Q,s as z,F as X,g as G,t as b,o as a}from"./app-eRcTGwFI.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"input-group"},Z=["placeholder","disabled","onKeydown"],ee=["onMousedown","onMouseenter"],te={class:"d-flex align-items-center justify-content-between"},le={class:"fw-medium"},oe={key:0,class:"text-muted small mt-1"},ae={key:0},ne={key:1},se={key:2},ue=P({__name:"CustomerAutocomplete",props:{customers:{},modelValue:{},placeholder:{default:"Rechercher un client..."},disabled:{type:Boolean,default:!1},isInvalid:{type:Boolean,default:!1},isValid:{type:Boolean,default:!1}},emits:["update:modelValue","selected"],setup(m,{expose:D,emit:R}){const h=m,k=R,B=c(null),f=c(null),n=c(""),o=c(!1),s=c(-1),p=c(null),d=c({top:0,left:0,width:0}),i=U(()=>{if(!n.value)return h.customers.slice(0,10);const e=n.value.toLowerCase();return h.customers.filter(l=>{const t=l.name.toLowerCase().includes(e),w=l.email?.toLowerCase().includes(e)||!1,_=l.phone?.toLowerCase().includes(e)||!1;return t||w||_}).slice(0,10)}),g=()=>{if(f.value){const e=f.value.getBoundingClientRect();d.value={top:e.bottom+window.scrollY,left:e.left+window.scrollX,width:e.width}}},F=()=>{g(),o.value=!0},T=()=>{g(),o.value=!0,s.value=-1},A=()=>{setTimeout(()=>{o.value=!1},200)},C=e=>{p.value=e,n.value=e.name,k("update:modelValue",e.id),k("selected",e),o.value=!1},E=()=>{i.value.length>0&&s.value>=0?C(i.value[s.value]):i.value.length>0&&C(i.value[0])},K=()=>{s.value<i.value.length-1&&s.value++},S=()=>{s.value>0&&s.value--},N=()=>{o.value=!1,s.value=-1},I=()=>{p.value=null,n.value="",k("update:modelValue",null),o.value=!1};V(()=>h.modelValue,e=>{if(e&&e>0){const l=h.customers.find(t=>t.id===e);l?(p.value=l,n.value=l.name):(p.value=null,n.value="")}else p.value=null,n.value=""},{immediate:!0}),V(o,e=>{e&&q(()=>{g()})});const M=e=>{const l=e.target;if(f.value&&!f.value.contains(l)){const t=document.querySelector(".customer-dropdown-menu");t&&!t.contains(l)?o.value=!1:t||(o.value=!1)}};return Y(()=>{document.addEventListener("click",M)}),$(()=>{document.removeEventListener("click",M)}),D({focus:()=>B.value?.focus(),clear:I}),(e,l)=>(a(),u("div",{ref_key:"containerRef",ref:f,class:"customer-autocomplete position-relative",style:{"z-index":"1"}},[r("div",W,[H(r("input",{ref_key:"inputRef",ref:B,"onUpdate:modelValue":l[0]||(l[0]=t=>n.value=t),type:"text",class:L(["form-control",{"is-invalid":m.isInvalid,"is-valid":m.isValid}]),placeholder:m.placeholder,disabled:m.disabled,onInput:T,onFocus:F,onBlur:A,onKeydown:[y(x(E,["prevent"]),["enter"]),y(x(K,["prevent"]),["arrow-down"]),y(x(S,["prevent"]),["arrow-up"]),y(N,["escape"])]},null,42,Z),[[O,n.value]]),p.value?(a(),u("button",{key:0,type:"button",class:"btn btn-outline-secondary",onClick:I},[...l[1]||(l[1]=[r("i",{class:"bi bi-x"},null,-1)])])):v("",!0)]),(a(),j(Q,{to:"body"},[o.value&&i.value.length>0?(a(),u("div",{key:0,class:"customer-dropdown-menu",style:z({position:"absolute",top:d.value.top+"px",left:d.value.left+"px",width:d.value.width+"px",zIndex:1050,maxHeight:"300px",overflowY:"auto"})},[(a(!0),u(X,null,G(i.value,(t,w)=>(a(),u("div",{key:t.id,class:L(["dropdown-item",{active:w===s.value}]),onMousedown:x(_=>C(t),["prevent"]),onMouseenter:_=>s.value=w},[r("div",te,[r("div",null,[r("div",le,b(t.name),1),t.email||t.phone?(a(),u("div",oe,[t.email?(a(),u("span",ae,b(t.email),1)):v("",!0),t.email&&t.phone?(a(),u("span",ne," • ")):v("",!0),t.phone?(a(),u("span",se,b(t.phone),1)):v("",!0)])):v("",!0)])])],42,ee))),128))],4)):v("",!0),o.value&&n.value&&i.value.length===0?(a(),u("div",{key:1,class:"customer-dropdown-menu",style:z({position:"absolute",top:d.value.top+"px",left:d.value.left+"px",width:d.value.width+"px",zIndex:1050})},[...l[2]||(l[2]=[r("div",{class:"dropdown-item text-muted"}," Aucun client trouvé ",-1)])],4)):v("",!0)]))],512))}}),ce=J(ue,[["__scopeId","data-v-7c3f5752"]]);export{ce as C};
