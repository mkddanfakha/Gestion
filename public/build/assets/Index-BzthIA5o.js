import{d as O,r as k,c as U,w,a as e,f as u,j as E,b as c,o as i,t as o,u as h,l as g,n as L,m as P,v as $,e as N,F as S,g as R,h as T}from"./app-DG1zKyXK.js";import{_ as B}from"./AppLayout.vue_vue_type_script_setup_true_lang-BeGZtpnK.js";import{r as v}from"./routes-C8N3XD_S.js";import{u as H}from"./useSweetAlert-CjcY7Pj8.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BootstrapLayout-BOh8Ux6F.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const G={class:"d-flex justify-content-between align-items-center mb-4"},q={class:"d-flex gap-2"},J=["disabled"],K={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Q={key:1,class:"bi bi-file-pdf me-1"},W=["disabled"],X={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Y={key:1,class:"bi bi-file-excel me-1"},Z={class:"card mb-4"},ee={class:"card-body"},te={class:"row g-3"},se={class:"col-md-4"},le={class:"card"},ne={class:"table-responsive"},ie={class:"table table-hover mb-0"},oe={class:"d-flex align-items-center"},ae={class:"fw-medium"},re={class:"text-muted small"},de={class:"small"},ce={class:"fw-medium"},ue={class:"text-muted"},me={class:"small"},fe={class:"fw-medium"},be={class:"text-muted"},pe={class:"badge bg-light text-dark"},he={class:"text-end"},ve={class:"btn-group",role:"group"},_e=["onClick"],xe={key:0,class:"card-footer"},we={class:"d-flex justify-content-between align-items-center"},ge={class:"d-none d-md-block"},ye={class:"text-muted mb-0"},ke={class:"fw-medium"},Ee={class:"fw-medium"},Ce={class:"fw-medium"},Ue={class:"pagination pagination-sm mb-0"},Le=["innerHTML"],Se=O({__name:"Index",props:{customers:{},filters:{}},setup(f){const a=k(!1),r=k(!1),j=f,{success:M,error:y,confirm:A}=H(),m=k({...j.filters}),C=()=>{T.get(v("customers.index"),m.value,{preserveState:!0,replace:!0})},D=()=>{m.value={},C()},I=async n=>{await A(`Êtes-vous sûr de vouloir supprimer le client "${n.name}" ?`)&&T.delete(v("customers.destroy",{id:n.id}),{onSuccess:()=>{M(`Client "${n.name}" supprimé avec succès !`)},onError:s=>{const _=s.message||"Erreur lors de la suppression du client.";y(_)}})},F=async()=>{if(!(a.value||r.value)){a.value=!0;try{let n=v("customers.export.pdf");const t=new URLSearchParams;m.value.search&&t.append("search",m.value.search),t.toString()&&(n+="?"+t.toString());const s=await fetch(n);if(!s.ok)throw new Error("Erreur lors de l'export");const _=await s.blob(),x=window.URL.createObjectURL(_),d=document.createElement("a");d.href=x;const b=s.headers.get("content-disposition");let p="clients_"+new Date().toISOString().split("T")[0]+".pdf";if(b){let l=b.match(/filename\*=UTF-8''(.+)/i);l?p=decodeURIComponent(l[1]):(l=b.match(/filename="?([^"]+)"?/i),l&&l[1]&&(p=l[1].trim()))}d.download=p,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(x),setTimeout(()=>{a.value=!1},500)}catch{a.value=!1,y("Erreur lors de l'export PDF")}}},V=async()=>{if(!(r.value||a.value)){r.value=!0;try{let n=v("customers.export.excel");const t=new URLSearchParams;m.value.search&&t.append("search",m.value.search),t.toString()&&(n+="?"+t.toString());const s=await fetch(n);if(!s.ok)throw new Error("Erreur lors de l'export");const _=await s.blob(),x=window.URL.createObjectURL(_),d=document.createElement("a");d.href=x;const b=s.headers.get("content-disposition");let p="clients_"+new Date().toISOString().split("T")[0]+".xlsx";if(b){let l=b.match(/filename\*=UTF-8''(.+)/i);l?p=decodeURIComponent(l[1]):(l=b.match(/filename="?([^"]+)"?/i),l&&l[1]&&(p=l[1].trim()))}d.download=p,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(x),setTimeout(()=>{r.value=!1},500)}catch{r.value=!1,y("Erreur lors de l'export Excel")}}};return(n,t)=>(i(),U(B,null,{default:w(()=>[e("div",G,[t[2]||(t[2]=e("div",null,[e("h1",{class:"h2 mb-1"},[e("i",{class:"bi bi-people me-2"}),u(" Clients ")]),e("p",{class:"text-muted mb-0"},"Gérez votre base de clients")],-1)),e("div",q,[e("button",{onClick:F,class:"btn btn-danger",disabled:a.value||r.value},[a.value?(i(),c("span",K)):(i(),c("i",Q)),u(" "+o(a.value?"Export en cours...":"Exporter PDF"),1)],8,J),e("button",{onClick:V,class:"btn btn-success",disabled:r.value||a.value},[r.value?(i(),c("span",X)):(i(),c("i",Y)),u(" "+o(r.value?"Export en cours...":"Exporter Excel"),1)],8,W),E(h(g),{href:h(v)("customers.create"),class:L(["btn btn-primary",{disabled:a.value||r.value}]),tabindex:a.value||r.value?-1:0},{default:w(()=>[...t[1]||(t[1]=[e("i",{class:"bi bi-plus-circle me-1"},null,-1),u(" Ajouter un client ",-1)])]),_:1},8,["href","class","tabindex"])])]),e("div",Z,[e("div",ee,[e("div",te,[e("div",se,[t[3]||(t[3]=e("label",{class:"form-label"},"Recherche",-1)),P(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value.search=s),type:"text",placeholder:"Nom, email ou téléphone...",class:"form-control",onInput:C},null,544),[[$,m.value.search]])]),e("div",{class:"col-md-2 d-flex align-items-end"},[e("button",{onClick:D,class:"btn btn-outline-secondary w-100"},[...t[4]||(t[4]=[e("i",{class:"bi bi-x-circle me-1"},null,-1),u(" Effacer les filtres ",-1)])])])])])]),e("div",le,[e("div",ne,[e("table",ie,[t[9]||(t[9]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Client"),e("th",null,"Contact"),e("th",null,"Adresse"),e("th",null,"Ventes"),e("th",{class:"text-end"},"Actions")])],-1)),e("tbody",null,[(i(!0),c(S,null,R(f.customers.data,s=>(i(),c("tr",{key:s.id},[e("td",null,[e("div",oe,[t[5]||(t[5]=e("div",{class:"flex-shrink-0 me-3"},[e("div",{class:"bg-light rounded-circle d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-person text-muted"})])],-1)),e("div",null,[e("div",ae,o(s.name),1),e("div",re,"Client #"+o(s.id),1)])])]),e("td",null,[e("div",de,[e("div",ce,o(s.email||"Aucun email"),1),e("div",ue,o(s.phone||"Aucun téléphone"),1)])]),e("td",null,[e("div",me,[e("div",fe,o(s.address||"Aucune adresse"),1),e("div",be,o(s.city&&s.postal_code?`${s.postal_code} ${s.city}`:""),1)])]),e("td",null,[e("span",pe,o(s.sales_count||0)+" vente(s)",1)]),e("td",he,[e("div",ve,[E(h(g),{href:h(v)("customers.show",{id:s.id}),class:"btn btn-sm btn-outline-primary",title:"Voir"},{default:w(()=>[...t[6]||(t[6]=[e("i",{class:"bi bi-eye"},null,-1)])]),_:1},8,["href"]),E(h(g),{href:h(v)("customers.edit",{id:s.id}),class:"btn btn-sm btn-outline-secondary",title:"Modifier"},{default:w(()=>[...t[7]||(t[7]=[e("i",{class:"bi bi-pencil"},null,-1)])]),_:1},8,["href"]),e("button",{onClick:_=>I(s),class:"btn btn-sm btn-outline-danger",title:"Supprimer"},[...t[8]||(t[8]=[e("i",{class:"bi bi-trash"},null,-1)])],8,_e)])])]))),128))])])]),f.customers.links?(i(),c("div",xe,[e("div",we,[e("div",ge,[e("p",ye,[t[10]||(t[10]=u(" Affichage de ",-1)),e("span",ke,o(f.customers.from),1),t[11]||(t[11]=u(" à ",-1)),e("span",Ee,o(f.customers.to),1),t[12]||(t[12]=u(" sur ",-1)),e("span",Ce,o(f.customers.total),1),t[13]||(t[13]=u(" résultats ",-1))])]),e("nav",null,[e("ul",Ue,[(i(!0),c(S,null,R(f.customers.links,s=>(i(),c("li",{key:s.label,class:L(["page-item",{active:s.active,disabled:!s.url}])},[s.url?(i(),U(h(g),{key:0,href:s.url,class:"page-link",innerHTML:s.label},null,8,["href","innerHTML"])):(i(),c("span",{key:1,class:"page-link",innerHTML:s.label},null,8,Le))],2))),128))])])])])):N("",!0)])]),_:1}))}}),Fe=z(Se,[["__scopeId","data-v-b6c8a0a4"]]);export{Fe as default};
