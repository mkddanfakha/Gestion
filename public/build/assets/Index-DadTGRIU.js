import{d as P,r as E,c as C,w as g,a as e,f as m,j as S,b as u,o as a,t as i,u as v,l as w,n as U,m as L,v as N,p as $,e as B,F as R,g as T,h as A}from"./app-Ctez1HXG.js";import{_ as H}from"./AppLayout.vue_vue_type_script_setup_true_lang-DkXoEYZQ.js";import{r as h}from"./routes-C8N3XD_S.js";import{u as z}from"./useSweetAlert-CjcY7Pj8.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BootstrapLayout-ri-ER_V1.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const q={class:"d-flex justify-content-between align-items-center mb-4"},J={class:"d-flex gap-2"},K=["disabled"],Q={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},W={key:1,class:"bi bi-file-pdf me-1"},X=["disabled"],Y={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Z={key:1,class:"bi bi-file-excel me-1"},ee={class:"card mb-4"},se={class:"card-body"},te={class:"row g-3"},le={class:"col-md-4"},ne={class:"col-md-3"},oe={class:"card"},ae={class:"table-responsive"},ie={class:"table table-hover mb-0"},re={class:"d-flex align-items-center"},de={class:"fw-medium"},ce={class:"text-muted small"},ue={class:"small"},me={class:"fw-medium"},fe={class:"text-muted"},be={class:"small"},pe={class:"fw-medium"},ve={class:"text-muted"},he={class:"text-end"},xe={class:"btn-group",role:"group"},_e=["onClick"],ge={key:0,class:"card-footer"},we={class:"d-flex justify-content-between align-items-center"},ye={class:"d-none d-md-block"},ke={class:"text-muted mb-0"},Ee={class:"fw-medium"},Se={class:"fw-medium"},Ue={class:"fw-medium"},Ce={class:"pagination pagination-sm mb-0"},Le=["innerHTML"],Re=P({__name:"Index",props:{suppliers:{},filters:{}},setup(f){const r=E(!1),d=E(!1),F=f,{success:M,error:y,confirm:j}=z(),l=E({...F.filters}),k=()=>{A.get(h("suppliers.index"),l.value,{preserveState:!0,replace:!0})},I=()=>{l.value={},k()},D=async o=>{await j(`Êtes-vous sûr de vouloir supprimer le fournisseur "${o.name}" ?`)&&A.delete(h("suppliers.destroy",{id:o.id}),{onSuccess:()=>{M(`Fournisseur "${o.name}" supprimé avec succès !`)},onError:t=>{const x=t.message||"Erreur lors de la suppression du fournisseur.";y(x)}})},V=async()=>{if(!(r.value||d.value)){r.value=!0;try{let o=h("suppliers.export.pdf");const s=new URLSearchParams;l.value.search&&s.append("search",l.value.search),l.value.status&&s.append("status",l.value.status),s.toString()&&(o+="?"+s.toString());const t=await fetch(o);if(!t.ok)throw new Error("Erreur lors de l'export");const x=await t.blob(),_=window.URL.createObjectURL(x),c=document.createElement("a");c.href=_;const b=t.headers.get("content-disposition");let p="fournisseurs_"+new Date().toISOString().split("T")[0]+".pdf";if(b){let n=b.match(/filename\*=UTF-8''(.+)/i);n?p=decodeURIComponent(n[1]):(n=b.match(/filename="?([^"]+)"?/i),n&&n[1]&&(p=n[1].trim()))}c.download=p,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(_),setTimeout(()=>{r.value=!1},500)}catch{r.value=!1,y("Erreur lors de l'export PDF")}}},O=async()=>{if(!(d.value||r.value)){d.value=!0;try{let o=h("suppliers.export.excel");const s=new URLSearchParams;l.value.search&&s.append("search",l.value.search),l.value.status&&s.append("status",l.value.status),s.toString()&&(o+="?"+s.toString());const t=await fetch(o);if(!t.ok)throw new Error("Erreur lors de l'export");const x=await t.blob(),_=window.URL.createObjectURL(x),c=document.createElement("a");c.href=_;const b=t.headers.get("content-disposition");let p="fournisseurs_"+new Date().toISOString().split("T")[0]+".xlsx";if(b){let n=b.match(/filename\*=UTF-8''(.+)/i);n?p=decodeURIComponent(n[1]):(n=b.match(/filename="?([^"]+)"?/i),n&&n[1]&&(p=n[1].trim()))}c.download=p,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(_),setTimeout(()=>{d.value=!1},500)}catch{d.value=!1,y("Erreur lors de l'export Excel")}}};return(o,s)=>(a(),C(H,null,{default:g(()=>[e("div",q,[s[3]||(s[3]=e("div",null,[e("h1",{class:"h2 mb-1"},[e("i",{class:"bi bi-truck me-2"}),m(" Fournisseurs ")]),e("p",{class:"text-muted mb-0"},"Gérez vos fournisseurs")],-1)),e("div",J,[e("button",{onClick:V,class:"btn btn-danger",disabled:r.value||d.value},[r.value?(a(),u("span",Q)):(a(),u("i",W)),m(" "+i(r.value?"Export en cours...":"Exporter PDF"),1)],8,K),e("button",{onClick:O,class:"btn btn-success",disabled:d.value||r.value},[d.value?(a(),u("span",Y)):(a(),u("i",Z)),m(" "+i(d.value?"Export en cours...":"Exporter Excel"),1)],8,X),S(v(w),{href:v(h)("suppliers.create"),class:U(["btn btn-primary",{disabled:r.value||d.value}]),tabindex:r.value||d.value?-1:0},{default:g(()=>[...s[2]||(s[2]=[e("i",{class:"bi bi-plus-circle me-1"},null,-1),m(" Ajouter un fournisseur ",-1)])]),_:1},8,["href","class","tabindex"])])]),e("div",ee,[e("div",se,[e("div",te,[e("div",le,[s[4]||(s[4]=e("label",{class:"form-label"},"Recherche",-1)),L(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>l.value.search=t),type:"text",placeholder:"Nom, contact, email ou téléphone...",class:"form-control",onInput:k},null,544),[[N,l.value.search]])]),e("div",ne,[s[6]||(s[6]=e("label",{class:"form-label"},"Statut",-1)),L(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>l.value.status=t),class:"form-select",onChange:k},[...s[5]||(s[5]=[e("option",{value:""},"Tous les statuts",-1),e("option",{value:"active"},"Actif",-1),e("option",{value:"inactive"},"Inactif",-1)])],544),[[$,l.value.status]])]),e("div",{class:"col-md-2 d-flex align-items-end"},[e("button",{onClick:I,class:"btn btn-outline-secondary w-100"},[...s[7]||(s[7]=[e("i",{class:"bi bi-x-circle me-1"},null,-1),m(" Effacer ",-1)])])])])])]),e("div",oe,[e("div",ae,[e("table",ie,[s[12]||(s[12]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Fournisseur"),e("th",null,"Contact"),e("th",null,"Adresse"),e("th",null,"Statut"),e("th",{class:"text-end"},"Actions")])],-1)),e("tbody",null,[(a(!0),u(R,null,T(f.suppliers.data,t=>(a(),u("tr",{key:t.id},[e("td",null,[e("div",re,[s[8]||(s[8]=e("div",{class:"flex-shrink-0 me-3"},[e("div",{class:"bg-light rounded-circle d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px"}},[e("i",{class:"bi bi-truck text-muted"})])],-1)),e("div",null,[e("div",de,i(t.name),1),e("div",ce,i(t.contact_person||"Aucun contact"),1)])])]),e("td",null,[e("div",ue,[e("div",me,i(t.email||"Aucun email"),1),e("div",fe,i(t.phone||t.mobile||"Aucun téléphone"),1)])]),e("td",null,[e("div",be,[e("div",pe,i(t.address||"Aucune adresse"),1),e("div",ve,i(t.city?`${t.city}`:""),1)])]),e("td",null,[e("span",{class:U(["badge",t.status==="active"?"bg-success":"bg-secondary"])},i(t.status_label),3)]),e("td",he,[e("div",xe,[S(v(w),{href:v(h)("suppliers.show",{id:t.id}),class:"btn btn-sm btn-outline-primary",title:"Voir"},{default:g(()=>[...s[9]||(s[9]=[e("i",{class:"bi bi-eye"},null,-1)])]),_:1},8,["href"]),S(v(w),{href:v(h)("suppliers.edit",{id:t.id}),class:"btn btn-sm btn-outline-secondary",title:"Modifier"},{default:g(()=>[...s[10]||(s[10]=[e("i",{class:"bi bi-pencil"},null,-1)])]),_:1},8,["href"]),e("button",{onClick:x=>D(t),class:"btn btn-sm btn-outline-danger",title:"Supprimer"},[...s[11]||(s[11]=[e("i",{class:"bi bi-trash"},null,-1)])],8,_e)])])]))),128))])])]),f.suppliers.links?(a(),u("div",ge,[e("div",we,[e("div",ye,[e("p",ke,[s[13]||(s[13]=m(" Affichage de ",-1)),e("span",Ee,i(f.suppliers.from),1),s[14]||(s[14]=m(" à ",-1)),e("span",Se,i(f.suppliers.to),1),s[15]||(s[15]=m(" sur ",-1)),e("span",Ue,i(f.suppliers.total),1),s[16]||(s[16]=m(" résultats ",-1))])]),e("nav",null,[e("ul",Ce,[(a(!0),u(R,null,T(f.suppliers.links,t=>(a(),u("li",{key:t.label,class:U(["page-item",{active:t.active,disabled:!t.url}])},[t.url?(a(),C(v(w),{key:0,href:t.url,class:"page-link",innerHTML:t.label},null,8,["href","innerHTML"])):(a(),u("span",{key:1,class:"page-link",innerHTML:t.label},null,8,Le))],2))),128))])])])])):B("",!0)])]),_:1}))}}),Ve=G(Re,[["__scopeId","data-v-4def15c4"]]);export{Ve as default};
