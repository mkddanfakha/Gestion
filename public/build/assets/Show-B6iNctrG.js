import{_ as I}from"./AppLayout.vue_vue_type_script_setup_true_lang-oJPXENP6.js";import{d as A,r as y,c as U,w as g,a as t,t as o,j as x,u as h,l as q,f as m,b as n,e as k,n as p,o as i,F,g as B,s as P,h as V}from"./app-oFHxr63-.js";import{r as v}from"./routes-D3G7R3Tx.js";import{u as M}from"./useSweetAlert-CjcY7Pj8.js";import"./BootstrapLayout-CedOSUd9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const O={class:"d-flex justify-content-between align-items-center mb-4"},Q={class:"h2 mb-1"},$={class:"d-flex gap-2"},z={class:"row g-4"},W={class:"col-lg-8"},G={class:"card mb-4"},H={class:"card-body"},J={class:"row g-3"},K={class:"col-md-6"},X={class:"mb-0 font-monospace"},Y={class:"col-md-6"},Z={class:"mb-0"},tt={class:"col-md-6"},st={class:"mb-0"},et={class:"col-md-6"},ot={class:"mb-0"},lt={class:"col-md-6"},dt={class:"mb-0"},it={class:"col-md-6"},nt={class:"mb-0 fw-bold text-success fs-5"},at={key:0,class:"col-md-6"},rt={class:"mb-0"},ct={key:0,class:"badge bg-danger ms-2"},ut={key:1,class:"badge bg-success ms-2"},mt={key:0,class:"mt-4 pt-3 border-top"},bt={class:"bg-light p-3 rounded"},vt={class:"mb-0"},ft={class:"card"},ht={class:"card-body"},_t={key:0,class:"text-center py-4 text-muted"},gt={key:1,class:"table-responsive"},pt={class:"table table-hover mb-0"},wt={class:"align-middle"},yt={class:"d-flex align-items-center"},xt={class:"flex-shrink-0 me-3"},qt={key:0,class:"bg-light rounded overflow-hidden d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},kt=["src","alt"],Ct={key:1,class:"bg-light rounded d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},jt={class:"fw-medium"},Et={class:"text-muted small"},St={class:"align-middle"},Dt={key:1,class:"badge bg-secondary"},Rt={class:"align-middle"},Lt={class:"fw-medium"},Nt={class:"text-muted ms-1"},Tt={class:"align-middle"},It={class:"align-middle fw-medium text-success"},At={class:"col-lg-4"},Ut={class:"card mb-4"},Ft={class:"card-body"},Bt={class:"d-flex justify-content-between mb-2"},Pt={class:"fw-medium"},Vt={class:"d-flex justify-content-between mb-2"},Mt={class:"fw-medium"},Ot={class:"d-flex justify-content-between mb-2"},Qt={class:"fw-medium"},$t={class:"d-flex justify-content-between mb-3"},zt={class:"fw-bold text-success fs-5"},Wt={class:"card mb-4"},Gt={class:"card-body"},Ht={class:"d-grid gap-2"},Jt=["disabled"],Kt={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Xt={key:1,class:"bi bi-download me-1"},Yt=["disabled"],Zt={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},ts={key:1,class:"bi bi-printer me-1"},ss=["disabled"],es={class:"card"},os={class:"card-body"},ls={class:"row g-3 text-center"},ds={class:"col-6"},is={class:"p-2 bg-light rounded"},ns={class:"fw-bold text-primary"},as={class:"col-6"},rs={class:"p-2 bg-light rounded"},cs={class:"fw-bold text-success"},gs=A({__name:"Show",props:{quote:{}},setup(e){const{success:C,error:_,confirm:j}=M(),r=y(!1),a=y(!1),b=e,u=l=>new Intl.NumberFormat("fr-FR").format(l)+" Fcfa",w=l=>new Date(l).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"}),E=l=>({draft:"Brouillon",sent:"Envoyé",accepted:"Accepté",rejected:"Refusé",expired:"Expiré"})[l]||l,S=l=>({draft:"bg-secondary",sent:"bg-info",accepted:"bg-success",rejected:"bg-danger",expired:"bg-warning text-dark"})[l]||"bg-secondary",D=l=>({draft:"bi bi-file-earmark",sent:"bi bi-send",accepted:"bi bi-check-circle",rejected:"bi bi-x-circle",expired:"bi bi-clock-history"})[l]||"bi bi-question-circle",R=l=>l?new Date(l)<new Date:!1,L=async()=>{if(!r.value){r.value=!0;try{const l=v("quotes.download",{quote:b.quote.id}),s=await fetch(l);if(!s.ok)throw new Error("Erreur lors du téléchargement");const d=await s.blob(),f=window.URL.createObjectURL(d),c=document.createElement("a");c.href=f,c.download=`devis_${b.quote.quote_number}.pdf`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(f),setTimeout(()=>{r.value=!1},500)}catch{r.value=!1,_("Erreur lors du téléchargement du devis")}}},N=async()=>{if(!a.value){a.value=!0;try{const l=v("quotes.print",{quote:b.quote.id}),s=await fetch(l);if(!s.ok)throw new Error("Erreur lors du chargement");const d=await s.blob(),f=window.URL.createObjectURL(d),c=window.open(f,"_blank");c?c.onload=()=>{setTimeout(()=>{c.print(),a.value=!1},500)}:window.location.href=l,setTimeout(()=>{a.value=!1},3e3)}catch{a.value=!1,_("Erreur lors de l'ouverture du devis")}}},T=async()=>{await j(`Êtes-vous sûr de vouloir supprimer le devis "${b.quote.quote_number}" ?`)&&V.delete(v("quotes.destroy",{id:b.quote.id}),{onSuccess:()=>{C(`Devis "${b.quote.quote_number}" supprimé avec succès !`)},onError:s=>{const d=s.message||"Erreur lors de la suppression du devis.";_(d)}})};return(l,s)=>(i(),U(I,null,{default:g(()=>[t("div",O,[t("div",null,[t("h1",Q,"Devis "+o(e.quote.quote_number),1),s[0]||(s[0]=t("p",{class:"text-muted mb-0"},"Détails du devis",-1))]),t("div",$,[x(h(q),{href:h(v)("quotes.index"),class:"btn btn-outline-secondary"},{default:g(()=>[...s[1]||(s[1]=[t("i",{class:"bi bi-arrow-left me-1"},null,-1),m(" Retour à la liste ",-1)])]),_:1},8,["href"])])]),t("div",z,[t("div",W,[t("div",G,[s[10]||(s[10]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Informations générales")],-1)),t("div",H,[t("div",J,[t("div",K,[s[2]||(s[2]=t("label",{class:"form-label text-muted"},"Numéro de devis",-1)),t("p",X,o(e.quote.quote_number),1)]),t("div",Y,[s[3]||(s[3]=t("label",{class:"form-label text-muted"},"Date",-1)),t("p",Z,o(w(e.quote.created_at)),1)]),t("div",tt,[s[4]||(s[4]=t("label",{class:"form-label text-muted"},"Client",-1)),t("p",st,o(e.quote.customer?.name||"Client anonyme"),1)]),t("div",et,[s[5]||(s[5]=t("label",{class:"form-label text-muted"},"Créé par",-1)),t("p",ot,o(e.quote.user?.name||"Non renseigné"),1)]),t("div",lt,[s[6]||(s[6]=t("label",{class:"form-label text-muted"},"Statut",-1)),t("p",dt,[t("span",{class:p(["badge",S(e.quote.status)])},[t("i",{class:p(["me-1",D(e.quote.status)])},null,2),m(" "+o(E(e.quote.status)),1)],2)])]),t("div",it,[s[7]||(s[7]=t("label",{class:"form-label text-muted"},"Montant total",-1)),t("p",nt,o(u(e.quote.total_amount)),1)]),e.quote.valid_until?(i(),n("div",at,[s[8]||(s[8]=t("label",{class:"form-label text-muted"},"Date de validité",-1)),t("p",rt,[m(o(w(e.quote.valid_until))+" ",1),R(e.quote.valid_until)?(i(),n("span",ct," Expiré ")):(i(),n("span",ut," Valide "))])])):k("",!0)]),e.quote.notes?(i(),n("div",mt,[s[9]||(s[9]=t("label",{class:"form-label text-muted"},"Notes",-1)),t("div",bt,[t("p",vt,o(e.quote.notes),1)])])):k("",!0)])]),t("div",ft,[s[14]||(s[14]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Articles du devis")],-1)),t("div",ht,[!e.quote.quoteItems||e.quote.quoteItems.length===0?(i(),n("div",_t,[...s[11]||(s[11]=[t("i",{class:"bi bi-cart-x fs-1 mb-3"},null,-1),t("p",null,"Aucun article trouvé pour ce devis.",-1)])])):(i(),n("div",gt,[t("table",pt,[s[13]||(s[13]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"Produit"),t("th",null,"Catégorie"),t("th",null,"Quantité"),t("th",null,"Prix unitaire"),t("th",null,"Total")])],-1)),t("tbody",null,[(i(!0),n(F,null,B(e.quote.quoteItems,d=>(i(),n("tr",{key:d.id},[t("td",wt,[t("div",yt,[t("div",xt,[d.product?.image_url?(i(),n("div",qt,[t("img",{src:d.product.image_url,alt:d.product?.name||"Produit",class:"img-fluid",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,kt)])):(i(),n("div",Ct,[...s[12]||(s[12]=[t("i",{class:"bi bi-box text-muted"},null,-1)])]))]),t("div",null,[t("div",jt,o(d.product?.name||"Produit supprimé"),1),t("div",Et,o(d.product?.sku||"N/A"),1)])])]),t("td",St,[d.product?.category?(i(),n("span",{key:0,class:"badge",style:P({backgroundColor:d.product.category.color+"20",color:d.product.category.color})},o(d.product.category.name),5)):(i(),n("span",Dt," Catégorie supprimée "))]),t("td",Rt,[t("span",Lt,o(d.quantity),1),t("span",Nt,o(d.product?.unit||"pièce"),1)]),t("td",Tt,o(u(d.unit_price)),1),t("td",It,o(u(d.total_price)),1)]))),128))])])]))])])]),t("div",At,[t("div",Ut,[s[20]||(s[20]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Résumé financier")],-1)),t("div",Ft,[t("div",Bt,[s[15]||(s[15]=t("span",null,"Sous-total:",-1)),t("span",Pt,o(u(e.quote.subtotal||e.quote.total_amount)),1)]),t("div",Vt,[s[16]||(s[16]=t("span",null,"Taxes:",-1)),t("span",Mt,o(u(e.quote.tax_amount||0)),1)]),t("div",Ot,[s[17]||(s[17]=t("span",null,"Remise:",-1)),t("span",Qt,o(u(e.quote.discount_amount||0)),1)]),s[19]||(s[19]=t("hr",null,null,-1)),t("div",$t,[s[18]||(s[18]=t("span",{class:"fw-bold"},"Total:",-1)),t("span",zt,o(u(e.quote.total_amount)),1)])])]),t("div",Wt,[s[23]||(s[23]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Actions rapides")],-1)),t("div",Gt,[t("div",Ht,[t("button",{onClick:L,class:"btn btn-success",disabled:r.value||a.value},[r.value?(i(),n("span",Kt)):(i(),n("i",Xt)),m(" "+o(r.value?"Téléchargement...":"Télécharger le devis"),1)],8,Jt),t("button",{onClick:N,class:"btn btn-info",disabled:a.value||r.value},[a.value?(i(),n("span",Zt)):(i(),n("i",ts)),m(" "+o(a.value?"Ouverture...":"Imprimer le devis"),1)],8,Yt),x(h(q),{href:h(v)("quotes.edit",{id:e.quote.id}),class:p(["btn btn-outline-primary",{disabled:r.value||a.value}]),tabindex:r.value||a.value?-1:0},{default:g(()=>[...s[21]||(s[21]=[t("i",{class:"bi bi-pencil me-1"},null,-1),m(" Modifier le devis ",-1)])]),_:1},8,["href","class","tabindex"]),t("button",{onClick:T,class:"btn btn-outline-danger",disabled:r.value||a.value},[...s[22]||(s[22]=[t("i",{class:"bi bi-trash me-1"},null,-1),m(" Supprimer le devis ",-1)])],8,ss)])])]),t("div",es,[s[26]||(s[26]=t("div",{class:"card-header"},[t("h5",{class:"card-title mb-0"},"Statistiques")],-1)),t("div",os,[t("div",ls,[t("div",ds,[t("div",is,[t("div",ns,o(e.quote.items_count||e.quote.quoteItems?.length||0),1),s[24]||(s[24]=t("div",{class:"small text-muted"},"Articles",-1))])]),t("div",as,[t("div",rs,[t("div",cs,o(u(e.quote.total_amount)),1),s[25]||(s[25]=t("div",{class:"small text-muted"},"Montant",-1))])])])])])])])]),_:1}))}});export{gs as default};
