import{d as Q,i as G,y as P,c as H,w as x,a as e,t as c,j as h,u as s,l as S,f as a,m as b,b as i,e as v,n as y,o as r,F as T,g as F,p as D,v as _}from"./app-DQWaqSr_.js";import{_ as J}from"./AppLayout.vue_vue_type_script_setup_true_lang-BZ-gD5FF.js";import{r as k}from"./routes-C8N3XD_S.js";import{u as K}from"./useSweetAlert-CjcY7Pj8.js";import{P as W}from"./ProductAutocomplete-C0u6HVCP.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BootstrapLayout-CnHsE3D3.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const Y={class:"d-flex justify-content-between align-items-center mb-4"},Z={class:"text-muted mb-0"},tt={class:"d-flex gap-2"},et={class:"row"},st={class:"col-lg-8"},ot={class:"card mb-4"},lt={class:"card-body"},nt={class:"row g-3"},dt={class:"col-md-6"},rt=["value"],it={key:0,class:"invalid-feedback"},at={class:"col-md-6"},ut={key:0,class:"invalid-feedback"},ct={class:"col-md-6"},mt={key:0,class:"invalid-feedback"},pt={class:"col-md-6"},bt={key:0,class:"invalid-feedback"},_t={class:"col-12"},vt={key:0,class:"invalid-feedback"},ft={class:"card mb-4"},yt={class:"card-body"},xt={key:0,class:"text-center py-4 text-muted"},ht={key:1},kt={class:"row g-3"},gt={class:"col-md-5"},wt={key:0,class:"invalid-feedback d-block"},Vt={class:"col-md-2"},It=["onUpdate:modelValue","onInput"],Nt={class:"col-md-3"},Ot=["onUpdate:modelValue","onInput"],St={class:"col-md-2"},jt=["value"],Ct={class:"col-12 text-end"},Ut=["onClick"],qt={class:"col-lg-4"},At={class:"card sticky-top",style:{top:"20px"}},Pt={class:"card-body"},Tt={class:"mb-3"},Ft={class:"d-flex justify-content-between mb-2"},Dt={class:"fw-medium"},Et={class:"d-flex justify-content-between mb-2"},Bt={class:"fw-medium"},Rt={class:"d-flex justify-content-between mb-2"},Mt={class:"d-flex justify-content-between mb-2"},$t={class:"d-flex justify-content-between"},zt={class:"fw-bold text-success fs-5"},Lt={class:"d-grid gap-2"},Qt=["disabled"],Gt={key:0,class:"spinner-border spinner-border-sm me-2"},Ht={key:1,class:"bi bi-check-circle me-1"},Jt=Q({__name:"Edit",props:{purchaseOrder:{},suppliers:{},products:{}},setup(f){const u=f,{success:E,error:j}=K(),C=l=>{if(!l)return"";const t=new Date(l);return isNaN(t.getTime())?"":t.toISOString().split("T")[0]},o=G({supplier_id:u.purchaseOrder.supplier_id,order_date:C(u.purchaseOrder.order_date),expected_delivery_date:C(u.purchaseOrder.expected_delivery_date),status:u.purchaseOrder.status,notes:u.purchaseOrder.notes||"",tax_amount:Number(u.purchaseOrder.tax_amount)||0,discount_amount:Number(u.purchaseOrder.discount_amount)||0,subtotal:Number(u.purchaseOrder.subtotal)||0,total_amount:Number(u.purchaseOrder.total_amount)||0,items:(u.purchaseOrder.items||[]).map(l=>({product_id:l.product_id,quantity:Number(l.quantity)||1,unit_price:Number(l.unit_price)||0,total_price:Number(l.total_price)||0}))}),B=()=>{o.items.push({product_id:0,quantity:1,unit_price:0,total_price:0})},R=l=>{o.items.splice(l,1),w()},U=(l,t)=>o.items.some((n,m)=>n.product_id===l&&m!==t),q=l=>{const t=o.items[l];return!t.product_id||t.product_id===0?!1:U(t.product_id,l)},M=l=>o.items.map((t,n)=>n!==l?t.product_id:null).filter(t=>t!==null&&t>0),$=(l,t)=>{const n=o.items[t];n.product_id=l.id,n.unit_price=l.cost_price||l.price,g(t),z(t)},z=l=>{const t=o.items[l];t.product_id&&U(t.product_id,l)&&(t.product_id=0,t.unit_price=0,t.total_price=0,w(),j("Ce produit est déjà sélectionné dans un autre article."))},g=l=>{const t=o.items[l];t.total_price=t.quantity*t.unit_price,w()},w=()=>{o.subtotal=o.items.reduce((l,t)=>l+t.total_price,0),V()},V=()=>{o.total_amount=o.subtotal+o.tax_amount-o.discount_amount},I=P(()=>o.items.reduce((l,t)=>l+t.total_price,0)),A=P(()=>I.value+o.tax_amount-o.discount_amount),N=l=>new Intl.NumberFormat("fr-FR").format(l)+" Fcfa",L=()=>{o.subtotal=I.value,o.total_amount=A.value,o.put(k("purchase-orders.update",{id:u.purchaseOrder.id}),{onSuccess:()=>{E("Bon de commande modifié avec succès !")},onError:()=>{j("Erreur lors de la modification du bon de commande.")}})},{errors:d,processing:O}=o;return(l,t)=>(r(),H(J,null,{default:x(()=>[e("div",Y,[e("div",null,[t[7]||(t[7]=e("h1",{class:"h2 mb-1"},"Modifier le bon de commande",-1)),e("p",Z,c(f.purchaseOrder.po_number),1)]),e("div",tt,[h(s(S),{href:s(k)("purchase-orders.show",{id:f.purchaseOrder.id}),class:"btn btn-outline-primary"},{default:x(()=>[...t[8]||(t[8]=[e("i",{class:"bi bi-eye me-1"},null,-1),a(" Voir le bon de commande ",-1)])]),_:1},8,["href"]),h(s(S),{href:s(k)("purchase-orders.index"),class:"btn btn-outline-secondary"},{default:x(()=>[...t[9]||(t[9]=[e("i",{class:"bi bi-arrow-left me-1"},null,-1),a(" Retour à la liste ",-1)])]),_:1},8,["href"])])]),e("form",null,[e("div",et,[e("div",st,[e("div",ot,[t[17]||(t[17]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Informations générales")],-1)),e("div",lt,[e("div",nt,[e("div",dt,[t[11]||(t[11]=e("label",{class:"form-label"},[a(" Fournisseur "),e("span",{class:"text-danger"},"*")],-1)),b(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>s(o).supplier_id=n),required:"",class:y(["form-select",{"is-invalid":s(d).supplier_id}])},[t[10]||(t[10]=e("option",{value:""},"Sélectionner un fournisseur",-1)),(r(!0),i(T,null,F(f.suppliers,n=>(r(),i("option",{key:n.id,value:n.id},c(n.name),9,rt))),128))],2),[[D,s(o).supplier_id]]),s(d).supplier_id?(r(),i("div",it,c(s(d).supplier_id),1)):v("",!0)]),e("div",at,[t[13]||(t[13]=e("label",{class:"form-label"},[a(" Statut "),e("span",{class:"text-danger"},"*")],-1)),b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>s(o).status=n),required:"",class:y(["form-select",{"is-invalid":s(d).status}])},[...t[12]||(t[12]=[e("option",{value:"draft"},"Brouillon",-1),e("option",{value:"sent"},"Envoyé",-1),e("option",{value:"confirmed"},"Confirmé",-1),e("option",{value:"partially_received"},"Partiellement reçu",-1),e("option",{value:"received"},"Reçu",-1),e("option",{value:"cancelled"},"Annulé",-1)])],2),[[D,s(o).status]]),s(d).status?(r(),i("div",ut,c(s(d).status),1)):v("",!0)]),e("div",ct,[t[14]||(t[14]=e("label",{class:"form-label"},[a(" Date de commande "),e("span",{class:"text-danger"},"*")],-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>s(o).order_date=n),type:"date",required:"",class:y(["form-control",{"is-invalid":s(d).order_date}])},null,2),[[_,s(o).order_date]]),s(d).order_date?(r(),i("div",mt,c(s(d).order_date),1)):v("",!0)]),e("div",pt,[t[15]||(t[15]=e("label",{class:"form-label"},"Date de livraison prévue",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>s(o).expected_delivery_date=n),type:"date",class:y(["form-control",{"is-invalid":s(d).expected_delivery_date}])},null,2),[[_,s(o).expected_delivery_date]]),s(d).expected_delivery_date?(r(),i("div",bt,c(s(d).expected_delivery_date),1)):v("",!0)]),e("div",_t,[t[16]||(t[16]=e("label",{class:"form-label"},"Notes",-1)),b(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=n=>s(o).notes=n),rows:"3",class:y(["form-control",{"is-invalid":s(d).notes}]),placeholder:"Ajoutez des notes sur ce bon de commande..."},null,2),[[_,s(o).notes]]),s(d).notes?(r(),i("div",vt,c(s(d).notes),1)):v("",!0)])])])]),e("div",ft,[e("div",{class:"card-header d-flex justify-content-between align-items-center"},[t[19]||(t[19]=e("h5",{class:"card-title mb-0"},"Articles",-1)),e("button",{type:"button",onClick:B,class:"btn btn-primary btn-sm"},[...t[18]||(t[18]=[e("i",{class:"bi bi-plus-circle me-1"},null,-1),a(" Ajouter un article ",-1)])])]),e("div",yt,[s(o).items.length===0?(r(),i("div",xt,[...t[20]||(t[20]=[e("i",{class:"bi bi-cart-x fs-1 mb-3"},null,-1),e("p",null,'Aucun article ajouté. Cliquez sur "Ajouter un article" pour commencer.',-1)])])):(r(),i("div",ht,[(r(!0),i(T,null,F(s(o).items,(n,m)=>(r(),i("div",{key:m,class:"border rounded p-3 mb-3"},[e("div",kt,[e("div",gt,[t[21]||(t[21]=e("label",{class:"form-label"},[a("Produit "),e("span",{class:"text-danger"},"*")],-1)),h(W,{modelValue:n.product_id,"onUpdate:modelValue":p=>n.product_id=p,products:f.products,"exclude-product-ids":M(m),"is-invalid":q(m),placeholder:"Rechercher un produit...",onSelected:p=>$(p,m)},null,8,["modelValue","onUpdate:modelValue","products","exclude-product-ids","is-invalid","onSelected"]),q(m)?(r(),i("div",wt," Ce produit est déjà sélectionné dans ce bon de commande. ")):v("",!0)]),e("div",Vt,[t[22]||(t[22]=e("label",{class:"form-label"},[a("Quantité "),e("span",{class:"text-danger"},"*")],-1)),b(e("input",{"onUpdate:modelValue":p=>n.quantity=p,type:"number",min:"1",required:"",class:"form-control",onInput:p=>g(m)},null,40,It),[[_,n.quantity,void 0,{number:!0}]])]),e("div",Nt,[t[23]||(t[23]=e("label",{class:"form-label"},[a("Prix unitaire "),e("span",{class:"text-danger"},"*")],-1)),b(e("input",{"onUpdate:modelValue":p=>n.unit_price=p,type:"number",step:"0.01",min:"0",required:"",class:"form-control",onInput:p=>g(m)},null,40,Ot),[[_,n.unit_price,void 0,{number:!0}]])]),e("div",St,[t[24]||(t[24]=e("label",{class:"form-label"},"Total",-1)),e("input",{value:N(n.total_price),type:"text",class:"form-control",readonly:""},null,8,jt)]),e("div",Ct,[e("button",{type:"button",onClick:p=>R(m),class:"btn btn-sm btn-outline-danger"},[...t[25]||(t[25]=[e("i",{class:"bi bi-trash me-1"},null,-1),a(" Supprimer ",-1)])],8,Ut)])])]))),128))]))])])]),e("div",qt,[e("div",At,[t[33]||(t[33]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Résumé")],-1)),e("div",Pt,[e("div",Tt,[e("div",Ft,[t[26]||(t[26]=e("span",null,"Articles:",-1)),e("span",Dt,c(s(o).items.length),1)]),e("div",Et,[t[27]||(t[27]=e("span",null,"Sous-total:",-1)),e("span",Bt,c(N(I.value)),1)]),e("div",Rt,[t[28]||(t[28]=e("span",null,"Taxes:",-1)),b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>s(o).tax_amount=n),type:"number",step:"0.01",min:"0",class:"form-control form-control-sm",style:{width:"120px"},onInput:V},null,544),[[_,s(o).tax_amount,void 0,{number:!0}]])]),e("div",Mt,[t[29]||(t[29]=e("span",null,"Remise:",-1)),b(e("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>s(o).discount_amount=n),type:"number",step:"0.01",min:"0",class:"form-control form-control-sm",style:{width:"120px"},onInput:V},null,544),[[_,s(o).discount_amount,void 0,{number:!0}]])]),t[31]||(t[31]=e("hr",null,null,-1)),e("div",$t,[t[30]||(t[30]=e("span",{class:"fw-bold"},"Total:",-1)),e("span",zt,c(N(A.value)),1)])]),e("div",Lt,[e("button",{type:"button",onClick:L,class:"btn btn-success",disabled:s(O)||s(o).items.length===0},[s(O)?(r(),i("span",Gt)):(r(),i("i",Ht)),a(" "+c(s(O)?"Modification...":"Modifier le bon de commande"),1)],8,Qt),h(s(S),{href:s(k)("purchase-orders.index"),class:"btn btn-outline-secondary"},{default:x(()=>[...t[32]||(t[32]=[a(" Annuler ",-1)])]),_:1},8,["href"])])])])])])])]),_:1}))}}),oe=X(Jt,[["__scopeId","data-v-e5283051"]]);export{oe as default};
