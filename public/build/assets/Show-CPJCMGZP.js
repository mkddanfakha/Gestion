import{_ as U}from"./AppLayout.vue_vue_type_script_setup_true_lang-DVp6PXdS.js";import{d as A,r as R,c as T,w as f,a as e,t as d,j as y,u,l as g,f as b,b as o,e as v,n as k,o as l,F as S,g as E,h as V}from"./app-C-EDQi3A.js";import{r as h}from"./routes-C8N3XD_S.js";import{u as M}from"./useSweetAlert-CjcY7Pj8.js";import"./BootstrapLayout-DqI2cyng.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./sweetalert2.esm.all-NNS-RXd7.js";const $={class:"d-flex justify-content-between align-items-center mb-4"},I={class:"h2 mb-1"},q={class:"d-flex gap-2"},z={class:"row g-4"},Q={class:"col-lg-8"},W={class:"card mb-4"},G={class:"card-body"},H={class:"row g-3"},J={class:"col-md-6"},K={class:"mb-0 font-monospace"},X={class:"col-md-6"},Y={class:"mb-0"},Z={class:"col-md-6"},ee={class:"mb-0"},se={class:"col-md-6"},te={class:"mb-0"},re={key:0,class:"col-md-6"},de={class:"mb-0"},le={class:"col-md-6"},oe={class:"mb-0"},ne={key:0,class:"mt-4 pt-3 border-top"},ae={class:"bg-light p-3 rounded"},ie={class:"mb-0"},ce={class:"card"},ue={class:"card-body"},me={key:0,class:"text-center py-4 text-muted"},be={key:1,class:"table-responsive"},he={class:"table table-hover mb-0"},pe={class:"align-middle"},fe={class:"d-flex align-items-center"},ve={class:"flex-shrink-0 me-3"},_e={key:0,class:"bg-light rounded overflow-hidden d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},ye=["src","alt"],ge={key:1,class:"bg-light rounded d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},xe={class:"fw-medium"},we={key:0,class:"text-muted small"},Oe={class:"align-middle"},ke={class:"badge bg-secondary"},Ce={class:"align-middle"},Be={class:"align-middle fw-medium text-success"},je={class:"col-lg-4"},De={class:"card mb-4"},Re={class:"card-body"},Se={class:"mb-3"},Ee={class:"d-flex justify-content-between mb-2"},Ne={class:"fw-medium"},Pe={key:0,class:"d-flex justify-content-between mb-2"},Fe={class:"fw-medium"},Le={key:1,class:"d-flex justify-content-between mb-2"},Ue={class:"fw-medium text-danger"},Ae={class:"d-flex justify-content-between"},Te={class:"fw-bold text-success fs-5"},Ve={class:"card mb-4"},Me={class:"card-header"},$e={class:"card-title mb-0"},Ie={class:"card-body"},qe={key:0,class:"text-center py-4 text-muted"},ze={key:1,class:"table-responsive"},Qe={class:"table table-hover mb-0"},We={class:"text-dark"},Ge={class:"fw-medium text-success"},He={class:"text-end"},Je={class:"card"},Ke={class:"card-body"},Xe={class:"d-grid gap-2"},Ye=["disabled"],Ze={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},es={key:1,class:"bi bi-download me-1"},ss=["disabled"],ts={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},rs={key:1,class:"bi bi-printer me-1"},ds=["disabled"],ms=A({__name:"Show",props:{purchaseOrder:{}},setup(t){const p=t,{success:C,error:x,confirm:N}=M(),a=R(!1),i=R(!1),m=n=>new Intl.NumberFormat("fr-FR").format(n)+" Fcfa",w=n=>new Date(n).toLocaleDateString("fr-FR"),B=n=>({draft:"bg-secondary",sent:"bg-info",confirmed:"bg-warning",partially_received:"bg-primary",received:"bg-success",cancelled:"bg-danger"})[n]||"bg-secondary",P=async()=>{a.value=!0;try{const n=h("purchase-orders.download",{purchaseOrder:p.purchaseOrder.id}),s=await fetch(n);if(!s.ok)throw new Error("Erreur lors du téléchargement");const r=await s.blob(),_=window.URL.createObjectURL(r),c=document.createElement("a");c.href=_;const j=s.headers.get("Content-Disposition");let D=`Bon_de_commande_${p.purchaseOrder.po_number}.pdf`;if(j){const O=j.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);O&&O[1]&&(D=O[1].replace(/['"]/g,""))}c.download=D,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(_),C("Bon de commande téléchargé avec succès !")}catch{x("Erreur lors du téléchargement du bon de commande.")}finally{a.value=!1}},F=async()=>{i.value=!0;try{const n=h("purchase-orders.print",{purchaseOrder:p.purchaseOrder.id}),s=await fetch(n);if(!s.ok)throw new Error("Erreur lors de l'ouverture du PDF");const r=await s.blob(),_=window.URL.createObjectURL(r),c=window.open(_,"_blank");c&&(c.onload=()=>{c.print()})}catch{x("Erreur lors de l'ouverture du bon de commande pour impression.")}finally{i.value=!1}},L=async()=>{await N(`Êtes-vous sûr de vouloir supprimer le bon de commande "${p.purchaseOrder.po_number}" ?`)&&V.delete(h("purchase-orders.destroy",{id:p.purchaseOrder.id}),{onSuccess:()=>{C(`Bon de commande "${p.purchaseOrder.po_number}" supprimé avec succès !`)},onError:s=>{const r=s.message||"Erreur lors de la suppression du bon de commande.";x(r)}})};return(n,s)=>(l(),T(U,null,{default:f(()=>[e("div",$,[e("div",null,[e("h1",I,"Bon de commande "+d(t.purchaseOrder.po_number),1),s[0]||(s[0]=e("p",{class:"text-muted mb-0"},"Détails du bon de commande",-1))]),e("div",q,[y(u(g),{href:u(h)("purchase-orders.index"),class:"btn btn-outline-secondary"},{default:f(()=>[...s[1]||(s[1]=[e("i",{class:"bi bi-arrow-left me-1"},null,-1),b(" Retour à la liste ",-1)])]),_:1},8,["href"])])]),e("div",z,[e("div",Q,[e("div",W,[s[9]||(s[9]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Informations générales")],-1)),e("div",G,[e("div",H,[e("div",J,[s[2]||(s[2]=e("label",{class:"form-label text-muted"},"Numéro de BC",-1)),e("p",K,d(t.purchaseOrder.po_number),1)]),e("div",X,[s[3]||(s[3]=e("label",{class:"form-label text-muted"},"Statut",-1)),e("p",Y,[e("span",{class:k(["badge",B(t.purchaseOrder.status)])},d(t.purchaseOrder.status_label),3)])]),e("div",Z,[s[4]||(s[4]=e("label",{class:"form-label text-muted"},"Fournisseur",-1)),e("p",ee,d(t.purchaseOrder.supplier?.name||"Non renseigné"),1)]),e("div",se,[s[5]||(s[5]=e("label",{class:"form-label text-muted"},"Date de commande",-1)),e("p",te,d(w(t.purchaseOrder.order_date)),1)]),t.purchaseOrder.expected_delivery_date?(l(),o("div",re,[s[6]||(s[6]=e("label",{class:"form-label text-muted"},"Date de livraison prévue",-1)),e("p",de,d(w(t.purchaseOrder.expected_delivery_date)),1)])):v("",!0),e("div",le,[s[7]||(s[7]=e("label",{class:"form-label text-muted"},"Créé par",-1)),e("p",oe,d(t.purchaseOrder.user?.name||"Non renseigné"),1)])]),t.purchaseOrder.notes?(l(),o("div",ne,[s[8]||(s[8]=e("label",{class:"form-label text-muted"},"Notes",-1)),e("div",ae,[e("p",ie,d(t.purchaseOrder.notes),1)])])):v("",!0)])]),e("div",ce,[s[13]||(s[13]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Articles commandés")],-1)),e("div",ue,[!t.purchaseOrder.items||t.purchaseOrder.items.length===0?(l(),o("div",me,[...s[10]||(s[10]=[e("i",{class:"bi bi-cart-x fs-1 mb-3"},null,-1),e("p",null,"Aucun article trouvé pour ce bon de commande.",-1)])])):(l(),o("div",be,[e("table",he,[s[12]||(s[12]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Produit"),e("th",null,"Quantité"),e("th",null,"Prix unitaire"),e("th",null,"Total")])],-1)),e("tbody",null,[(l(!0),o(S,null,E(t.purchaseOrder.items,r=>(l(),o("tr",{key:r.id},[e("td",pe,[e("div",fe,[e("div",ve,[r.product?.image_url?(l(),o("div",_e,[e("img",{src:r.product.image_url,alt:r.product?.name||"Produit",class:"img-fluid",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,ye)])):(l(),o("div",ge,[...s[11]||(s[11]=[e("i",{class:"bi bi-box text-muted"},null,-1)])]))]),e("div",null,[e("div",xe,d(r.product?.name||"Produit supprimé"),1),r.product?(l(),o("div",we,d(r.product.category?.name||"Sans catégorie"),1)):v("",!0)])])]),e("td",Oe,[e("span",ke,d(r.quantity),1)]),e("td",Ce,d(m(r.unit_price)),1),e("td",Be,d(m(r.total_price)),1)]))),128))])])]))])])]),e("div",je,[e("div",De,[s[19]||(s[19]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Résumé financier")],-1)),e("div",Re,[e("div",Se,[e("div",Ee,[s[14]||(s[14]=e("span",{class:"text-muted"},"Sous-total",-1)),e("span",Ne,d(m(t.purchaseOrder.subtotal)),1)]),t.purchaseOrder.tax_amount>0?(l(),o("div",Pe,[s[15]||(s[15]=e("span",{class:"text-muted"},"Taxes",-1)),e("span",Fe,d(m(t.purchaseOrder.tax_amount)),1)])):v("",!0),t.purchaseOrder.discount_amount>0?(l(),o("div",Le,[s[16]||(s[16]=e("span",{class:"text-muted"},"Remise",-1)),e("span",Ue,"-"+d(m(t.purchaseOrder.discount_amount)),1)])):v("",!0),s[18]||(s[18]=e("hr",null,null,-1)),e("div",Ae,[s[17]||(s[17]=e("span",{class:"fw-bold"},"Total",-1)),e("span",Te,d(m(t.purchaseOrder.total_amount)),1)])])])]),e("div",Ve,[e("div",Me,[e("h5",$e,[s[20]||(s[20]=e("i",{class:"bi bi-clipboard-check me-1"},null,-1)),b(" Bons de livraison ("+d(t.purchaseOrder.delivery_notes?.length||0)+") ",1)])]),e("div",Ie,[!t.purchaseOrder.delivery_notes||t.purchaseOrder.delivery_notes.length===0?(l(),o("div",qe,[s[22]||(s[22]=e("i",{class:"bi bi-inbox fs-1 mb-3"},null,-1)),s[23]||(s[23]=e("p",null,"Aucun bon de livraison pour ce bon de commande.",-1)),y(u(g),{href:u(h)("delivery-notes.create",{purchase_order_id:t.purchaseOrder.id}),class:"btn btn-primary btn-sm"},{default:f(()=>[...s[21]||(s[21]=[e("i",{class:"bi bi-plus-circle me-1"},null,-1),b(" Créer un bon de livraison ",-1)])]),_:1},8,["href"])])):(l(),o("div",ze,[e("table",Qe,[s[25]||(s[25]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Numéro"),e("th",null,"Date de livraison"),e("th",null,"Montant"),e("th",null,"Statut"),e("th",{class:"text-end"},"Action")])],-1)),e("tbody",null,[(l(!0),o(S,null,E(t.purchaseOrder.delivery_notes,r=>(l(),o("tr",{key:r.id},[e("td",null,[e("code",We,d(r.delivery_number),1)]),e("td",null,d(w(r.delivery_date)),1),e("td",Ge,d(m(r.total_amount)),1),e("td",null,[e("span",{class:k(["badge",B(r.status)])},d(r.status_label),3)]),e("td",He,[y(u(g),{href:u(h)("delivery-notes.show",{id:r.id}),class:"btn btn-sm btn-outline-primary",title:"Voir"},{default:f(()=>[...s[24]||(s[24]=[e("i",{class:"bi bi-eye"},null,-1)])]),_:1},8,["href"])])]))),128))])])]))])]),e("div",Je,[s[28]||(s[28]=e("div",{class:"card-header"},[e("h5",{class:"card-title mb-0"},"Actions rapides")],-1)),e("div",Ke,[e("div",Xe,[e("button",{onClick:P,class:"btn btn-primary",disabled:a.value||i.value},[a.value?(l(),o("span",Ze)):(l(),o("i",es)),b(" "+d(a.value?"Téléchargement...":"Télécharger le BC"),1)],8,Ye),e("button",{onClick:F,class:"btn btn-info",disabled:i.value||a.value},[i.value?(l(),o("span",ts)):(l(),o("i",rs)),b(" "+d(i.value?"Ouverture...":"Imprimer le BC"),1)],8,ss),y(u(g),{href:u(h)("purchase-orders.edit",{id:t.purchaseOrder.id}),class:k(["btn btn-outline-primary",{disabled:a.value||i.value}]),tabindex:a.value||i.value?-1:0},{default:f(()=>[...s[26]||(s[26]=[e("i",{class:"bi bi-pencil me-1"},null,-1),b(" Modifier le bon de commande ",-1)])]),_:1},8,["href","class","tabindex"]),e("button",{onClick:L,class:"btn btn-outline-danger",disabled:a.value||i.value},[...s[27]||(s[27]=[e("i",{class:"bi bi-trash me-1"},null,-1),b(" Supprimer le bon de commande ",-1)])],8,ds)])])])])])]),_:1}))}});export{ms as default};
